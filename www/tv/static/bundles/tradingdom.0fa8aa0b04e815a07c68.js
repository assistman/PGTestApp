webpackJsonp([9],{1347:function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{default:t}}function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){function s(n,o){var r,a;try{r=e[n](o),a=r.value}catch(t){return void i(t)}if(!r.done)return Promise.resolve(a).then(function(t){s("next",t)},function(t){s("throw",t)});t(a)}return s("next")})}}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a,l,d,u,c,h,_,p,v,m,f,y,g,b,k,w,P,T;Object.defineProperty(e,"__esModule",{value:!0}),e.DomeWidget=void 0,a=i(428),l=s(a),d=function(){function t(t,e){var i,s,n=[],o=!0,r=!1,a=void 0;try{for(i=t[Symbol.iterator]();!(o=(s=i.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(t){r=!0,a=t}finally{try{!o&&i.return&&i.return()}finally{if(r)throw a}}return n}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=Object.assign||function(t){var e,i,s;for(e=1;e<arguments.length;e++){i=arguments[e];for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t},c=function(){function t(t,e){var i,s;for(i=0;i<e.length;i++)s=e[i],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),i(1357),h=i(72),_=i(96),p=i(1519),v=i(1522),m=i(17),f=i(194),y=i(1524),g=i(1525),b=i(275),i(1526),i(1527),i(1528),i(1529),k=i(56),w=20,P=4e3,T=3e3,e.DomeWidget=function(){function t(e){var i,s=this,n=e.body,o=e.height,a=e.visible;r(this,t),this._height=o,this._visible=a,this._symbolData=null,this._trading=(0,h.tradingService)(),this._realtimeProvider=this._trading.realtimeProvider(),i=this._handlers(),this._data=new p.DomeData(i,this._trading.showPricesWithZeroVolume.readonly()),this._calcData=new v.DomeCalcBlock(i),this._uiState={},this._timerLockState={},this._timer=new g.Timer(P,function(){s._data.centerOnLast()},function(t){s._updateTimerUi(t)}),this._data.autoCenterRequired.subscribe(function(t){s._mergeTimerLockState({autoCenterRequired:t})}),n.subscribe(function(t){return s._recreateLayout(t)},{callWithLast:!0}),this._height.subscribe(function(){return s._calculateLayout()}),k.proSymbol.subscribe(function(){return s._onStateChange()}),this._realtimeProvider.onStatusChanged.subscribe(null,function(){return s._onStateChange()}),a.subscribe(function(){return s._onStateChange()}),this._onStateChange()}return c(t,[{key:"_recreateLayout",value:function(t){this._$container&&this._$container.off().empty(),this._$container=t,this._createCalculatorBlock(),this._createLegendBlock(),this._createMainBlock(),this._createNavBlock(),this._createActionsBlock(),this._syncActionButtons(),this._calculateLayout()}},{key:"_createMainBlock",value:function(){
var t,e=this,i=$("<div>",this._$container).addClass("tv-dome-widget-main");i.appendTo(this._$container),this._$warning=$("<div>",this._$container).addClass("tv-dome-panel__warning i-hidden").text($.t("No data")).appendTo(i),this._data.setContainer(i),i.on("mousewheel",function(t,i,s,n){t.preventDefault(),e.uiScroll(n)}),t=!1,i.on("touchstart mousedown",function(s){var n,o,r,a,l,d,u,c;t||((n="mousedown"!==s.type)||1===(s.buttons||s.which))&&(o=e._data.topIndex,isFinite(o)&&(s.touches&&1!==s.touches.length||(r=$(s.target).closest(".tv-dome-widget-main__value--price").eq(0),r.size()&&(t=!0,a=function(t){return t.originalEvent.touches&&t.originalEvent.touches[0]&&t.originalEvent.touches[0].pageY||t.originalEvent.pageY||0},l=a(s),d=i.parents("html").eq(0),u=function i(){d.off("mouseup mousedown touchend touchstart touchcancel",i),d.off("mousemove touchmove",c),t=!1,e._data.setDragShield(!1),e._mergeTimerLockState({scroll:!1})},c=function(t){var i,s;if(!n&&1!==(t.buttons||t.which))return void u();t.preventDefault(),i=a(t)-l,s=Math.round(i/w),s&&(e._data.setDragShield(!0),e._mergeTimerLockState({scroll:!0})),e._data.shiftTopIndexRelativeToIndex(o,s)},d.on(n?"touchmove":"mousemove",c),d.on(n?"touchend":"mouseup",u),n&&d.on("touchcancel",u),setTimeout(function(){t&&d.on(n?"touchstart":"mousedown",u)},0)))))}),i.on("dblclick",function(t){$(t.target).closest(".tv-dome-widget-main__value--price").eq(0).size()&&e.uiCenter()}),this._$mainBlock=i}},{key:"_createActionsBlock",value:function(){var t=this,e=this._$container
;this._$actionsBlock=$("<div>",e).addClass("tv-dome-widget-actions").html('<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--primary tv-button--size_small js-buy-mkt apply-common-tooltip" title="Shift+B">Buy Market</div>\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--danger tv-button--size_small js-sell-mkt apply-common-tooltip" title="Shift+S">Sell Market</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-buttons-group tv-buttons-group--primary tv-buttons-group--size-small">\n\t\t\t\t\t\t\t<div class="tv-buttons-group__option tv-buttons-group__option--padding_small js-day"><span class="tv-buttons-group__option--content apply-overflow-tooltip">DAY</span></div>\n\t\t\t\t\t\t\t<div class="tv-buttons-group__option tv-buttons-group__option--padding_small js-gtc"><span class="tv-buttons-group__option--content apply-overflow-tooltip">GTC</span></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-flatten apply-overflow-tooltip">Flatten</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="tv-dome-widget-actions__row">\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-clear apply-overflow-tooltip">CXL All</div>\n\t\t\t\t\t\t<div class="tv-dome-widget-actions__elem tv-button tv-button--default tv-button--size_small js-reverse apply-overflow-tooltip">Reverse</div>\n\t\t\t\t\t</div>'),this._actionButtons={$buyMarket:this._$actionsBlock.find(".js-buy-mkt").on("click",function(e){e.preventDefault(),t.uiPlaceOrder({side:_.SIDE.BUY,type:_.ORDERTYPE.MARKET})}),$sellMarket:this._$actionsBlock.find(".js-sell-mkt").on("click",function(e){e.preventDefault(),t.uiPlaceOrder({side:_.SIDE.SELL,type:_.ORDERTYPE.MARKET})}),$day:this._$actionsBlock.find(".js-day").html('<span class="tv-buttons-group__option--content apply-overflow-tooltip">'+$.t("DAY")+"</span>").on("click",function(e){e.preventDefault(),t._uiState.isTradable&&(t._trackEvent("Select DAY"),t._mergeUiState({gtcOrder:!1}))}),$gtc:this._$actionsBlock.find(".js-gtc").html('<span class="tv-buttons-group__option--content apply-overflow-tooltip">'+$.t("GTC")+"</span>").on("click",function(e){e.preventDefault(),t._uiState.isTradable&&(t._trackEvent("Select GTC"),t._mergeUiState({gtcOrder:!0}))}),$flatten:this._$actionsBlock.find(".js-flatten").text($.t("Flatten")).on("click",function(e){e.preventDefault(),t.uiClosePosition()}),$clear:this._$actionsBlock.find(".js-clear").text($.t("CXL All")).on("click",function(e){e.preventDefault(),t.uiCancelAllOrders()}),$reverse:this._$actionsBlock.find(".js-reverse").text($.t("Reverse")).on("click",function(e){e.preventDefault(),t.uiReversePosition()})},this._$actionsBlock.appendTo(this._$container)}},{key:"_createCalculatorBlock",value:function(){
this._$calculatorBlock=$("<div>",this._$container).addClass("tv-dome-widget-actions").appendTo(this._$container),this._calcData.setContainer(this._$calculatorBlock)}},{key:"_createLegendBlock",value:function(){var t=this._$container,e=$("<div>",this._$container).addClass("tv-dome-widget-legend");$("<span>",t).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--buy").text($.t("Buy")).appendTo(e),$("<span>",t).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--price").text($.t("Price")).appendTo(e),$("<span>",t).addClass("tv-dome-widget-legend__label tv-dome-widget-legend__label--sell").text($.t("Sell")).appendTo(e),this._$legendBlock=e,e.appendTo(this._$container)}},{key:"_createNavBlock",value:function(){var t,e=this,s=this._$container,n=$("<div>",s).addClass("tv-dome-widget-nav").html('<div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--orders"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--clear-ask js-clear-ask">'+i(266)+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--buysell"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--scroll-up js-scroll-up">'+i(1424)+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--price"><svg class="tv-dome-widget-nav__timer" viewBox="-1 -1 2 2" width="2" height="2"><path d="M 0,0" class="js-timer-path"></path></svg><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--center js-center">'+i(1530)+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--buysell"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--scroll-down js-scroll-down">'+i(1425)+'</span></div><div class="tv-dome-widget-nav__button-block tv-dome-widget-nav__button-block--orders"><span class="tv-dome-widget-nav__button tv-dome-widget-nav__button--clear-bid js-clear-bid">'+i(266)+"</span></div>");this._$navBlock=n,this._$svgTimerPath=n.find(".js-timer-path"),this._navButtons={$clearBuy:n.find(".js-clear-ask").addClass("apply-common-tooltip").attr("title",$.t("Cancel all buy orders")).on("click",function(t){t.preventDefault(),e.uiCancelAllOrders(_.SIDE.BUY)}),$clearSell:n.find(".js-clear-bid").addClass("apply-common-tooltip").attr("title",$.t("Cancel all sell orders")).on("click",function(t){t.preventDefault(),e.uiCancelAllOrders(_.SIDE.SELL)}),$scrollUp:n.find(".js-scroll-up").addClass("apply-common-tooltip").attr("title",$.t("Scroll up")).on("click",function(t){t.preventDefault(),e.uiScroll(1)}),$scrollDown:n.find(".js-scroll-down").addClass("apply-common-tooltip").attr("title",$.t("Scroll down")).on("click",function(t){t.preventDefault(),e.uiScroll(-1)}),$centerView:n.find(".js-center").addClass("apply-common-tooltip").attr("title",$.t("Center view")).on("click",function(t){t.preventDefault(),e.uiCenter()})},n.appendTo(s),t=n.prop("ownerDocument"),this._timer.setWindow(t&&t.defaultView)}},{key:"_syncActionButtons",value:function(){
var t,e,i,s,n,o,r=this._uiState,a=r.isTradable,l=r.hasPosition,d=r.hasBuyOrders,u=r.hasSellOrders,c=r.qty,h=r.gtcOrder;this._actionButtons&&(t=this._actionButtons,e="i-active",i="i-disabled",t.$gtc.toggleClass(e,!!this._hasDayGTC&&!!h&&a),t.$day.toggleClass(e,!!this._hasDayGTC&&!h&&a),t.$gtc.toggleClass(i,!this._hasDayGTC||!a),t.$day.toggleClass(i,!this._hasDayGTC||!a),t.$flatten.toggleClass(i,!a||!l||!this._hasFlatten),t.$reverse.toggleClass(i,!a||!l||!this._hasReverse),t.$clear.toggleClass(i,!a||!(d||u)),c&&a?(s=(0,b.abbreviatedNumber)(c),t.$buyMarket.text($.t("Buy {0} Market").format(s)),t.$sellMarket.text($.t("Sell {0} Market").format(s))):(t.$buyMarket.text($.t("Buy Market")),t.$sellMarket.text($.t("Sell Market")))),this._navButtons&&(n=this._navButtons,o="tv-dome-widget-nav__button--disabled",n.$clearBuy.toggleClass(o,!a||!d),n.$clearSell.toggleClass(o,!a||!u))}},{key:"_calculateLayout",value:function(){var t,e,i,s,n,o=this._height.value(),r=!1,a=[{$element:this._$actionsBlock,height:131},{$element:this._$navBlock,height:46},{$element:this._$calculatorBlock,height:49},{$element:this._$legendBlock,height:40}];for(t=0;t<a.length;t++)e=a[t],i=e.$element,s=e.height,r||(o-s<100?r=!0:o-=s),r?i.addClass("js-hidden"):i.css("height",s).removeClass("js-hidden");this._$mainBlock.css("height",o),n=Math.ceil(o/w),this._data.setHeight(n)}},{key:"uiScroll",value:function(t){this._data.shiftTopIndexRelativeToIndex(this._data.topIndex,0|t),this._timer.revert()}},{key:"uiCenter",value:function(){this._data.centerOnLast(),this._trackEvent("Center")}},{key:"uiCancelOrder",value:function(t){this._uiState.isTradable&&(this._realtimeProvider.activeBroker().cancelOrder(t,!0),this._trackEvent("Cancel Order"))}},{key:"uiModifyOrder",value:function(t,e){var i,s,n=this._realtimeProvider.activeBroker();return!1!==n.metainfo().configFlags.supportModifyOrder&&t&&this._uiState.isTradable?(i=!0,null==e&&(e={},i=!1),s=n.modifyOrder(u({},t,e),i),this._lockTimerUntilSettled(s),this._trackEvent("Modify Order"),s):Promise.resolve()}},{key:"uiPlaceOrder",value:function(t){var e,i,s,n=t.side,o=t.price,r=t.altPrice,a=t.type,l=t.inverseType,d=this._realtimeProvider.activeBroker(),u=this;if(!d)return void u._trading.toggleTradingWidget().then(function(){u._trading.onNeedSelectBroker.fire()});if(null===this._subscription.broker)return void u._trading.toggleTradingWidget();if(a===_.ORDERTYPE.MARKET||isFinite(o))return null==a&&(a=this._data.guessOrderType(o,n)),e=!0,null==a&&(e=!1,a=_.ORDERTYPE.LIMIT),l&&(a===_.ORDERTYPE.STOP?a=_.ORDERTYPE.LIMIT:a===_.ORDERTYPE.LIMIT&&(a=_.ORDERTYPE.STOP)),i={symbol:k.proSymbol.value(),qty:this._calcData.getQty(),side:n,type:a,duration:this._hasDayGTC?{type:this._uiState.gtcOrder?"GTC":"DAY"}:void 0},null!=i.type&&(i.type===_.ORDERTYPE.STOP?i.stopPrice=o:i.type===_.ORDERTYPE.LIMIT?i.limitPrice=o:i.type===_.ORDERTYPE.STOPLIMIT&&(i.stopPrice=o,isFinite(r)?i.limitPrice=r:e=!1)),s=d.placeOrder(i,e),this._lockTimerUntilSettled(s),this._trackEvent("Place Order"),s}},{key:"uiCancelAllOrders",value:function(t){
var e,i=this._uiState;return!i.isTradable||!i.hasBuyOrders&&!i.hasSellOrders||t===_.SIDE.BUY&&!i.hasBuyOrders||t===_.SIDE.SELL&&!i.hasSellOrders?Promise.resolve():(e=this._realtimeProvider.activeBroker().cancelOrders(k.proSymbol.value(),t),this._lockTimerUntilSettled(e),t?this._trackEvent("Cancel All "+(1===t?"Buy":"Sell")+" Orders"):this._trackEvent("Cancel All Orders"),e)}},{key:"uiClosePosition",value:function(){var t,e;return this._uiState.isTradable&&this._uiState.hasPosition&&this._hasFlatten?(t=this._realtimeProvider.activeBroker(),e=t.positions(k.proSymbol.value()).then(function(e){var i,s;for(i=0;i<e.length;i++)if(s=e[i],0!==s.qty)return t.closePosition(s.id,!0)}),this._lockTimerUntilSettled(e),this._trackEvent("Close Position"),e):Promise.resolve()}},{key:"uiReversePosition",value:function(){var t,e;return this._uiState.isTradable&&this._uiState.hasPosition&&this._hasReverse?(t=this._realtimeProvider.activeBroker(),e=t.positions(k.proSymbol.value()).then(function(e){var i,s;for(i=0;i<e.length;i++)if(s=e[i],0!==s.qty)return t.reversePosition(s.id,!0)}),this._lockTimerUntilSettled(e),this._trackEvent("Reverse"),e):Promise.resolve()}},{key:"uiOrderMousedown",value:function(t,e,i){var s,n,r,a,l,d,u,c=this;1===(t.buttons||t.which)&&(s=e[i],n=this._data.priceToIndex(e[i]),isFinite(n)&&(this.uiStopOrderDrag(),r=function(t){return t.touches&&t.touches[0]&&t.touches[0].pageY||t.pageY||0},a=r(t),l=NaN,d=!1,u=this._subscription,u.$orderMouseRoot=this._$mainBlock.parents("html").eq(0),u.orderMousemoveHandler=function(t){var o,u,h;if(t.preventDefault(),1!==(t.buttons||t.which))return void c.uiStopOrderDrag();o=0,$(t.target).closest(c._$mainBlock).size()&&(o=a-r(t)),u=Math.round(o/w),0===u?l=s:(h=c._data.correctIndex(n,u),l=c._data.indexToPrice(h),d=!0,c._data.setDragShield(!0),c._mergeTimerLockState({drag:!0})),d&&c._data.setOrderGhost({order:e,pricePropertyName:i,price:l})},u.orderMouseupHandler=function(t){c.uiStopOrderDrag(),c._realtimeProvider.activeBroker()&&isFinite(l)&&l!==s&&(c._data.setOrderGhost({order:e,pricePropertyName:i,price:l}),c._data.setDragShield(!0),c._trackEvent("Move Order"),c.uiModifyOrder(e,o({},i,l)).then(function(){return c.uiStopOrderDrag()}).catch(function(){return c.uiStopOrderDrag()}))},u.orderMousedownHandler=function(t){c.uiStopOrderDrag()},u.$orderMouseRoot.on("mousemove",u.orderMousemoveHandler),u.$orderMouseRoot.on("mouseup",u.orderMouseupHandler),setTimeout(function(){u.$orderMouseRoot.on("mousedown",u.orderMousedownHandler)},0)))}},{key:"uiStopOrderDrag",value:function(){if(this._data.setDragShield(!1),this._data.resetOrderGhost(),this._mergeTimerLockState({drag:!1}),this._subscription){var t=this._subscription,e=t.orderMousemoveHandler,i=t.orderMouseupHandler,s=t.orderMousedownHandler,n=t.$orderMouseRoot;delete this._subscription.orderMousemoveHandler,delete this._subscription.orderMouseupHandler,delete this._subscription.orderMousedownHandler,delete this._subscription.$orderMouseRoot,n&&e&&n.off("mousemove",e),n&&i&&n.off("mouseup",i),n&&s&&n.off("mousedown",s)}}},{
key:"uiContextMenu",value:function(t,e,s){var n,o,r,a,l,d,u,c,h,p,v,f,y,g,w,P,T,x,I,S=this;this._uiState.isTradable&&(e!==_.SIDE.BUY&&e!==_.SIDE.SELL||(n=k.seriesShortSymbol.value()||k.proSymbol.value(),o=(0,b.abbreviatedNumber)(this._uiState.qty),r=i(39).Action,a=[],l=this._symbolData&&this._symbolData.priceFormatter||new m.PriceFormatter,this._trackEvent("Context Menu"),isFinite(s)&&(d=l.format(s),u={stopPrice:d,qty:o,symbol:n},c="",c=e===_.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __stopPrice__ Stop",u):$.t("Sell __qty__ __symbol__ @ __stopPrice__ Stop",u),h=new r({text:c}),h.callbacks().subscribe(null,function(){S.uiPlaceOrder({side:e,price:s,type:_.ORDERTYPE.STOP})}),a.push(h),p={limitPrice:d,qty:o,symbol:n},v="",v=e===_.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __limitPrice__ Limit",p):$.t("Sell __qty__ __symbol__ @ __limitPrice__ Limit",p),f=new r({text:v}),f.callbacks().subscribe(null,function(){S.uiPlaceOrder({side:e,price:s,type:_.ORDERTYPE.LIMIT})}),a.push(f),this._symbolData&&this._hasStopLimit&&(y=s+this._symbolData.minTick*(e===_.SIDE.BUY?1:-1),g={stopPrice:d,limitPrice:l.format(y),qty:o,symbol:n},w="",w=e===_.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ __stopPrice__ Stop __limitPrice__ Limit",g):$.t("Sell __qty__ __symbol__ @ __stopPrice__ Stop __limitPrice__ Limit",g),P=new r({text:w}),P.callbacks().subscribe(null,function(){S.uiPlaceOrder({side:e,price:s,altPrice:y,type:_.ORDERTYPE.STOPLIMIT})}),a.push(P))),T={qty:o,symbol:n},x="",x=e===_.SIDE.BUY?$.t("Buy __qty__ __symbol__ @ Market",T):$.t("Sell __qty__ __symbol__ @ Market",T),I=new r({text:x}),I.callbacks().subscribe(null,function(){S.uiPlaceOrder({side:e,type:_.ORDERTYPE.MARKET})}),a.push(I),a.length&&i(73).createMenu(a).show(t)))}},{key:"_mergeUiState",value:function(t){var e,i=this._uiState,s=!1;for(e in t)i!==t[e]&&(i[e]=t[e],s=!0);s&&this._syncActionButtons()}},{key:"_handlers",value:function(){var t=this;return{closeButtonClick:function(e,i){var s=i.order;e.preventDefault(),t.uiCancelOrder(s&&s.id)},qtyClick:function(e,i){var s=i.order;e.preventDefault(),t.uiModifyOrder(s)},bidAskClick:function(e,i){var s=i.side,n=i.price;e.preventDefault(),t.uiPlaceOrder({side:s,price:n,inverseType:!!e.ctrlKey})},bidAskContextMenu:function(e,i){var s=i.side,n=i.price;e.preventDefault(),t.uiContextMenu(e,s,n)},qtyChange:function(e,i){var s=i.qty;!isFinite(s)||s<0||t._trading.suggestedQty().setValue(k.proSymbol.value(),s)},qtyInput:function(e,i){var s=i.qty;!isFinite(s)||s<0||t._mergeUiState({qty:s})},orderMousedown:function(e,i){var s=i.order,n=i.pricePropertyName;t.uiOrderMousedown(e,s,n)}}}},{key:"_mergeTimerLockState",value:function(t){var e,i=this._timerLockState,s=!1;for(e in t)i[e]!==t[e]&&(i[e]=t[e],s=!0);s&&(!i.autoCenterRequired||i.scroll||i.drag||i.dialog?this._timer.abort():this._timer.run())}},{key:"_lockTimerUntilSettled",value:function(t){var e,i=this;if(t)return this._mergeTimerLockState({dialog:t}),e=function(){i._timerLockState.dialog===t&&i._mergeTimerLockState({dialog:null})},t.then(e,e)}},{key:"_updateTimerUi",value:function(t){t=t||0,
this._$svgTimerPath.attr("d",(0,y.pieChartD)(t))}},{key:"_getSymbolData",value:function(){function t(t,i){return e.apply(this,arguments)}var e=n(l.default.mark(function t(e,i){var s,n,o,r,a;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([this._realtimeProvider.symbolInfo(i),this._realtimeProvider.formatter(i)]);case 2:return s=t.sent,n=d(s,2),o=n[0],r=n[1],a=void 0!==o.domVolumePrecision?new f.VolumeFormatter(o.domVolumePrecision):new f.VolumeFormatter,t.abrupt("return",{minTick:o.minTick,priceFormatter:r,volumeFormatter:a,qtyProperties:o.qty});case 8:case"end":return t.stop()}},t,this)}));return t}()},{key:"_unsubscribeData",value:function(){if(this._subscription){var t=this._subscription,e=t.broker,i=t.symbol,s=t.domeHandler,n=t.realtimeHandler,o=t.orderHandler,r=t.positionHandler,a=t.plHandler,l=t.plPositionId,d=t.suggestedQtyHandler,u=t.fullUpdateOrders,c=t.fullUpdatePosition;this._subscription=null,i&&n&&this._realtimeProvider.unsubscribeRealtime(i,n),i&&s&&this._realtimeProvider.unsubscribeDOME(i,s),e&&o&&e.orderUpdate.unsubscribe(null,o),e&&r&&e.positionUpdate.unsubscribe(null,r),e&&a&&l&&e.unsubscribePL(l,a),d&&this._trading.suggestedQty().changed.unsubscribe(null,d),e&&u&&e.fullUpdate.unsubscribe(u),e&&c&&e.fullUpdate.unsubscribe(c)}}},{key:"_trackEvent",value:function(t){this._trading.trackEvent("DOM",t)}},{key:"_processOrders",value:function(t){var e,i,s=[],n=!1,o=!1;for(e=0;e<t.length;e++)if(i=t[e],i.status===_.ORDERSTATUS.PLACING||i.status===_.ORDERSTATUS.INACTIVE||i.status===_.ORDERSTATUS.WORKING)switch(s.push(i),i.side){case _.SIDE.BUY:n=!0;break;case _.SIDE.SELL:o=!0}this._data.updateOrders(s),this._mergeUiState({hasBuyOrders:n,hasSellOrders:o})}},{key:"_processPositions",value:function(t,e,i){var s=this,n=i.filter(function(t){return 0!==t.qty})[0];this._mergeUiState({hasPosition:!!n}),n&&n.id===e.plPositionId||e.plPositionId&&e.plHandler&&(t.unsubscribePL(e.plPositionId,e.plHandler),delete e.plPositionId,delete e.plHandler),n&&(e.plPositionId===n.id&&e.plHandler||(e.plHandler=function(t,i){s._subscription===e&&s._calcData.updatePL(i)},e.plPositionId=n.id,t.subscribePL(e.plPositionId,e.plHandler))),this._data.updatePosition(n),this._calcData.updatePosition(n)}},{key:"_onStateChange",value:function(){function t(){return e.apply(this,arguments)}var e=n(l.default.mark(function t(){var e,i,s,n,o,r,a,d,u=this;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._visible.value()){t.next=3;break}return this._unsubscribeData(),t.abrupt("return");case 3:if(e=k.proSymbol.value(),i=this._realtimeProvider.activeBroker(),this._noDataTimeout&&clearTimeout(this._noDataTimeout),this._noDataTimeout=setTimeout(function(){return u._$warning.toggleClass("i-hidden",!1)},T),this._symbolData=null,this._unsubscribeData(),this._data.reset(),this._calcData.reset(),s=i&&i.metainfo().durations,this._hasDayGTC=!!(s&&s.find(function(t){return"DAY"===t.value})&&s.find(function(t){return"GTC"===t.value})),
this._hasReverse=i&&i.metainfo().configFlags.supportReversePosition,this._hasFlatten=i&&!i.metainfo().configFlags.supportMultiposition,this._hasStopLimit=i&&i.metainfo().configFlags.supportStopLimitOrders,this._mergeUiState({isTradable:!1,hasPosition:!1,hasBuyOrders:!1,hasSellOrders:!1,qty:void 0}),this._mergeTimerLockState({scroll:!1,drag:!1,dialog:null}),this.uiStopOrderDrag(),n=[],o=[],e){t.next=23;break}return t.abrupt("return");case 23:return r={broker:i,symbol:e,domeHandler:null,realtimeHandler:null,orderHandler:null,positionHandler:null,plHandler:null,plPositionId:void 0,suggestedQtyHandler:null,fullUpdateOrders:null,fullUpdatePosition:null},this._subscription=r,r.suggestedQtyHandler=function(){u._trading.suggestedQty().value(e).then(function(t){u._subscription===r&&(u._calcData.updateQty(t),u._mergeUiState({qty:t}))})},this._trading.suggestedQty().changed.subscribe(null,r.suggestedQtyHandler),r.suggestedQtyHandler(),t.next=30,this._getSymbolData(i,e);case 30:if(a=t.sent){t.next=33;break}return t.abrupt("return");case 33:if(this._subscription===r){t.next=35;break}return t.abrupt("return");case 35:return this._symbolData=a,this._data.setSymbolInfo(a),this._calcData.setSymbolInfo(a),r.realtimeHandler=function(t,e){var i=e.trade||e.bid||e.ask;i&&u._noDataTimeout&&(u._$warning.toggleClass("i-hidden",!0),clearTimeout(u._noDataTimeout),u._noDataTimeout=null),u._data.updateLast(i),u._calcData.updateLast(i)},r.domeHandler=function(t,e){u._data.updateData(e)},t.next=42,this._realtimeProvider.isTradable(e);case 42:d=t.sent,this._mergeUiState({isTradable:d}),this._realtimeProvider.subscribeRealtime(e,r.realtimeHandler),this._realtimeProvider.subscribeDOME(e,r.domeHandler),i&&d&&(r.orderHandler=function(t){if(t.symbol===r.symbol){var e=n.findIndex(function(e){return e.id===t.id});-1!==e?n[e]=t:n.push(t),u._processOrders(n)}},r.positionHandler=function(t){if(t.symbol===r.symbol){var e=o.findIndex(function(e){return e.id===t.id});-1!==e?o[e]=t:o.push(t),u._processPositions(i,r,o)}},r.fullUpdateOrders=function(){var t=i.orders(e);r.orderPromise=t,t.then(function(e){u._subscription===r&&r.orderPromise===t&&(n=e,u._processOrders(e))})},r.fullUpdatePosition=function(){var t=i.positions(e);r.positionPromise=t,t.then(function(e){u._subscription===r&&r.positionPromise===t&&(o=e,u._processPositions(i,r,e))})},i.orderUpdate.subscribe(null,r.orderHandler),i.positionUpdate.subscribe(null,r.positionHandler),i.fullUpdate.subscribe(null,r.fullUpdateOrders),i.fullUpdate.subscribe(null,r.fullUpdatePosition),r.fullUpdateOrders(),r.fullUpdatePosition());case 47:case"end":return t.stop()}},t,this)}));return t}()}]),t}()},1357:function(t,e){},1424:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 7a1 1 0 0 1-1-1c0-.276.1-.538.28-.72l5-5C5.463.1 5.725 0 6 0c.276 0 .538.1.72.28l5 5c.18.182.28.444.28.72a1 1 0 0 1-1 1c-.276 0-.538-.1-.72-.28L6 2.437l-4.28 4.28C1.537 6.9 1.275 7 1 7z"/></svg>'},1425:function(t,e){
t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 7" width="12" height="7"><path d="M1 0a1 1 0 0 0-1 1c0 .276.1.538.28.72l5 5c.182.18.444.28.72.28.276 0 .538-.1.72-.28l5-5c.18-.182.28-.444.28-.72a1 1 0 0 0-1-1c-.276 0-.538.1-.72.28L6 4.563 1.72.282C1.537.1 1.275 0 1 0z"/></svg>'},1519:function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n,o,r,a;Object.defineProperty(e,"__esModule",{value:!0}),e.DomeData=void 0,n=function(){function t(t,e){var i,s;for(i=0;i<e.length;i++)s=e[i],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=i(1520),r=i(96),a=i(16),e.DomeData=function(){function t(e,i){s(this,t),this._handlers=e||{},this._showPricesWithZeroVolume=i,this.autoCenterRequired=new a(!1),this.height=0,this.topIndex=NaN,this._$container=null,this._$listContainer=null,this._symbolData=null,this._lastPriceIndex=NaN,this._viewAllocated=null,this._viewPool=null,this._invalidatedAsk={},this._invalidatedBid={},this._invalidatedPriceHighlight={},this._invalidatedMax=!1,this._invalidatedOrders={},this._showPricesWithZeroVolume.subscribe(this.scheduleRepaint.bind(this)),this.reset()}return n(t,[{key:"reset",value:function(){this.topIndex=NaN,this._symbolData=null,this._lastPriceIndex=NaN,this.resetData(),this.resetView(),this.resetOrders(),this.resetOrderGhost(),this.resetPosition(),this.autoCenterRequired.setValue(!1)}},{key:"resetData",value:function(){if(this._bids={},this._asks={},this._recalcMaxVolume(),this._recalcBestWorstBid(),this._recalcBestWorstAsk(),this._viewAllocated)for(var t in this._viewAllocated)this._invalidatedAsk[t]=!0,this._invalidatedBid[t]=!0;$(this._$offscreenArrowHigher).addClass("js-hidden"),$(this._$offscreenArrowLower).addClass("js-hidden"),this._offscreenPriceHigher=!1,this._offscreenPriceLower=!1,this.scheduleRepaint()}},{key:"resetOrders",value:function(){if(this._orders)for(var t in this._orders)this._invalidatedOrders[t]=!0;this._orders={},this.scheduleRepaint()}},{key:"resetPosition",value:function(){this._invalidatedPriceHighlight[this._positionIndex]=!0,this._positionIndex=NaN,this._positionQty=0,this.scheduleRepaint()}},{key:"resetView",value:function(){if(this._viewAllocated&&this._viewPool)for(var t in this._viewAllocated)this._viewAllocated[t].$element.detach(),this._viewPool.free(this._viewAllocated[t]),delete this._viewAllocated[t];this._$listContainer&&this._$listContainer.empty(),this.setDragShield(!1),this.scheduleRepaint()}},{key:"setSymbolInfo",value:function(t){var e=t.minTick,i=t.priceFormatter,s=t.volumeFormatter;this._symbolData={minTick:e,priceFormatter:i,volumeFormatter:s}}},{key:"setContainer",value:function(t){if(this._$container!==t){this._$container&&(this.resetView(),this._$container.empty()),this._$container=t;var e=t.prop("ownerDocument");this._containerWnd=e&&e.defaultView,this._viewPool=new o.DomeRowViewPool(t,this._handlers),this._viewAllocated={},
this._$listContainer=$("<div>",t).addClass("tv-dome-widget-main__anchor").appendTo(t),this._$offscreenArrowHigher=$("<span>",t).addClass("tv-dome-widget-main__offscreen-arrow tv-dome-widget-main__offscreen-arrow--higher js-hidden").html(i(1424)).appendTo(t),this._$offscreenArrowLower=$("<span>",t).addClass("tv-dome-widget-main__offscreen-arrow tv-dome-widget-main__offscreen-arrow--lower js-hidden").html(i(1425)).appendTo(t),this._$dragShield=$("<div>",t).addClass("tv-dome-widget-main__drag-shield js-hidden").appendTo(t),this._repaintScheduled=!1,this.scheduleRepaint()}}},{key:"setHeight",value:function(t){t!==this.height&&(this.height=t,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"shiftTopIndexRelativeToIndex",value:function(t,e){var i=this.correctIndex(t,e);this._setTopIndex(i)}},{key:"_setTopIndex",value:function(t){t!==this.topIndex&&(this.topIndex=t,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"_canIndexBeDisplayed",value:function(t){var e,i,s,n,o,r;return!!this._showPricesWithZeroVolume.value()||(e=t===this._lastPriceIndex,i=t===this._positionIndex,s=void 0!==this._bids[t]||void 0!==this._asks[t],n=t<=this._worstBidIndex||this._worstAskIndex<=t,o=this._orders[t]||[],r=this._orderGhost&&this._orderGhost.index===t,i||e||r||n||s||0!==o.length)}},{key:"correctIndex",value:function(t,e){var i,s,n;if(!isFinite(t))return t;if(this._showPricesWithZeroVolume.value())return t+e;for(i=e>0?1:-1,s=0,n=1,e=Math.abs(e);s<e;++n)this._canIndexBeDisplayed(t+i*n)&&(s+=1);return t+i*(n-1)}},{key:"_getGapMiddleIndex",value:function(){var t=this._bestAskIndex,e=this._bestBidIndex;return isFinite(t)||(t=e),isFinite(e)||(e=t),(e+t)/2}},{key:"_autoCenterTargetTopIndex",value:function(){var t=NaN;return t=isFinite(this._lastPriceIndex)?this._lastPriceIndex:this._getGapMiddleIndex(),this.correctIndex(Math.floor(t),Math.floor(this.height/2))}},{key:"centerOnLast",value:function(){this.autoCenterRequired.setValue(!1);var t=this._autoCenterTargetTopIndex();isFinite(t)&&this._setTopIndex(t)}},{key:"guessOrderType",value:function(t,e){var i,s,n=this.priceToIndex(t);if(isFinite(t)&&(e===r.SIDE.BUY||e===r.SIDE.SELL))return i=this._bestAskIndex,s=this._bestBidIndex,isFinite(i)||(i=s+1),isFinite(s)||(s=i-1),isFinite(i)||isFinite(s)||(i=s=this._lastPriceIndex),e===r.SIDE.BUY?n<i?r.ORDERTYPE.LIMIT:r.ORDERTYPE.STOP:n>s?r.ORDERTYPE.LIMIT:r.ORDERTYPE.STOP}},{key:"indexToPrice",value:function(t){return t*this._symbolData.minTick}},{key:"priceToIndex",value:function(t){return this._symbolData?Math.round(t/this._symbolData.minTick):void 0}},{key:"_recalcMaxVolume",value:function(){var t,e,i=0;for(t in this._asks)i=Math.max(this._asks[t],i);for(e in this._bids)i=Math.max(this._bids[e],i);i!==this._currentVolumeMax&&(this._currentVolumeMax=i,this._invalidatedMax=!0)}},{key:"_recalcBestWorstBid",value:function(){var t,e=-1/0,i=1/0;for(t in this._bids)+t>e&&(e=+t),+t<i&&(i=+t);this._bestBidIndex=e,this._worstBidIndex=i}},{key:"_recalcBestWorstAsk",value:function(){var t,e=1/0,i=-1/0;for(t in this._asks)+t<e&&(e=+t),+t>i&&(i=+t)
;this._bestAskIndex=e,this._worstAskIndex=i}},{key:"updateData",value:function(t){var e,i,s,n,o,r,a,l=!1;if(t.snapshot&&(e=0===Object.keys(this._asks).length&&0===Object.keys(this._bids).length,l=!this._showPricesWithZeroVolume.value()&&e,this.resetData()),t.bids){for(i=0;i<t.bids.length;i++)s=this.priceToIndex(t.bids[i].price),n=t.bids[i].volume,(this._bids[s]||0)!==n&&(n>0?this._bids[s]=n:delete this._bids[s],this._invalidatedBid[s]=!0);this._recalcBestWorstBid()}if(t.asks){for(o=0;o<t.asks.length;o++)r=this.priceToIndex(t.asks[o].price),a=t.asks[o].volume,(this._asks[r]||0)!==a&&(a>0?this._asks[r]=a:delete this._asks[r],this._invalidatedAsk[r]=!0);this._recalcBestWorstAsk()}this._recalcMaxVolume(),l?this.centerOnLast():this.checkAutoCenter(),this.scheduleRepaint()}},{key:"updateOrders",value:function(t){var e,i,s,n;for(this.resetOrders(),e=0;e<t.length;e++)i=t[e],null!=i.stopPrice&&(s=this.priceToIndex(i.stopPrice),this._orders[s]||(this._orders[s]=[]),this._orders[s].push({order:i,pricePropertyName:"stopPrice"}),this._invalidatedOrders[s]=!0),null!=i.limitPrice&&(n=this.priceToIndex(i.limitPrice),this._orders[n]||(this._orders[n]=[]),this._orders[n].push({order:i,pricePropertyName:"limitPrice"}),this._invalidatedOrders[n]=!0);this.scheduleRepaint()}},{key:"updateLast",value:function(t){var e=this.priceToIndex(t);e!==this._lastPriceIndex&&(this._invalidatedPriceHighlight[this._lastPriceIndex]=!0,this._invalidatedPriceHighlight[e]=!0,this._lastPriceIndex=e,this.checkAutoCenter(),this.scheduleRepaint())}},{key:"updatePosition",value:function(t){var e,i;if(!t||!t.qty)return void this.resetPosition();e=this.priceToIndex(t.avgPrice),i=Math.abs(t.qty)*(t.side===r.SIDE.BUY?1:-1),this._positionIndex===e&&this._positionQty===i||(this._invalidatedPriceHighlight[this._positionIndex]=!0,this._invalidatedPriceHighlight[e]=!0,this._positionIndex=e,this._positionQty=i,this.scheduleRepaint())}},{key:"resetOrderGhost",value:function(){this._orderGhost&&(this._invalidatedOrders[this._orderGhost.index]=!0,this._invalidatedOrders[this._orderGhost.originIndex]=!0,this._orderGhost=null,this.scheduleRepaint())}},{key:"setOrderGhost",value:function(t){var e,i=t.order,s=t.pricePropertyName,n=t.price;this.resetOrderGhost(),e=this.priceToIndex(n),isFinite(e)&&(this._orderGhost={ghost:!0,order:i,pricePropertyName:s,index:e,originIndex:this.priceToIndex(i[s])},this._invalidatedOrders[e]=!0,this.scheduleRepaint())}},{key:"setDragShield",value:function(t){this._$dragShield&&this._$dragShield.toggleClass("js-hidden",!t)}},{key:"scheduleRepaint",value:function(){var t=this;this._repaintScheduled||this._symbolData&&(this._containerWnd&&this._containerWnd.requestAnimationFrame?this._containerWnd.requestAnimationFrame(function(){return t.repaint()}):window.setTimeout(function(){return t.repaint()},0),this._repaintScheduled=!0)}},{key:"formatVolume",value:function(t){return this._symbolData.volumeFormatter.format(t).slice(0,8)}},{key:"repaint",value:function(){var t,e,i,s,n,o,a,l,d,u,c,h,_,p,v,m,f,y,g,b,k,w,P,T,x,I,S;if(this._repaintScheduled=!1,
this._$listContainer&&this._symbolData&&(t=this.topIndex,this._canIndexBeDisplayed(t)||(t=this.correctIndex(t,-1)),e=this.correctIndex(t,1-this.height),isFinite(e))){for(i=this._viewAllocated,s=Object.keys(this._viewAllocated),n=s.length;n--;)o=s[n],((a=+o)>t||a<e||!this._canIndexBeDisplayed(a))&&(i[o].$element.detach(),this._viewPool.free(i[o]),delete i[o]);for(l=e;l<=t;l++)if(this._canIndexBeDisplayed(l)){if(d=!1,u=i[l],u||(u=this._viewPool.allocate(),i[l]=u,d=!0),c=this._orderGhost,d&&(h=this.indexToPrice(l),u.updateIndex(l),u.updatePrice(h),u.updatePriceText(this._symbolData.priceFormatter.format(h))),(d||this._invalidatedAsk[l])&&(this._asks[l]&&this._asks[l]!==1/0?u.updateAskVolume(this.formatVolume(this._asks[l])):u.updateAskVolume("")),(d||this._invalidatedBid[l])&&(this._bids[l]&&this._bids[l]!==1/0?u.updateBidVolume(this.formatVolume(this._bids[l])):u.updateBidVolume("")),(d||this._invalidatedAsk[l]||this._invalidatedMax)&&u.updateAskMeter(this._asks[l]===1/0?100:this._asks[l]/this._currentVolumeMax||0),(d||this._invalidatedBid[l]||this._invalidatedMax)&&u.updateBidMeter(this._bids[l]===1/0?100:this._bids[l]/this._currentVolumeMax||0),(d||this._invalidatedPriceHighlight[l])&&(_=l===this._lastPriceIndex,p=l===this._positionIndex?this._positionQty:0,u.updatePriceHighlight(_,p)),d||this._invalidatedOrders[l]){for(v=this._orders[l]||[],m=void 0,f=void 0,this._orderGhost&&(c.index===l&&(c.originIndex!==l?v=v.concat(c):f=c.order.id),c.index!==l&&c.originIndex!==l||(m=c.order.side)),y=0;y<v.length;y++){switch(g=v[y],b=g.order,g.inactive=b.status!==r.ORDERSTATUS.WORKING||b.type===r.ORDERTYPE.STOPLIMIT&&"limitPrice"===g.pricePropertyName,b.type){case r.ORDERTYPE.MARKET:g.typeText=$.t("Market"),g.type="market";break;case r.ORDERTYPE.LIMIT:g.typeText=b.parentId?$.t("TakeProfit"):$.t("Limit"),g.type="limit";break;case r.ORDERTYPE.STOP:g.typeText=b.parentId?$.t("StopLoss"):$.t("Stop"),g.type="stop";break;case r.ORDERTYPE.STOPLIMIT:g.typeText=$.t("StopLimit"),g.type="stoplimit";break;default:g.typeText=""}g.qty=this._symbolData.volumeFormatter.format(b.qty),g.buy=b.side===r.SIDE.BUY,g.noCollapse=b.side===m,g.highlighted=null!=f&&b.id===f&&c.pricePropertyName===g.pricePropertyName}u.updateOrders(v)}d&&(k=this.correctIndex(l,-1),i[k]?u.$element.insertBefore(i[k].$element):u.$element.appendTo(this._$listContainer))}isFinite(this._lastPriceIndex)&&(w=this._lastPriceIndex>t,P=this._lastPriceIndex<e,w!==this._offscreenPriceHigher&&(this._offscreenPriceHigher=w,this._$offscreenArrowHigher.toggleClass("js-hidden",!w)),P!==this._offscreenPriceLower&&(this._offscreenPriceLower=P,this._$offscreenArrowLower.toggleClass("js-hidden",!P))),this._invalidatedMax=!1;for(T in this._invalidatedBid)delete this._invalidatedBid[T];for(x in this._invalidatedAsk)delete this._invalidatedAsk[x];for(I in this._invalidatedPriceHighlight)delete this._invalidatedPriceHighlight[I];for(S in this._invalidatedOrders)delete this._invalidatedOrders[S]}}},{key:"checkAutoCenter",value:function(){var t,e,i,s,n;isFinite(this.topIndex)||this.centerOnLast(),
t=this.topIndex,e=this.correctIndex(this.topIndex,1-this.height),i=void 0,i=isFinite(this._lastPriceIndex)?this._lastPriceIndex:isFinite(this._bestBidIndex)?this._bestBidIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:NaN,s=void 0,s=isFinite(this._lastPriceIndex)?this._lastPriceIndex:isFinite(this._bestAskIndex)?this._bestAskIndex:isFinite(this._bestBidIndex)?this._bestBidIndex:NaN,n=!1,(s>t||i<e)&&this.topIndex!==this._autoCenterTargetTopIndex()&&(n=!0),this.autoCenterRequired.setValue(n)}}]),t}()},1520:function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n,o,r,a,l;Object.defineProperty(e,"__esModule",{value:!0}),e.DomeRowViewPool=void 0,n=function(){function t(t,e){var i,s;for(i=0;i<e.length;i++)s=e[i],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),o=i(96),i(1521),e.DomeRowViewPool=function(){function t(e,i){s(this,t),this._pool=[];var n=e.get(0);n.nodeType===Node.DOCUMENT_NODE?this._document=n:this._document=n.ownerDocument,this._handlers=i||{},this._ordersPool=new a(e,this._handlers),this._useCssTransform="transform"in this._document.createElement("span").style}return n(t,[{key:"allocate",value:function(){return this._pool.length?this._pool.pop():new r(this._document,this._ordersPool,this._handlers,this._useCssTransform)}},{key:"free",value:function(t){t.destroy(),this._pool.push(t)}}]),t}(),r=function(){function t(e,i,n,r){var a,l,d,u,c,h,_,p,v,m,f,y,g,b=this;s(this,t),this._useCssTransform=r,this._ordersPool=i,this._handlers=n,this._allocatedOrderViews=[],a=e.createElement("div"),a.setAttribute("class","tv-dome-widget-main__row"),l=e.createElement("span"),l.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--price"),d=e.createElement("span"),d.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--sell"),u=e.createElement("span"),u.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--buy"),c=e.createElement("span"),c.setAttribute("class","tv-dome-widget-main__meter tv-dome-widget-main__meter--sell"),h=e.createElement("span"),h.setAttribute("class","tv-dome-widget-main__meter tv-dome-widget-main__meter--buy"),_=e.createElement("span"),_.setAttribute("class","tv-dome-widget-main__value-readout"),p=e.createElement("span"),p.setAttribute("class","tv-dome-widget-main__value-readout"),v=e.createTextNode(""),m=e.createTextNode(""),f=e.createTextNode(""),this._useCssTransform&&(c.style.width=h.style.width="100%",c.style.transform=h.style.transform="scale(0, 1)"),y=e.createElement("span"),y.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--orders-buy"),g=e.createElement("span"),g.setAttribute("class","tv-dome-widget-main__value tv-dome-widget-main__value--orders-sell"),a.appendChild(d),a.appendChild(u),a.appendChild(l),a.appendChild(y),a.appendChild(g),l.appendChild(f),d.appendChild(c),u.appendChild(h),
d.appendChild(_),u.appendChild(p),_.appendChild(v),p.appendChild(m),this._priceCell=l,this._priceText=f,this._askText=v,this._bidText=m,this._askMeter=c,this._bidMeter=h,this._ordersBuy=y,this._ordersSell=g,n&&n.bidAskClick&&(d.addEventListener("click",function(t){n.bidAskClick.call(null,t,{price:b._price,side:o.SIDE.SELL})},!1),u.addEventListener("click",function(t){n.bidAskClick.call(null,t,{price:b._price,side:o.SIDE.BUY})},!1)),n&&n.bidAskContextMenu&&(d.addEventListener("contextmenu",function(t){n.bidAskContextMenu.call(null,t,{price:b._price,side:o.SIDE.SELL})},!1),u.addEventListener("contextmenu",function(t){n.bidAskContextMenu.call(null,t,{price:b._price,side:o.SIDE.BUY})},!1)),this.$element=$(a)}return n(t,[{key:"updatePriceText",value:function(t){this._priceText.nodeValue=t}},{key:"updateBidVolume",value:function(t){this._bidText.nodeValue=t||""}},{key:"updateAskVolume",value:function(t){this._askText.nodeValue=t||""}},{key:"updateBidMeter",value:function(t){var e=Math.min(Math.max(t,0),1)||0;this._useCssTransform?this._bidMeter.style.transform="scale("+e+", 1)":this._bidMeter.style.width=100*e+"%"}},{key:"updateAskMeter",value:function(t){var e=Math.min(Math.max(t,0),1)||0;this._useCssTransform?this._askMeter.style.transform="scale("+e+", 1)":this._askMeter.style.width=100*e+"%"}},{key:"updatePriceHighlight",value:function(t,e){var i,s=this._priceCell.classList;s?(s.toggle("tv-dome-widget-main__value--highlighted",t),s.toggle("tv-dome-widget-main__value--long-position",e>0),s.toggle("tv-dome-widget-main__value--short-position",e<0)):(i="tv-dome-widget-main__value tv-dome-widget-main__value--price",t&&(i+=" tv-dome-widget-main__value--highlighted"),e>0?i+=" tv-dome-widget-main__value--long-position":e<0&&(i+=" tv-dome-widget-main__value--short-position"),this._priceCell.setAttribute("class",i))}},{key:"updateIndex",value:function(t){this._index=t}},{key:"updatePrice",value:function(t){this._price=t}},{key:"updateOrders",value:function(t){for(var e,i,s,n,o,r;this._allocatedOrderViews.length>t.length;)this._ordersPool.free(this._allocatedOrderViews.pop());for(;this._allocatedOrderViews.length<t.length;)this._allocatedOrderViews.push(this._ordersPool.allocate());for(e=!1,i=!1,s=t.length;s-- >0;)n=t[s],o=this._allocatedOrderViews[s],r=!n.noCollapse&&(n.buy?e:i),o.updateOrderData(n.order,n.pricePropertyName),o.updateQty(n.qty),o.updateTypeText(n.typeText),o.updateClassName(n.buy,r,n.type,n.inactive,n.ghost,n.highlighted),n.buy?(this._ordersBuy.appendChild(o.element),e=!0):(this._ordersSell.insertBefore(o.element,this._ordersSell.firstChild),i=!0)}},{key:"destroy",value:function(){var t,e=this._allocatedOrderViews.length;if(e>0){for(t=0;t<e;t++)this._ordersPool.free(this._allocatedOrderViews[t]);this._allocatedOrderViews.length=0}}}]),t}(),a=function(){function t(e,i){s(this,t),this._pool=[],this._handlers=i;var n=e.get(0);n.nodeType===Node.DOCUMENT_NODE?this._document=n:this._document=n.ownerDocument}return n(t,[{key:"allocate",value:function(){
return this._pool.length?this._pool.pop():new l(this._document,this._handlers)}},{key:"free",value:function(t){t.destroy(),this._pool.push(t)}}]),t}(),l=function(){function t(e,n){var o,r,a,l,d,u,c=this;s(this,t),o=e.createElement("div"),o.setAttribute("class","tv-dome-widget-main__order tv-dome-widget-order"),r=e.createElement("div"),r.innerHTML=i(266),r.setAttribute("class","tv-dome-widget-order__close"),a=e.createElement("span"),a.setAttribute("class","tv-dome-widget-order__qty"),l=e.createTextNode(""),d=e.createElement("span"),d.setAttribute("class","tv-dome-widget-order__type"),u=e.createTextNode(""),o.appendChild(r),o.appendChild(a),a.appendChild(l),o.appendChild(d),d.appendChild(u),n&&n.closeButtonClick&&r.addEventListener("click",function(t){n.closeButtonClick.call(null,t,{order:c._order})},!1),n&&n.qtyClick&&a.addEventListener("click",function(t){n.qtyClick.call(null,t,{order:c._order})},!1),n&&n.orderMousedown&&a.addEventListener("mousedown",function(t){n.orderMousedown.call(null,t,{order:c._order,pricePropertyName:c._pricePropertyName})},!1),this.element=o,this._closeButton=r,this._qtyText=l,this._typeText=u}return n(t,[{key:"updateQty",value:function(t){this._qtyText.nodeValue=t||""}},{key:"updateTypeText",value:function(t){this._typeText.nodeValue=t||""}},{key:"updateClassName",value:function(t,e,i,s,n,o){var r=this.element,a="tv-dome-widget-main__order tv-dome-widget-order";e&&(a+=" tv-dome-widget-main__order--collapsed"),t&&(a+=" tv-dome-widget-order--buy"),i&&(a+=" tv-dome-widget-order--type-"+i),s&&(a+=" tv-dome-widget-order--inactive"),n&&(a+=" tv-dome-widget-order--ghost"),o&&(a+=" tv-dome-widget-order--highlighted"),r.setAttribute("class",a)}},{key:"updateOrderData",value:function(t,e){this._order=t,this._pricePropertyName=e}},{key:"destroy",value:function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this._order=null}}]),t}()},1521:function(t,e){},1522:function(t,e,i){"use strict";function s(t){var e,i;if(t&&t.__esModule)return t;if(e={},null!=t)for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o,r,a,l,d,u;Object.defineProperty(e,"__esModule",{value:!0}),e.DomeCalcBlock=void 0,o=function(){function t(t,e){var i,s;for(i=0;i<e.length;i++)s=e[i],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),i(265),r=i(96),a=i(71),l=i(20),d=s(l),u=i(274),i(1523),e.DomeCalcBlock=function(){function t(e){n(this,t),this._handlers=e||{},this._numericFormatter=new a.NumericFormatter,this._nodes={},this._uiState={plViewType:d.getJSON(u.settingsKeys.PROFIT_VIEW_TYPE,0)},this.reset()}return o(t,[{key:"reset",value:function(){this._position=void 0,this._pl=void 0,this._lastPrice=void 0,this._symbolData=null,this.updateQty(1),this._positionInvalidated=!0,this._plInvalidated=!0,this._lastInvalidated=!0,this.scheduleRepaint()}},{
key:"setSymbolInfo",value:function(t){var e=this,i=t.minTick,s=t.priceFormatter,n=t.volumeFormatter,o=t.qtyProperties;this._symbolData={minTick:i,priceFormatter:s,volumeFormatter:n},this._$qty.TVTicker({min:o.min,step:o.step,max:o.max,format:function(t){return e._numericFormatter.format(t)}})}},{key:"updatePosition",value:function(t){this._position=t,this._position||(this._pl=void 0),this._positionInvalidated=!0,this._plInvalidated=!0,this.scheduleRepaint()}},{key:"updatePL",value:function(t){this._pl=t,this._position&&(this._plInvalidated=!0,this.scheduleRepaint())}},{key:"updateLast",value:function(t){this._lastPrice=t,this._position&&(1!==this._uiState.plViewType&&2!==this._uiState.plViewType||(this._plInvalidated=!0,this.scheduleRepaint()))}},{key:"updateQty",value:function(t){var e,i;this._suggestedQty=t,e=this._numericFormatter.format(t),(i=this._nodes.$qty)&&i.val()!==e&&i.val(e)}},{key:"getQty",value:function(){var t=parseFloat(this._nodes.$qty.val());return!isFinite(t)||t<0?NaN:t}},{key:"setContainer",value:function(t){var e,i,s,n,o,r,a,l=this;if(this._nodes.$container){this._nodes.$container.empty();for(e in this._nodes)delete this._nodes[e]}delete this._plDirectionCache,delete this._plTextCache,t&&(t.empty().addClass("tv-dome-calc-block").html('<div class="tv-dome-widget-calculator tv-dome-calc-block"><div class="tv-dome-calc-block__wrap"><div class="tv-dome-calc-block__qty-wrap"><input class="tv-dome-calc-block__qty tv-text-input js-qty"></div><span class="tv-dome-calc-block__position js-position"></span><span class="tv-dome-calc-block__pl js-pl"></span></div></div>'),i=t.prop("ownerDocument"),s=i.createTextNode(""),n=i.createTextNode(""),o=this._$qty=t.find(".js-qty").val(this._qty||1).addClass("apply-common-tooltip").attr("title",$.t("Quantity")),r=t.find(".js-position").addClass("apply-common-tooltip").attr("title",$.t("Position")).append(n),a=t.find(".js-pl").addClass("apply-common-tooltip").attr("title",$.t("Profit/Loss")).append(s),this._nodes={$container:t,$qty:o,$position:r,$pl:a,plText:s,positionText:n},r.on("click",function(t){t.preventDefault();var e=Math.abs(l._position&&l._position.qty);e>0&&isFinite(e)&&(l.updateQty(e),o.trigger("change"))}),o.on("change",function(t){l._handlers&&l._handlers.qtyChange&&(o.val(o.val().replace(/[^\d\.]+/g,"")||l._suggestedQty||"1"),l._handlers.qtyChange.call(null,t,{qty:l.getQty()}))}),o.on("keypress",function(t){t.charCode&&/[^\d\.]/.test(String.fromCharCode(t.charCode))&&t.preventDefault()}),this._handlers&&this._handlers.qtyInput&&o.on("input",function(t){l._handlers.qtyInput.call(null,t,{qty:l.getQty()})}),a.on("click",function(t){t.preventDefault(),l._uiState.plViewType=-~l._uiState.plViewType%3,l._plInvalidated=!0,d.setValue(u.settingsKeys.PROFIT_VIEW_TYPE,l._uiState.plViewType),l.scheduleRepaint()}),o.TVTicker({min:1,step:1})),this._positionInvalidated=!0,this._plInvalidated=!0,this.scheduleRepaint()}},{key:"scheduleRepaint",value:function(){var t=this;this._repaintScheduled||(window.requestAnimationFrame?window.requestAnimationFrame(function(){
return t.repaint()}):window.setTimeout(function(){return t.repaint()},0),this._repaintScheduled=!0)}},{key:"repaint",value:function(){var t,e,i,s,n,o,a,l;this._repaintScheduled=!1,t=this._nodes,t.$container&&(this._positionInvalidated&&(this._positionInvalidated=!1,e=this._position&&this._position.qty||0,0===e?t.positionText.nodeValue=$.t("Flat"):(i=Math.abs(e),s=void 0,s=this._symbolData&&this._symbolData.volumeFormatter?this._symbolData.volumeFormatter.format(i):i+"",t.positionText.nodeValue=s),t.$position.toggleClass("tv-dome-calc-block__position--short",e<0).toggleClass("tv-dome-calc-block__position--long",e>0)),this._plInvalidated&&(this._plInvalidated=!1,n=0,o="",2===this._uiState.plViewType?(a=NaN,this._position&&(a=(this._lastPrice-this._position.avgPrice)/this._position.avgPrice*(this._position.side===r.SIDE.SELL?-1:1)),isFinite(a)?(o=(100*a).toFixed(2)+"%",n=a<0?-1:1):o="%"):1===this._uiState.plViewType?(l=NaN,this._position&&this._symbolData&&(l=(this._lastPrice-this._position.avgPrice)*(this._position.side===r.SIDE.SELL?-1:1)/this._symbolData.minTick),isFinite(l)?(o=$.t("{0} pts",{context:"Points"}).format(Math.round(l)),n=l<0?-1:1):o=$.t("Points")):this._position&&isFinite(this._pl)?(o=this._pl.toFixed(2),n=this._pl<0?-1:1):o=$.t("P/L"),this._plTextCache!==o&&(t.plText.nodeValue=o,this._plTextCache=o),this._plDirectionCache!==n&&(t.$pl.toggleClass("tv-dome-calc-block__pl--loss",n<0).toggleClass("tv-dome-calc-block__pl--profit",n>0),this._plDirectionCache=n)))}}]),t}()},1523:function(t,e){},1524:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.pieChartD=function(t){var e="M 0 0";return t>0&&(t>=1?e="M 0 -1":e+="L 0 -1",t>.5&&(e+="A 1 1 0 0 1 0 1"),e+="A 1 1 0 0 1 "+Math.sin(2*t*Math.PI)+" "+-Math.cos(2*t*Math.PI)+"Z"),e}},1525:function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n;Object.defineProperty(e,"__esModule",{value:!0}),n=function(){function t(t,e){var i,s;for(i=0;i<e.length;i++)s=e[i],s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),e.Timer=function(){function t(e,i,n){s(this,t),this._delay=e,this._doneCb=i,this._progressCb=n}return n(t,[{key:"run",value:function(){var t,e=this;this._timeoutId||(t=Date.now?Date.now():+new Date,this._expiresAt=t+this._delay,this._timeoutId=window.setTimeout(function(){e.abort(),e._doneCb()},this._delay),this._trackProgressScheduled||this._trackProgress())}},{key:"revert",value:function(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this.run())}},{key:"abort",value:function(){this._timeoutId&&(window.clearTimeout(this._timeoutId),this._timeoutId=void 0,this._expiresAt=void 0,this._progressCb&&this._progressCb(void 0))}},{key:"_trackProgress",value:function(){var t,e,i=this;this._trackProgressScheduled=!1,this._progressCb&&this._timeoutId&&(t=Date.now?Date.now():+new Date,
e=1-(this._expiresAt-t)/this._delay,e=Math.max(Math.min(e,1),0),this._progressCb(e),this._wnd&&this._wnd.requestAnimationFrame?this._wnd.requestAnimationFrame(function(){i._trackProgress()}):window.setTimeout(function(){i._trackProgress()},40),this._trackProgressScheduled=!0)}},{key:"setWindow",value:function(t){this._wnd=t}}]),t}()},1526:function(t,e){},1527:function(t,e){},1528:function(t,e){},1529:function(t,e){},1530:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" width="15" height="15"><path d="M7 1v3h1V1H7zM1 7v1h3V7H1zm10 0v1h3V7h-3zm-4 4v3h1v-3H7zm.5-11a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15zm0 2a5.5 5.5 0 1 1 0 11 5.5 5.5 0 0 1 0-11z"/></svg>'}});