webpackJsonp([70],{2024:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r,s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(r=function(t,e,n){var r=i(0),a=i(409),l=i(133),h=i(799),c=i(2137),u=["M",0,0],d=function(){function t(e,i,n){o(this,t),this._parent=i,this._xAxis=e.get(h.options.names.axis.mainX),this._yAxis=e.get(h.options.names.axis.mainY),this._chartDrawing=e.chartDrawing,this._renderer=e.renderer,this._pointer=e.pointer,this._options=r.extend({},l(this.fxclientOptions),n)}return s(t,[{key:"defaults",get:function(){return{}}}],[{key:"EMPTY_PATH",get:function(){return u}}]),s(t,[{key:"_init",value:function(){throw Error("unimplemented abstract method")}},{key:"_update",value:function(t,e){throw Error("unimplemented abstract method")}},{key:"_move",value:function(t,e,i,n){throw Error("unimplemented abstract method")}},{key:"_render",value:function(){throw Error("unimplemented abstract method")}},{key:"_destroy",value:function(){throw Error("unimplemented abstract method")}},{key:"_setColor",value:function(t){throw Error("unimplemented abstract method")}},{key:"redraw",value:function(){this.initialized||this.init(),this.update()}},{key:"init",value:function(t){this._init(),t||this.addEvents(),this.initialized=!0}},{key:"update",value:function(t,e,i){var n=new c(e,i);this._update(t,n),this.updatePoints(t,n),this.render(this.options.keyPoints.length)}},{key:"render",value:function(t){this._render(t)}},{key:"setColor",value:function(t){try{this._setColor(t),this.options.properties.line.lineColor=t,this.save()}catch(t){}}},{key:"getColor",value:function(){return this.options.properties.line.lineColor}},{key:"isFinished",value:function(){return!r.isFunction(this._isFinished)||this._isFinished.apply(this,arguments)}},{key:"finalize",value:function(t){this.chartDrawing.finalizeDrawing(t)}},{key:"save",value:function(){this.chartDrawing.saveDrawing()}},{key:"remove",value:function(){this.chartDrawing.removeActiveDrawing()}},{key:"destroy",value:function(){r.each(this.$points,function(t){return t.destroy()});for(var t in this.mouseHandlers)this.mouseHandlers[t]();this._destroy()}},{key:"createG",value:function(){return this.renderer.g("drawing "+this.options.type.replace(/_/g,"-")).attr({zIndex:7}).add(this.parent)}},{key:"createLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$container;return this.renderer.path(t).attr({"stroke-width":this.options.properties.line.lineWidth,stroke:this.getColor(),"pointer-events":"none"}).add(e)}},{key:"createLineHover",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$container;return this.renderer.path(t).attr({class:"hover","stroke-width":1,stroke:"transparent","stroke-linecap":"round"}).add(e)}},{key:"createFilledArea",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:u,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$container;return this.renderer.path(t).attr({class:"filled",fill:this.getColor(),"fill-opacity":"0.4"}).add(e)}},{key:"createLabel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{text:null,x:0,y:0},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$container,i=t.text,n=t.x,o=t.y,r=t.shape,s=t.anchorX,a=t.anchorY,l=t.useHTML,h=t.baseline,c=t.className;return this.renderer.label(i,n,o,r,s,a,l,h,c).css({color:"#000000",fontSize:"10px"}).attr({fill:"rgba(255, 255, 255, 0.5)",padding:2,r:3}).add(e)}},{key:"createText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{text:null,x:0,y:0,fontSize:"11px"},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$container,i=t.text,n=t.x,o=t.y,r=t.fontSize;return this.renderer.label(i,n,o).css({color:"#000000",fontSize:r}).attr({stroke:this.getColor(),"stroke-width":1,fill:this.getFillColor(),"fill-opacity":"0.8",padding:7,r:0}).add(e)}},{key:"createPoints",value:function(){return r.map(this.options.keyPoints,this.keyPointToSvgPoint,this)}},{key:"keyPointToSvgPoint",value:function(t,e){return new c(t).initSVG(e,this)}},{key:"updatePoints",value:function(t,e){var i=this;r.isUndefined(t)||r.isUndefined(e)?r.each(this.$points,function(t){return t.updateSVG(!i.editing&&!t.editing)}):(this.$points[t]?(this.$points[t].fromPoint(e),this.$points[t].updateSVG()):this.$points[t]=e.initSVG(t,this),this.options.keyPoints[t]=this.$points[t].convert(!0).getValues())}},{key:"addEvents",value:function(){var t=this;this.mouseHandlers={},this.mouseHandlers.mousedown=a.addEvent(this.$hoverElement.element,"mousedown",function(e){if(e=t.normalize(e),t.chartDrawing.isInsideAxis(e)){e.stopImmediatePropagation(),t.startEditing();var i=!1,n=t.normalize(e);t.mouseHandlers.mousemove=a.addEvent(t.ownerSVG,"mousemove",function(e){e=t.normalize(e),t.chartDrawing.isInsideAxis(e)&&(i=!0,n=t.onMove(!1,e,n))}),t.mouseHandlers.mouseup=a.addEvent(t.ownerSVG,"mouseup",function(e){e=t.normalize(e),t.chartDrawing.isInsideAxis(e)&&(n=t.onMove(!0,e,n),t.mouseHandlers.mousemove(),t.mouseHandlers.mouseup(),t.stopEditing(i))})}}),r.each(this.$points,function(e){return e.addEvents(t)})}},{key:"onMove",value:function(t,e,i){return e=this.normalize(e),this.move(t,e.chartX-i.chartX,e.chartY-i.chartY),e}},{key:"move",value:function(t,e,i,n){var o=this;n?(n.setPixels(n.x+e,n.y+i),this._move(t,e,i,n)):(r.each(this.$points,function(t){return t.setPixels(t.x+e,t.y+i)}),this._move(t,e,i,n)),t&&r.each(this.$points,function(t,e){return o.options.keyPoints[e]=t.convert(!0).getValues()}),this.updatePoints(),this.render(this.options.keyPoints.length)}},{key:"deactivate",value:function(e){t.removeSVGClass(this.$container,"active"),e||this.chartDrawing.setActiveDrawing(null)}},{key:"activate",value:function(e){t.addSVGClass(this.$container,"active"),e||this.chartDrawing.setActiveDrawing(this)}},{key:"startEditing",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this).editing=!0,this.chartDrawing.enableEditing(),t.addSVGClass(this.$container,"in-moving"),this.activate()}},{key:"stopEditing",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;i.editing=!1,(i===this?i.notSaved:i.drawing.notSaved)||this.chartDrawing.disableEditing(),t.removeSVGClass(this.$container,"in-moving"),e&&this.chartDrawing.saveDrawing(!0)}},{key:"normalize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return t.chartX&&t.chartY?t:this.pointer.normalize(t)}},{key:"parent",get:function(){return this._parent}},{key:"options",get:function(){return this._options}},{key:"xAxis",get:function(){return this._xAxis}},{key:"yAxis",get:function(){return this._yAxis}},{key:"pointer",get:function(){return this._pointer}},{key:"renderer",get:function(){return this._renderer}},{key:"chartDrawing",get:function(){return this._chartDrawing}},{key:"ownerSVG",get:function(){return this.$container.element.ownerSVGElement}},{key:"fxclientOptions",get:function(){throw Error("unimplemented abstract method")}},{key:"initialized",get:function(){return this._initialized},set:function(t){this._initialized=t}}],[{key:"addSVGClass",value:function(t,e){var i=t.element.getAttribute("class").split(" ");i.indexOf(e)<=-1&&i.push(e),t.element.setAttribute("class",i.join(" "))}},{key:"removeSVGClass",value:function(t,e){var i=t.element.getAttribute("class").split(" "),n=i.indexOf(e);n>-1&&i.splice(n,1),t.element.setAttribute("class",i.join(" "))}},{key:"lightenDarkenColor",value:function(t,e){var i=!1;"#"===t[0]&&(t=t.slice(1),i=!0);var n=parseInt(t,16),o=(n>>16)+e;o>255?o=255:o<0&&(o=0);var r=(n>>8&255)+e;r>255?r=255:r<0&&(r=0);var s=(255&n)+e;return s>255?s=255:s<0&&(s=0),(i?"#":"")+("000000"+(s|r<<8|o<<16).toString(16)).slice(-6)}}]),t}();n.exports=d}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0))},2025:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r,s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(r=function(t,e,n){var r=i(0),a=i(8),l=i(288),h=i(23),c=i(7),u=i(822),d=i(823),p=function(){function t(){o(this,t)}return s(t,null,[{key:"initEditing",value:function(e,i,n,o){var r=o.onChangeProfitForTakeProfit,s=o.onChangeLossForStopLoss,a=o.onChangeRate,l=o.onChangeConversionRate;l&&e.listenTo(i,"change:conversionRate",l),a&&e.listenTo(i,"change:rate",a),r&&e.listenTo(i,"change:profitForTakeProfit",r),s&&e.listenTo(i,"change:lossForStopLoss",s),n&&t.sendSubscribeToConversion(i.getInstrument().getCurrency(),c.getUserCurrency())}},{key:"createEditPositionModel",value:function(t,e){var i=t.get("quantity")<0?"Sell":"Buy";return new u({instrumentModel:e,type:i,direction:i,position:t})}},{key:"stopEditing",value:function(e,i,n){e.stopListening(i),n&&t.sendUnsubscribeFromConversion(i.getInstrument().getCurrency(),c.getUserCurrency())}},{key:"sendSubscribeToConversion",value:function(e,i){return l.add(e,i).then(t.requestConversionSubscriptionSuccess).catch(t.requestConversionSubscriptionError)}},{key:"sendUnsubscribeFromConversion",value:function(e,i){return l.remove(e,i).then(t.requestConversionUnsubscriptionSuccess).catch(t.requestConversionUnsubscriptionError)}},{key:"requestConversionSubscriptionSuccess",value:function(t){return Promise.resolve(t)}},{key:"requestConversionSubscriptionError",value:function(t){return Promise.reject(t)}},{key:"requestConversionUnsubscriptionSuccess",value:function(t){return Promise.resolve(t)}},{key:"requestConversionUnsubscriptionError",value:function(t){return Promise.reject(t)}},{key:"removePositionStopLoss",value:function(e){return t.requestEditPosition(e,["takeProfit"]).then(t.onSubmitSuccess).catch(t.onSubmitError)}},{key:"removePositionTakeProfit",value:function(e){return t.requestEditPosition(e,["stopLoss"]).then(t.onSubmitSuccess).catch(t.onSubmitError)}},{key:"removeOrderStopLoss",value:function(e){return t.requestPlaceOrder(e,["takeProfit"]).then(t.onSubmitSuccess).catch(t.onSubmitError)}},{key:"removeOrderTakeProfit",value:function(e){return t.requestPlaceOrder(e,["stopLoss"]).then(t.onSubmitSuccess).catch(t.onSubmitError)}},{key:"requestEditPosition",value:function(t,e){var i=[];if(e.indexOf("takeProfit")>=0&&t.getPositionModel().get("takeProfit")){var n={fixedOffset:t.minOrderDistance(),fixedPrice:t.getTakeProfit(),isPriceFixed:!0,orderType:"LIMIT",requestId:null};i.push(n)}if(e.indexOf("stopLoss")>=0&&t.getPositionModel().get("stopLoss")){var o={fixedOffset:t.minOrderDistance(),fixedPrice:t.getStopLoss(),isPriceFixed:!0,orderType:"STOP",requestId:null};i.push(o)}return a.editPosition(h.getAtmosphereId(),i,t.getPositionCode())}},{key:"onSubmitSuccess",value:function(){return Promise.resolve()}},{key:"onSubmitError",value:function(){return Promise.reject(res)}},{key:"getOrderAttributes",value:function(t,e){var i=t.get("quantity"),n=i>0?"buy":"sell",o=t.get("type"),r=null,s=null,a=t.get("takeProfit"),l=t.get("stopLoss");switch(o){case"STOP":o="Entry Stop",s="buy"===n?"above":"below",r=t.get("stopPrice");break;case"LIMIT":o="Entry Limit",s="buy"===n?"below":"above",r=t.get("limitPrice")}return{instrument:e,order:t,action:n,quantity:Math.abs(i),type:o,orderPosition:s,price:r,takeProfit:a&&a.fixedPrice,stopLoss:l&&l.fixedPrice}}},{key:"createEditOrderModel",value:function(e,i){var n=t.getOrderAttributes(e,i);return new d({instrumentModel:n.instrument,type:n.action,direction:n.action.toUpperCase(),order:n.order,takeProfit:n.takeProfit,stopLoss:n.stopLoss})}},{key:"requestPlaceOrder",value:function(t,e){var i={effect:"OPENING",instrumentId:t.getInstrumentModel().getId(),orderSide:t.getDirection(),orderType:t.order.getType(),quantity:t.getAmount(),refOrderChainId:t.order.getOrderChainId(),requestId:r.uniqueId("gwt-uid-"),timeInForce:"GTC"};return t.order.isLimitPrice()?(i.limitPrice=t.getCurrentPrice(),i.stopPrice=null):(i.limitPrice=null,i.stopPrice=t.getCurrentPrice()),e.indexOf("stopLoss")>=0&&t.order.get("stopLoss")&&(i.stopLoss={fixedOffset:t.minOrderDistance(!1),fixedPrice:t.getStopLoss(),isPriceFixed:!0,orderType:"STOP"}),e.indexOf("takeProfit")>=0&&t.order.get("takeProfit")&&(i.takeProfit={fixedOffset:t.minOrderDistance(!1),fixedPrice:t.getTakeProfit(),isPriceFixed:!0,orderType:"LIMIT"}),t.order.unset("modifiedTime",{silent:!0}),a.placeOrder(h.getAtmosphereId(),i)}},{key:"updatePositionTakeProfit",value:function(e){return t.updatePosition(e)}},{key:"updatePositionStopLoss",value:function(e){return t.updatePosition(e)}},{key:"updatePosition",value:function(e){return t.requestEditPosition(e,["takeProfit","stopLoss"]).then(t.onSubmitSuccess).catch(t.onSubmitError)}},{key:"updateOrderTakeProfit",value:function(e){return t.updateOrder(e)}},{key:"updateOrderStopLoss",value:function(e){return t.updateOrder(e)}},{key:"updateOrder",value:function(e){return t.requestPlaceOrder(e,["takeProfit","stopLoss"]).then(t.onSubmitSuccess).catch(t.onSubmitError)}}]),t}();n.exports=p}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0))},2034:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r,s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(r=function(t,e,n){var r=i(17),a=r.Events,l=i(38),h=i(0),c=i(409),u=i(7),d=i(799),p=i(2287),f=i(2288),g=i(2289),y=i(2290),v=["M",0,0],m=["$rateLine","$hoverElement","$rateLabel","$infoLabel","$plLabel","$editButton","$closeButton","$tpslButton","$container"],b=i(2139),w={RATE_LABEL:{attr:{"stroke-width":0,padding:d.options.chart.label.padding,r:d.options.chart.label.radius},css:{color:"#FFFFFF",fontSize:"11px",fontWeight:"500",fontFamily:'Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;'}},INFO_LABEL:{attr:{fill:"#FFFFFF","stroke-width":1,paddingLeft:3,padding:3,r:2},css:{fontSize:"11px",fontWeight:"bold",fontFamily:'Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;'}},PL_LABEL:{attr:{fill:"#FFFFFF","stroke-width":1,padding:3,r:2},css:{color:"#FFFFFF",fontSize:"11px",fontWeight:"bold",fontFamily:'Lato, "Helvetica Neue", Helvetica, Arial, sans-serif;'}},BUTTON:{NORMAL_STATE:{style:{color:"#1960d7"},paddingLeft:1,padding:3,r:2,"stroke-width":1,stroke:"#7c7c7c",fill:"#ffffff"},HOVER_STATE:{fill:"#f0f1f2"}},CLOSE_BUTTON:{},TPSL_BUTTON:{}},x=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o(this,t),this._chart=e,this._options=h.extend({},this.defaults,i),this.options.handleEvents&&h.extend(this,a),this.$container=this.createContainer(),this.options.draggable&&this.makeDraggable(),this.$rateLine=this.createRateLine(),this.options.showRateLabel&&(this.$rateLabel=this.createLabel(null,h.extend({},w.RATE_LABEL.attr,{fill:this.options.color}),w.RATE_LABEL.css)),this.elementsRow=[],this.options.showInfoLabel&&(this.options.infoLabelValue||this.options.infoLabelKey||this.options.infoLabelShowRate)&&(this.$infoLabel=this.createLabel(this.formatInfo(),h.extend({},w.INFO_LABEL.attr,{fill:this.chart.options.chart.backgroundColor,stroke:this.options.color}),h.extend({},w.INFO_LABEL.css,{color:this.options.color})),"right"===this.options.infoLabelAlign?this.$infoLabel.attr({align:this.options.infoLabelAlign}):this.elementsRow.push({offsetX:14,element:this.$infoLabel})),this.options.showProfitLossLabel&&(this.$plLabel=this.createLabel(null,h.extend({},w.PL_LABEL.attr,{stroke:this.options.color,fill:this.options.color}),h.extend({},w.PL_LABEL.css)),this.elementsRow.push({offsetX:"right"===this.options.infoLabelAlign?14:-2,element:this.$plLabel}),this.$plLabel.hide()),this.options.showEditButton&&this.onEditButtonCLick&&(this.$editButton=this.createButton(p,this.onEditButtonCLick.bind(this),h.extend({},w.BUTTON.NORMAL_STATE,{title:__("actions.edit"),fill:this.chart.options.chart.backgroundColor}),w.BUTTON.HOVER_STATE,{fill:this.options.color}),this.elementsRow.push({offsetX:10,element:this.$editButton})),this.options.showCloseButton&&this.onCloseButtonClick&&(this.$closeButton=this.createButton(f,this.onCloseButtonClick.bind(this),h.extend({},w.BUTTON.NORMAL_STATE,{title:__("actions.cancel"),fill:this.chart.options.chart.backgroundColor}),w.BUTTON.HOVER_STATE,{fill:this.options.color}),this.elementsRow.push({offsetX:4,element:this.$closeButton})),this.options.showTpslButton&&this.onTpslButtonClick&&(this.$tpslButton=this.createButton(g,this.onTpslButtonClick.bind(this),h.extend({},w.BUTTON.NORMAL_STATE,{fill:this.chart.options.chart.backgroundColor}),w.BUTTON.HOVER_STATE,{fill:this.options.color,icon:y}),this.elementsRow.push({offsetX:4,element:this.$tpslButton})),this.chartRedrawEventHandler=c.addEvent(e,"redraw",this.onChartRedraw.bind(this)),this.chartDestroyEventHandler=c.addEvent(e,"destroy",this.onChartDestroy.bind(this))}return s(t,[{key:"defaults",get:function(){throw Error(this.constructor.name+" : unimplemented abstract method")}},{key:"chart",get:function(){return this._chart}},{key:"options",get:function(){return this._options}}],[{key:"DASH_STYLES",get:function(){return b}}]),s(t,[{key:"formatInfo",value:function(){var t="";return this.options.infoLabelValue?t=this.options.infoLabelValue:this.options.infoLabelKey&&(t=__(this.options.infoLabelKey)),this.options.infoLabelShowRate&&this.rate&&(t.length>0&&(t+=" : "),t+=this.formatRate()),t}},{key:"formatRate",value:function(){return this.rate.toFixed(this.options.precision||this.options.instrument&&this.options.instrument.getPrecision()||5)}},{key:"formatPL",value:function(t){return l(t).formatForeignCurrency(u.getUserCurrencySymbol(),"$0.00")}},{key:"updateRate",value:function(t){if(t!==this.rate){var e=t-this.rate;this.rate=t,this.onRateUpdated(e)}}},{key:"onRateUpdated",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chart;return this.onChartRedraw(e),t}},{key:"onChartRedraw",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart,this.chart.get(d.options.names.axis.mainY).getExtremes());if(this.rate<=t.max&&this.rate>=t.min){this.$container.show();var e=this.$rateLine.updateValue(this.rate);this.$hoverElement&&this.$hoverElement.update(this.$rateLine.d),this.$rateLabel&&(this.$rateLabel.attr({text:this.formatRate()}),this.$rateLabel.attr({y:e.y-this.$rateLabel.height/2,x:e.x+e.width})),this.$infoLabel&&(this.$infoLabel.attr({text:this.formatInfo()}),"right"===this.options.infoLabelAlign&&this.$infoLabel.attr({x:e.width-(10+d.options.chart.label.offsetX),y:e.y-this.$infoLabel.height/2}));var i=0;h.each(this.elementsRow,function(t){t.element.attr({x:i+t.offsetX,y:e.y-t.element.height/2}),i+=t.element.width+t.offsetX}),this.updateDragAndDropRange()}else this.$container.hide()}},{key:"toPixels",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chart).get(d.options.names.axis.mainY).toPixels(parseFloat(t))}},{key:"toValue",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chart).get(d.options.names.axis.mainY).toValue(t)}},{key:"getPlotLinePath",value:function(t){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chart).get(d.options.names.axis.mainY).getPlotLinePath(t,1)}},{key:"updatePl",value:function(t){if(this.$plLabel){t||(t=0);var e=this.formatPL(t);this.pl!==e&&(this.$plLabel.attr({text:e}),this.pl||this.$plLabel.attr({visibility:"inherit"}),this.pl=e,this.onChartRedraw())}}},{key:"applySettings",value:function(t){this.$infoLabel&&this.$infoLabel.attr({fill:t.colors.common.background}),this.$editButton&&this.$editButton.updateNormalState({fill:t.colors.common.background}),this.$closeButton&&this.$closeButton.updateNormalState({fill:t.colors.common.background}),this.$tpslButton&&this.$tpslButton.updateNormalState({fill:t.colors.common.background})}},{key:"createContainer",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart.renderer).g("rate-line "+(this.options.className||"")).attr({zIndex:7}).add()}},{key:"createRateLine",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$container,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.chart,n=e.renderer.path(v).attr({"stroke-width":1,stroke:this.options.color,dashstyle:this.options.dashstyle,"pointer-events":"none"}).add(e);return n.updateY=function(e){return n.attr({d:["M",0,e,"L",i.plotLeft+i.plotWidth+(t.options.showRateLabel?d.options.chart.label.offsetX:0),e]})},n.updateValue=function(e){var o=t.getPlotLinePath(e,i);return o?(t.options.showRateLabel&&(o[4]+=d.options.chart.label.offsetX),n.attr({d:o}),{x:o[1],y:o[2],width:o[4]-o[1],height:o[5]-o[2]}):null},n}},{key:"createLabel",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.$container;return n.renderer.label(t,-1e3,-1e3,null,null,null,!1,!1).attr(e).css(i).add(n)}},{key:"createButton",value:function(t,e,i,n,o,r){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.$container;return s.renderer.buttonIcon(null,-1e3,-1e3,t,15,15,e,i,n,o,r).add(s)}},{key:"destroy",value:function(t){var e=this;this.destroyed||(h.each(m,function(t){e[t]&&(e[t].destroy(),e[t]=null)}),this.elementsRow=null,this.chartRedrawEventHandler(),t||this.chartDestroyEventHandler(),this.chartRedrawEventHandler=this.chartDestroyEventHandler=null,this.stopListening&&this.stopListening(),this.destroyed=!0)}},{key:"makeDraggable",value:function(){var t=this;this.$hoverElement=this.createLineHover(),this.mouseHandlers={},this.mouseHandlers.mousedown=c.addEvent(this.$hoverElement.element,"mousedown",function(e){if(t._beforeDragRate=t.rate,e=t.normalize(e),t.yAxis=t.chart.get(d.options.names.axis.mainY),t.isInsideAxis(e)){e.stopImmediatePropagation(),t.startEditing();var i=!1,n=t.normalize(e);t.mouseHandlers.mousemove=c.addEvent(t.$container.element.ownerSVGElement,"mousemove",function(e){e=t.normalize(e),t.isInsideAxis(e)&&(i=!0,n=t.onMove(!1,e,n))}),t.mouseHandlers.mouseup=c.addEvent(t.$container.element.ownerSVGElement,"mouseup",function(e){e=t.normalize(e),t.isInsideAxis(e)&&(i&&(n=t.onMove(!0,e,n)),t.mouseHandlers.mousemove(),t.mouseHandlers.mouseup(),t.stopEditing(i),t.yAxis=null)})}})}},{key:"normalize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return t.chartX&&t.chartY?t:this.chart.pointer.normalize(t)}},{key:"createLineHover",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$container,i=e.renderer.path(t).attr({class:"hover","stroke-width":1,stroke:"transparent","stroke-linecap":"butt"}).add(e);return i.update=function(t){return i.attr({d:t})},i}},{key:"isInsideAxis",value:function(t){return t.chartX>=this.yAxis.left&&t.chartY>=this.yAxis.top&&t.chartX<=this.yAxis.left+this.yAxis.width&&t.chartY<=this.yAxis.top+this.yAxis.height}},{key:"startEditing",value:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this).editing=!0,this.initDragAndDropRange()}},{key:"stopEditing",value:function(t){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:this).editing=!1,this.removeDragAndDropRange()}},{key:"enableDragging",value:function(){this.$hoverElement&&this.$hoverElement.show()}},{key:"disableDragging",value:function(){this.$hoverElement&&this.$hoverElement.hide()}},{key:"initDragAndDropRange",value:function(){this.dragAndDropRange=t.calcDragAndDropRangeCoords(this.getDragAndDropRange(),this.yAxis),this.$dragAndDropRangeRect=this.chart.renderer.rect(this.dragAndDropRange.x,this.dragAndDropRange.y,this.dragAndDropRange.width,this.dragAndDropRange.height).attr({fill:this.options.color,"fill-opacity":.1}).add()}},{key:"updateDragAndDropRange",value:function(){this.$dragAndDropRangeRect&&(this.dragAndDropRange=t.calcDragAndDropRangeCoords(this.getDragAndDropRange(),this.yAxis),this.$dragAndDropRangeRect.attr({x:this.dragAndDropRange.x,y:this.dragAndDropRange.y,width:this.dragAndDropRange.width,height:this.dragAndDropRange.height}))}},{key:"removeDragAndDropRange",value:function(){this.dragAndDropRange=null,this.$dragAndDropRangeRect&&(this.$dragAndDropRangeRect.destroy(),this.$dragAndDropRangeRect=null)}},{key:"onMove",value:function(t,e,i){return e=this.normalize(e),this.move(t,e.chartX-i.chartX,e.chartY-i.chartY)?e:i}},{key:"move",value:function(t,e,i){var n=this;if(t)return this.onDrop(this.rate-this._beforeDragRate).catch(function(){n.updateRate(n._beforeDragRate)}),!0;var o=!0,r=this.toValue(this.toPixels(this.rate)+i);return this.dragAndDropRange.min&&r<this.dragAndDropRange.min?(r=this.dragAndDropRange.min,o=!1):this.dragAndDropRange.max&&r>this.dragAndDropRange.max&&(r=this.dragAndDropRange.max,o=!1),this.updateRate(r),o}},{key:"exportTo",value:function(t){var e=this,i={};i.$container=this.createContainer(t.renderer),i.$rateLine=this.createRateLine(i.$container,t);var n=[];this.$rateLabel&&(i.$rateLabel=this.createLabel(this.$rateLabel.text.textStr,h.extend({},w.RATE_LABEL.attr,{fill:this.options.color}),w.RATE_LABEL.css,i.$container)),this.$infoLabel&&(i.$infoLabel=this.createLabel(this.$infoLabel.text.textStr,h.extend({},w.INFO_LABEL.attr,{fill:this.chart.options.chart.backgroundColor,stroke:this.options.color}),h.extend({},w.INFO_LABEL.css,{color:this.options.color}),i.$container),"right"===this.options.infoLabelAlign?i.$infoLabel.attr({align:this.options.infoLabelAlign}):n.push({offsetX:14,element:i.$infoLabel})),this.$plLabel&&(i.$plLabel=this.createLabel(this.$plLabel.text.textStr,h.extend({},w.PL_LABEL.attr,{stroke:this.options.color,fill:this.options.color}),h.extend({},w.PL_LABEL.css),i.$container),n.push({offsetX:-2,element:i.$plLabel})),this.$tpslButton&&2===this.$tpslButton.state&&(i.$tpslButton=this.createButton(g,null,h.extend({},w.BUTTON.NORMAL_STATE),w.BUTTON.HOVER_STATE,{fill:this.options.color,icon:y},null,i.$container),i.$tpslButton.press(),n.push({offsetX:10,element:i.$tpslButton}));var o=c.addEvent(t,"redraw",function(){var t=i.$rateLine.updateValue(e.rate);if(!t)return void i.$container.hide();i.$container.show(),i.$rateLabel&&i.$rateLabel.attr({y:t.y-i.$rateLabel.height/2,x:t.x+t.width}),i.$infoLabel&&"right"===e.options.infoLabelAlign&&i.$infoLabel.attr({x:t.width-(10+d.options.chart.label.offsetX),y:t.y-i.$infoLabel.height/2});var o=0;h.each(n,function(e){e.element.attr({x:o+e.offsetX,y:t.y-e.element.height/2}),o+=e.element.width+e.offsetX})});c.addEvent(t,"destroy",function(){h.each(m,function(t){i[t]&&(i[t].destroy(),i[t]=null)}),o()})}},{key:"onChartDestroy",value:function(){this.destroy(!0)}}],[{key:"calcDragAndDropRangeCoords",value:function(t,e){return t.x=e.left,t.width=e.width,t.y=e.top+(t.max?Math.max(e.toPixels(t.max,!0),0):0),t.height=e.top-t.y+(t.min?Math.min(e.toPixels(t.min,!0),e.height):e.height),t}}]),t}();n.exports=x}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0))},2042:function(t,e,i){(function(n){var o;void 0!==(o=function(t,e,n){function o(t,e,i){t.addEventListener(e,i,!0)}function r(t,e,i){t.removeEventListener(e,i,!0)}var s=i(12),a=(i(0),i(4)),l=(i(2),"rtl"===a("html").attr("dir"));n.exports=s.extend({isHidden:!0,initialize:function(t){s.prototype.initialize.apply(this,arguments),this.options=t,this.render(),this.addDragEvents()},render:function(){this.$el.html(this.template(this.options))},toggle:function(t){this.isHidden!==t&&(this.isHidden=t,this.$el.css("display",t?"none":"block"),this.resetPosition())},resetPosition:function(){this.$el.css({top:"",bottom:"",left:"",right:""})},closePopup:function(){this.toggle(!0)},isDragReady:!1,dragoffset:{x:0,y:0},onMouseDown:function(t){this.isDragReady=!0,this.dragoffset.x=t.pageX-this.el.offsetLeft,this.dragoffset.y=t.pageY-this.el.offsetTop},onMouseUp:function(t){this.isDragReady=!1},onMouseMove:function(t){if(this.isDragReady)if(this.el.offsetHeight+Math.abs(t.pageY-this.dragoffset.y)<screen.height&&(this.el.style.top=t.pageY-this.dragoffset.y+"px"),l){var e=screen.width-t.pageX-this.dragoffset.x;if(e+this.el.offsetWidth>screen.width)return;this.el.style.right=e+"px"}else{var i=t.pageX-this.dragoffset.x;if(i+this.el.offsetWidth>screen.width)return;this.el.style.left=i+"px"}},addDragEvents:function(){o(this.el,"mousedown",this.onMouseDown.bind(this)),o(document,"mouseup",this.onMouseUp.bind(this)),o(document,"mousemove",this.onMouseMove.bind(this))},removeDragEvents:function(){r(this.el,"mousedown",this.onMouseDown.bind(this)),r(document,"mouseup",this.onMouseUp.bind(this)),r(document,"mousemove",this.onMouseMove.bind(this))},destroy:function(){this.removeDragEvents(),s.prototype.destroy.call(this)}})}.call(e,i,e,t))&&(t.exports=o)}).call(e,i(4))},2048:function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),r=i.n(o),s=i(2),a=i.n(s),l=i(11),h=i.n(l),c=i(52),u=i.n(c),d=i(10),p=i(0),f=i.n(p),g=function(t){return a.a.trigger("ui:new-position",{direction:d.BUY,symbolOrId:t})},y=function(t){var e=!f.a.isNaN(parseInt(t.ask)),i=h()(n({"price-button":!0,"price-button_labeled":!0,"price-button_ani":!0},t.className,!0)),o=h()({"price-button__wrapper":!0,btn:!0,disabled:!t.buyTradable,bar_loading:!e});return e&&(t.ask=u.a.divideValueByPipSize(t.ask,t.pipsPrecision)),r.a.createElement("div",{className:i},r.a.createElement("buttton",{disabled:!t.buyTradable,className:o,onClick:function(){return t.buyTradable&&g(t.symbol)},"aria-label":t.notTradableMessage},r.a.createElement("div",{className:"price-button__subtitle"},__("actions.buy")),r.a.createElement("div",{className:"price-button__title"},!0===t.ask?t.ask:u.a.formatValueToStringOrComponent(t.ask,!1))))};e.default=y},2049:function(t,e,i){"use strict";function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),r=i.n(o),s=i(11),a=i.n(s),l=i(2),h=i.n(l),c=i(52),u=i.n(c),d=i(10),p=i(0),f=i.n(p),g=function(t){return h.a.trigger("ui:new-position",{direction:d.SELL,symbolOrId:t})},y=function(t){var e=!f.a.isNaN(parseInt(t.bid)),i=a()(n({"price-button":!0,"price-button_labeled":!0,"price-button_ani":!0},t.className,!0)),o=a()({"price-button__wrapper":!0,btn:!0,disabled:!t.sellTradable,bar_loading:!e});return e&&(t.bid=u.a.divideValueByPipSize(t.bid,t.pipsPrecision)),r.a.createElement("div",{className:i},r.a.createElement("buttton",{disabled:!t.sellTradable,className:o,onClick:function(){return t.sellTradable&&g(t.symbol)},"aria-label":t.notTradableMessage},r.a.createElement("div",{className:"price-button__subtitle"},__("actions.sell")),r.a.createElement("div",{className:"price-button__title"},!0===t.bid?t.bid:u.a.formatValueToStringOrComponent(t.bid,!1))))};e.default=y},2130:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=i(1),l=i.n(a),h=i(11),c=i.n(h),u=i(2816),d=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),p=function(e){function i(){return o(this,i),r(this,(i.__proto__||Object.getPrototypeOf(i)).apply(this,arguments))}return s(i,e),d(i,[{key:"componentDidMount",value:function(){this.$chart=new u.a({parent:this.refs.component,chartId:t.now(),symbol:this.props.symbol,period:"1d"})}},{key:"componentWillUnmount",value:function(){this.$chart&&this.$chart.destroy()}},{key:"render",value:function(){var t=this.props.className;return l.a.createElement("div",{className:c()(n({"chart-box":!0},t,!!t)),ref:"component"})}}]),i}(l.a.Component);e.default=p}.call(e,i(0))},2137:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r,s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(r=function(t,e,r){var a=i(409),l=function(){function t(){switch(o(this,t),arguments.length){case 1:this.fromKeyPoint(arguments[0]);break;case 2:this.setPixels(arguments[0],arguments[1])}}return s(t,null,[{key:"defaults",get:function(){return{pointSize:8,pointType:"rect",draggable:!0}}}]),s(t,[{key:"fromKeyPoint",value:function(t){this.setValues(t.timestamp,t.value)}},{key:"fromPoint",value:function(t){this.setPixels(t.x,t.y)}},{key:"setValues",value:function(t,e){this.timestamp=t,this.value=e}},{key:"setPixels",value:function(t,e){this.x=t,this.y=e}},{key:"getValues",value:function(){return{timestamp:this._timestamp,value:this._value}}},{key:"getPixels",value:function(){return{x:this.x,y:this.y}}},{key:"convert",value:function(t){return t?(this.timestamp=this.drawing.xAxis.toValue(this.x),this.value=this.drawing.yAxis.toValue(this.y)):(this.x=this.drawing.xAxis.toPixels(this.timestamp),this.y=this.drawing.yAxis.toPixels(this.value)),this}},{key:"initSVG",value:function(e,i){var o=n.extend({},t.defaults,i.options);return this.index=e,this.drawing=i,this.type=o.pointType,this.size=o.pointSize,this.draggable=o.draggable,void 0!==this.x&&void 0!==this.y||this.convert(),this.$svg="circle"===this.pointType?t.createPointCircle(this.x,this.y,i.$container,i.renderer,o):t.createPointRect(this.x,this.y,i.$container,i.renderer,o),this}},{key:"addEvents",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.drawing;this.$svg&&this.draggable&&(this.mouseHandlers={},this.mouseHandlers.mousedown=a.addEvent(this.$svg.element,"mousedown",function(i){if(i=t.drawing.normalize(i),t.drawing.chartDrawing.isInsideAxis(i)){i.stopImmediatePropagation(),e.startEditing(t);var n=!1,o=e.normalize(i);t.mouseHandlers.mousemove=a.addEvent(e.ownerSVG,"mousemove",function(i){i=t.drawing.normalize(i),t.drawing.chartDrawing.isInsideAxis(i)&&(n=!0,o=t.onMove(!1,e,i,o))}),t.mouseHandlers.mouseup=a.addEvent(e.ownerSVG,"mouseup",function(i){i=t.drawing.normalize(i),t.drawing.chartDrawing.isInsideAxis(i)&&(t.onMove(!0,e,i,o),t.mouseHandlers.mousemove(),t.mouseHandlers.mouseup(),e.stopEditing(n,t))})}}))}},{key:"updateSVG",value:function(t){t&&this.convert(),this.$svg.attr("circle"===this.type?{cx:this.x,cy:this.y}:{x:this.x-this.size/2,y:this.y-this.size/2})}},{key:"onMove",value:function(t,e,i,n){return i=e.normalize(i),e.move(t,i.chartX-n.chartX,i.chartY-n.chartY,this),i}},{key:"destroy",value:function(){for(var t in this.mouseHandlers)this.mouseHandlers[t]()}},{key:"setColor",value:function(t){this.drawing.options.properties.defaultKeyPoint.lineColor=t,this.drawing.options.properties.defaultKeyPoint.fillStyle=t,this.$svg.attr({stroke:t,fill:t})}},{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"timestamp",get:function(){return this._timestamp},set:function(t){this._timestamp=t}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}},{key:"index",get:function(){return this._index},set:function(t){this._index=t}}],[{key:"createPointCircle",value:function(t,e,i,n,o){return n.circle(t,e,o.pointSize/2).attr({class:"point","stroke-width":o.properties.defaultKeyPoint.lineWidth,stroke:o.properties.defaultKeyPoint.lineColor,fill:o.properties.defaultKeyPoint.fillStyle}).css({}).add(i)}},{key:"createPointRect",value:function(t,e,i,n,o){return n.rect(t-o.pointSize/2,e-o.pointSize/2,o.pointSize,o.pointSize).attr({class:"point","stroke-width":o.properties.defaultKeyPoint.lineWidth,stroke:o.properties.defaultKeyPoint.lineColor,fill:o.properties.defaultKeyPoint.fillStyle}).css({}).add(i)}}]),t}();r.exports=l}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0))},2138:function(t,e,i){(function(n,o){var r;void 0!==(r=function(t,e,n){var o=i(0),r=i(4),s=i(24),a=i(79),l=o.template(i(2282)),h=i(71);n.exports=s.extend({initialize:function(t){this.drawing=t,s.prototype.initialize.apply(this,arguments),this.render()},events:function(){return o.extend({},o.result(s.prototype,"events"),{"click .fn-save":"onSave","click .fn-cancel":"onCancel"})},getOptions:function(t){return o.extend({},o.result(s.prototype,"getOptions"),{parent:document.body,isHeaderShowed:!0,caption:__("chart_drawings.settings.popup.header"),headerStyle:"wizard"},t)},render:function(){var t=this;return s.prototype.render.call(this),this.$el.addClass("drawing-settings-popup"),this.setContent(l()),this.$form=this.$el.find(".drawing-settings-form"),o.each(this.drawing.configurableOptions,function(e){var i=null;switch(e.type){case"select":i=a.selectBox(o.extend(e,{translationPrefix:"",disable:!1}));break;case"textarea":i=a.textArea(o.extend(e,{disable:!1,settings:{rows:10,cols:20}}))}i&&(r(i).addClass("field"),t.$form.append(i))}),this.$settingsFrom=new h({el:this.$form}),o.each(this.drawing.configurableOptions,function(e){t.$settingsFrom.getField(e.name).value(e.value),"textarea"===e.type&&t.$settingsFrom.getField(e.name).setRules({max_length:[100,__("chart_drawings.settings.text_note.error",100)]})}),this},onSave:function(){this.$settingsFrom.validate()||(this.drawing.save(this.$settingsFrom.getData()),this.close())},onCancel:function(t){this.close()}})}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0),i(4))},2139:function(t,e){t.exports={DASH:"Dash",DASH_DOT:"DashDot",DOT:"Dot",LONG_DASH:"LongDash",LONG_DASH_DOT:"LongDashDot",LONG_DASH_DOT_DOT:"LongDashDotDot",SHORT_DASH:"ShortDash",SHORT_DASH_DOT:"ShortDashDot",SHORT_DASH_DOT_DOT:"ShortDashDotDot",SHORT_DOT:"ShortDot",SOLID:"Solid"}},2140:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(s=function(t,e,s){var l=i(2034),h={color:"#47a546",dashstyle:l.DASH_STYLES.SHORT_DASH,draggable:!0,handleEvents:!0,infoLabelKey:"chart.line.profit",infoLabelShowRate:!0,showCloseButton:!0,showEditButton:!0,showInfoLabel:!0,showProfitLossLabel:!0},c=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.onInstrumentStatusChange(),r.listenTo(r.options.instrument,"change:closable change:editable",r.onInstrumentStatusChange.bind(r)),r}return r(e,t),a(e,[{key:"defaults",get:function(){return h}}]),a(e,[{key:"onInstrumentStatusChange",value:function(){this.options.instrument.status.isEditable()?this.enableDragging():this.disableDragging(),this.options.instrument.status.isEditable()?this.$editButton.enable():this.$editButton.disable(),this.options.instrument.status.isEditable()?this.$closeButton.enable():this.$closeButton.disable()}}]),e}(l);s.exports=c}.call(e,i,e,t))&&(t.exports=s)},2141:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(s=function(t,e,s){var l=i(2034),h={color:"#ff433d",dashstyle:l.DASH_STYLES.SHORT_DASH,draggable:!0,handleEvents:!0,infoLabelKey:"chart.line.loss",infoLabelShowRate:!0,showCloseButton:!0,showEditButton:!0,showInfoLabel:!0,showProfitLossLabel:!0},c=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.onInstrumentStatusChange(),r.listenTo(r.options.instrument,"change:closable change:editable",r.onInstrumentStatusChange.bind(r)),r}return r(e,t),a(e,[{key:"defaults",get:function(){return h}}]),a(e,[{key:"onInstrumentStatusChange",value:function(){this.options.instrument.status.isEditable()?this.enableDragging():this.disableDragging(),this.options.instrument.status.isEditable()?this.$editButton.enable():this.$editButton.disable(),this.options.instrument.status.isEditable()?this.$closeButton.enable():this.$closeButton.disable()}}]),e}(l);s.exports=c}.call(e,i,e,t))&&(t.exports=s)},2194:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o,r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(o=function(t,e,o){var s=(i(0),i(2276)),a=i(2277),l=i(2278),h=i(2279),c=i(2280),u=i(2281),d=i(2283),p={vertical_line:{class:l,label:"chart_drawings.vertical"},horizontal_line:{class:a,label:"chart_drawings.horizontal"},line:{class:s,label:"chart_drawings.trending"},trend_channel:{class:h,label:"chart_drawings.channel"},fibonacci_retracements:{class:c,label:"chart_drawings.fibonacci_retracement"},text:{class:u,label:"chart_drawings.text"},measurer:{class:d,label:"chart_drawings.measurer"}},f=function(){function t(e,i){n(this,t),this._parent=i,this._chart=e}return r(t,[{key:"createDrawing",value:function(e){var i=t.types[e.type];if(i)return new i.class(this.chart,this.parent,e)}},{key:"parent",get:function(){return this._parent}},{key:"chart",get:function(){return this._chart}}],[{key:"types",get:function(){return p}},{key:"defaultType",get:function(){return"line"}}]),t}();o.exports=f}.call(e,i,e,t))&&(t.exports=o)},2273:function(t,e,i){(function(n,o){var r,s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t};void 0!==(r=function(t,e,n){var o=i(12),r=(i(3),i(4)),a=i(0),l=i(15),h=i(2),c=i(7),u=i(2274),d=i(30),p=i(108),f=i(9),g=i(14),y=i(799),v=i(2302),m=i(2303),b=i(2304),w=i(207),x=i(2048).default,_=i(2049).default,k=i(1),L=i(16),P=i(120),S=i(819),O=S.TC_SETTINGS_UPDATE_EVENT,C=void 0,$={buy:"ask",middle:null,sell:"bid",none:"bid"};n.exports=o.extend({className:"chart-panel",size:{},settings:{},instrument:null,chart:null,parent:null,model:null,period:null,periodRanges:null,enableTrading:!l.mobile(),escapeKeyboardListener:null,events:function(){return a.extend({},a.result(o.prototype,"events"),{"click .fn-show-search":"showSearch","click .fn-hide-search":"hideSearch","wheel .chart-container":"onMouseWheel"})},chartNoDataTemplate:a.template(i(2305)),initialize:function(){C=i(413),o.prototype.initialize.apply(this,arguments),this.type=this.options.type||y.defaultType,this.period=this.options.period||y.defaultPeriod,this.range=this.options.range||y.defaultRange,this.cursor=this.options.cursor||y.defaultCursor,this.rateLine=this.options.rateLine||y.defaultRateLine,this.type===y.comparisonType&&(f.isChartInstrumentsComparisonEnabled()?this.comparisonMode=!0:(this.type=y.defaultType,this.saveType(this.type))),this.listenTo(h,"ui:aside-box-opened",this.handleReflow),this.listenTo(h,"ui:chart:reflow",this.handleReflow),this.listenTo(h,O,this.resubscribeChart),this.listenTo(h,"ui:chart:drawing-stop",this.stopDrawing),this.listenTo(h,"ui:change-theme",this.changeTheme)},changeTheme:function(t){this.chart.changeTheme(C.getChartSettings(this.getMultiChartIndex()),t)},onMouseWheel:function(t){t.deltaY<0?this.zoomIn():this.zoomOut(),t.preventDefault()},zoomIn:function(){this.chart.zoomIn()},zoomOut:function(){this.chart.zoomOut()},showLoading:function(){this.$el.addClass("chart-loading"),this.loadingView&&this.loadingView.destroy(),this.loadingView=new d({parent:this.getLoadingContainer(),position:"absolute",translucent:"2"})},hideLoading:function(t){this.chart.reflow(),this.$el.removeClass("chart-loading"),this.loadingView&&this.loadingView.destroy(),t||(this.chart.destroy(),this.$chartContainer.html(this.chartNoDataTemplate()))},onDataLoad:function(t,e){var i=this;this.hideLoading(!0),this.comparisonMode&&(this.comparisonInstrument=new v({symbol:this.instrument.getSymbol(),name:this.instrument.getDisplayName()}),this.$chartInstrumentsComparisonPanel.setMainInstrument(this.comparisonInstrument)),this.chart.handleHistoricalData(t,this.comparisonMode?this.comparisonInstrument:void 0),this.chart.onDataLoad(),this.comparisonMode?this.comparisonInstruments&&!this.comparisonInstruments.isEmpty()&&a.each(this.comparisonInstruments.models,function(t){e?t.getSubscription().changeRangeStart(i.chartSubscription.getRangeStart()):(t.getSubscription().stop(),setTimeout(function(){C.updateSubscription(t.getSubscription(),i.range),t.getSubscription().start()},0))}):this.tradingCentral&&this.tradingCentral.subscribe({instrument:this.instrument,period:this.period})},setInstrument:function(t){var e=this;return t===this.instrument?(setTimeout(function(){return e.handleReflow()},0),!1):(this.instrument&&this.instrument.off("change:precision"),this.instrument=t,this.instrument&&this.instrument.on("change:precision",this.precisionUpdated,this),!0)},render:function(){var t=this;this.parent&&r(this.parent).append(this.el),this.$el.html(this.template()),this.$chartSplitterBox=r(".chart-splitter-box"),this.$title=this.$el.find(".chart-title"),y.defaultRateLines.indexOf(this.rateLine)<0&&(this.rateLine=y.defaultRateLines[0]),this.$subtitle=this.$el.find(".chart-subtitle"),this.$chartBox=this.$el.parent(),this.$chartContainer=this.$el.find(".chart-container"),this.$fullscreenNotification=this.$el.find(".chart-fullscreen-notification"),this._fontSize=parseFloat(this.$el.find(".chart-basket").css("font-size")),this.chart=new u({el:this.$chartContainer}),this.listenTo(this.chart,"cursor:unselect",function(){return t.chartToolbar&&t.chartToolbar.setActiveCursor()}),this.listenTo(this.chart,"chart:drawings-save",this.saveDrawings)},onInstrumentSelected:function(t,e,i){if(a.isUndefined(e)&&!(e=g.getInstrumentBySymbol(t)))return!1;var n=null!==this.instrument;return this.setInstrument(e)?(this.setTradesVisibility(i),this.resubscribeChart(n),!0):(this.setTradesVisibility(i,!0),!1)},setTradesVisibility:function(t,e){this.tradesVisibility=t,e&&this.chart.updateTradesVisibility(t)},showChartSettings:function(){C.showChartSettings(this.getMultiChartIndex())},showIndicatorsSettings:function(){C.showIndicatorsSettings(this.getMultiChartIndex())},saveDrawings:function(t){C.saveDrawings(this.instrument.getSymbol(),t,this.getMultiChartIndex())},onOrdersUpdate:function(){if(this.instrument){var t=p.getOrderById(this.instrument.get("orderChainId"));t&&t.hasChanged()&&this.instrument.set(a.pick(t.changedAttributes(),"stopLoss","takeProfit","stopLimitPrice"))}},handleReflow:function(t){this.chart.reflow()},makeScreenshot:function(){this.chart.makeScreenshot()},toggleFullscreen:function(){var t=this;this.size.minimized&&this.toggleMinimize(),this.size.fullscreen?(this.$el.removeClass("fullscreened"),this.$el.appendTo(this.size.parent),this.size.escapeKeyboardListener&&this.size.escapeKeyboardListener.remove(),h.trigger("ui:chart:fullscreen-out")):(this.$el.addClass("fullscreened"),this.size.parent=this.$el.parent(),this.$el.appendTo(r("body")),l.desktop()&&(this.$fullscreenNotification.css("display","block"),this.$fullscreenNotification.fadeOut({duration:2e3,complete:function(){return t.$fullscreenNotification.css("display","none")},step:function(e){return t.$fullscreenNotification.css("opacity",.6*e)}}),this.size.escapeKeyboardListener=this.addKeyboardListener(27,this.toggleFullscreen.bind(this))),h.trigger("ui:chart:fullscreen-in")),this.chart.reflow(),this.size.fullscreen=!this.size.fullscreen,this.chartToolbar&&this.chartToolbar.setActiveSize(this.size.fullscreen)},addKeyboardListener:function(t,e,i){var n=function(i){i=i||window.event,i.keyCode===t&&e()};return document.addEventListener("keydown",n,i||!1),{remove:function(){document.removeEventListener("keydown",n)}}},restoreSize:function(){this.size.fullscreen&&this.toggleFullscreen(),this.size.minimized&&this.toggleMinimize()},toggleMinimize:function(){this.size.fullscreen&&this.toggleFullscreen(),this.size.minimized?(this.$chartBox.removeClass("minimized"),this.$chartSplitterBox.css("display","block"),h.trigger("ui:chart:minimize-out")):(this.$chartSplitterBox.css("display","none"),this.$chartBox.addClass("minimized"),h.trigger("ui:chart:minimize-in")),this.chart.reflow(),this.size.minimized=!this.size.minimized},initBaskets:function(){var t=this.instrument.getBasket();if(t){for(var e=__("baskets.consists",t.instrumentSymbol),i=0,n=t.instruments.length;i<n;i++)e+=" "+t.instruments[i].instrumentWeight+"% "+t.instruments[i].displayName,e+=i<n-1?", ":".";this.$el.find(".chart-basket-title").html(__("baskets.title")+":"),this.$el.find(".chart-basket-info").html(e),this._fitChartBasketHeight()}else this.$el.find(".chart-basket-title").html(""),this.$el.find(".chart-basket-info").html("")},initHeader:function(){this.$title.html(this.instrument.getDisplayName()),this.$subtitle.html(this.instrument.getDescription())},stopTradingCentral:function(){this.tradingCentral&&this.tradingCentral.unsubscribe()},onDataUpdate:function(t,e){return this.chart.handleStreamData(t,e)},getMultiChartIndex:function(){return this.options.multiChartIndex},resubscribeChart:function(t){var e=this;this.instrument&&this.chart&&(this.showLoading(),this.stopTradingCentral(),this.stopDrawing(),this.initHeader(),this.initBaskets(),this.initBuySellButtons(),this.chartSubscription&&this.chartSubscription.stop(),this.chartSubscription=C.createSubscription(s({chartId:this.options.chartId,symbol:this.instrument.getSymbol()},this.comparisonMode?{range:this.range}:{period:this.period},{price:$[this.rateLine],indicators:this.comparisonMode?null:C.getActiveIndicators(this.getMultiChartIndex())})),this.chart.resubscribe({instrument:this.instrument,chartSubscription:this.chartSubscription,type:this.type,period:this.period,rateLine:this.rateLine,cursor:this.cursor,enableTrading:this.enableTrading,tradesVisibility:this.tradesVisibility,comparisonMode:!!this.comparisonMode,settings:C.getChartSettings(this.getMultiChartIndex()),indicators:this.comparisonMode?[]:C.getActiveIndicators(this.getMultiChartIndex()),drawings:l.desktop()?C.getDrawings(this.instrument.getSymbol(),this.getMultiChartIndex()):{}}),this.chartSubscription.on({start:function(){return e.showLoading()},timeout:function(){return e.hideLoading(!1)},load:function(i){return e.onDataLoad(i,t)},update:function(t){return e.onDataUpdate(t,e.chartSubscription.getFirstCandle())}}),this.chartSubscription.start())},getInstrumentSymbol:function(){return this.instrument&&this.instrument.getSymbol()},subscribe:function(t,e){this.onInstrumentSelected(t,void 0,e),this.hideSearch()},_fitChartBasketHeight:function(){var t=parseFloat(this.$el.find(".chart-basket").css("height"));if(t>parseFloat(this.$el.find(".chart-info").css("height"))&&this._fontSize>9)return this.$el.find(".chart-basket-title").html(""),this._fontSize--,this.$el.find(".chart-basket").css("font-size",this._fontSize+"px"),void this._fitChartBasketHeight();t>40&&this.$el.find(".chart-basket").css("display","none")},precisionUpdated:function(t,e){this.chart&&this.chart.updatePrecision(e)},destroyBuySellButtons:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$buyButton,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$sellButton;L.unmountComponentAtNode(e),L.unmountComponentAtNode(t)},initBuySellButtons:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$buyButton,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.$sellButton;if(t&&e)if(this.destroyBuySellButtons(t,e),c.getUserCommonData().isAdvancedTradingView()){if(!f.isNewInstrumentDetailsBehaviourEnabled()||l.mobile()){var i=this.instrument.getSymbol();L.render(k.createElement(w.Bid,{symbol:i,render:_}),e),L.render(k.createElement(w.Ask,{symbol:i,render:x}),t)}}else L.render(k.createElement(P,{type:"Sell",column:{name:"Sell",key:"bid",direction:"bidDirection"},model:this.instrument,display:"block",isSelected:!0}),e),L.render(k.createElement(P,{type:"Buy",column:{name:"Buy",key:"ask",direction:"askDirection"},model:this.instrument,display:"block",isSelected:!1}),t)},startDrawing:function(t){this.drawingType=a.isString(t)?t:this.getTarget(t).dataset.type,this.chart.startDrawing(this.drawingType)},stopDrawing:function(){this.chart.stopDrawing()},clearDrawings:function(){this.stopDrawing(),this.chart.clearDrawings()},getTarget:function(t){return t.currentTarget},onChangePeriod:function(t){this.period=t,this.resubscribeChart()},onChangeRange:function(t){this.range=t,this.period=C.getPeriodByRange(t),this.resubscribeChart()},onChangeType:function(t){this.type=t,this.chart.changeType(t)},onZoomIn:function(){this.chart.zoomIn()},onZoomOut:function(){this.chart.zoomOut()},onShowChartSettings:function(){C.showChartSettings(this.getMultiChartIndex(),this.chart.applySettings.bind(this.chart))},onShowIndicatorsSettings:function(){C.showIndicatorsSettings(this.getMultiChartIndex(),this.resubscribeChart.bind(this))},onChangeCursor:function(t){this.chart.changeCursor(t)},onChangeRateLine:function(t){this.rateLine=t,this.resubscribeChart()},onSearchResultClick:function(t){h.trigger("ui:instrument",t,!0)},showSearch:function(t){this.chartSearchView||(this.chartSearchView=new b({el:this.$el.find(".chart-search-block-wrapper"),onRowClick:this.onSearchResultClick.bind(this)})),this.chartSearchView.show(a.isBoolean(t)&&t)},hideSearch:function(){this.chartSearchView&&this.chartSearchView.hide()},initComparisonInstruments:function(){var t=this.instrument;this.comparisonInstruments||(this.comparisonInstruments=new m,this.listenTo(this.comparisonInstruments,"full",this.updateComparisonSearch)),this.comparisonInstrument=new v({symbol:t&&t.getSymbol(),name:t&&t.getDisplayName()}),this.$chartInstrumentsComparisonPanel=L.render(k.createElement(i(2306),{mainInstrument:this.comparisonInstrument,comparisonInstruments:this.comparisonInstruments}),this.$el.find(".chart-instruments-comparison-panel")[0])},enableComparisonMode:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.range;this.comparisonMode=!0,this.type=y.comparisonType,this.range=t,this.period=C.getPeriodByRange(this.range),this.initComparisonInstruments(),this.resubscribeChart()},disableComparisonMode:function(t,e){this.comparisonMode=!1,this.type=t,this.period=e,L.unmountComponentAtNode(this.$el.find(".chart-instruments-comparison-panel")[0]),this.resubscribeChart(),this.chart.changeCursor()},addComparisonInstrument:function(t){var e=this,i=g.getInstrumentBySymbol(t);if(!this.comparisonInstruments.contains(t)&&i){var n=new v({symbol:i.getSymbol(),name:i.getDisplayName()});n.setSubscription(C.createSubscription({chartId:this.options.chartId,symbol:t,range:this.range,price:$[this.rateLine]})),this.comparisonInstruments.add(n),this.chart.addComparisonInstrument(n,this.comparisonInstruments.length),n.on("remove",function(){e.removeComparisonInstrument(n.getSymbol())}),n.getSubscription().start(this.chartSubscription.getRangeStart())}},removeComparisonInstrument:function(t){},updateComparisonSearch:function(t){this.initToolbar(),this.chartToolbar.updateComparisonSearch(t)},destroy:function(){this.chartSubscription&&this.chartSubscription.stop(),this.destroyBuySellButtons(),o.prototype.destroy.call(this)}})}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0),i(4))},2274:function(t,e,i){(function(n,o){function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var s;void 0!==(s=function(t,e,n){var s=i(0),a=i(15),l=i(3),h=i(12),c=i(287),u=i(2275),d=i(799),p=i(830),f=i(2286),g=i(2291),y=i(2292),v=i(2295),m=/(M\s*\S*\s*\S*\s*L\s*)(\S*)(\s*\S*\s*)/,b=void 0,w=function(t,e,i,n,o,r){var s=this,a=this.chart.get(d.options.names.series.main).xData;void 0!==e&&(arguments[1]=Math.min(e,a[Math.max(0,a.length-d.options.general.candles.overscroll.offset)])),r&&r.DOMEvent&&"mouseup"===r.DOMEvent.type&&setTimeout(function(){var t=s.chart.get(d.options.names.axis.mainX);s.chart.navigator.render(t.min,t.max)},0),t.apply(this,Array.prototype.slice.call(arguments,1))},x=function(t,e,i){t.call(this,e,i),b.each(this.chart.series,function(t){t.chart[t.sharedClipKey]&&t.chart[t.sharedClipKey].attr(i||t.chart.clipBox)})},_=function(t,e,i){if(t.call(this,e,i),b.defined(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var n=this.crossLabel;if(n)if(e||this.isXAxis||i.series.yAxis.options.id===this.options.id||this.crossLabel.hide(),this.isXAxis){if(d.options.chart.label.offsetY){for(var o=this.cross.d.split(" "),r=0,s=-1,a=5,l=o.length;a<l;)o[a]>r&&(r=o[a],s=a),a+=6;if(s>=0){var h=+o[s]+d.options.chart.label.offsetY;o[s]=h,o=o.join(" "),this.cross.attr({d:o}),n.attr({y:h})}}}else if(d.options.chart.label.offsetX){var c=this.cross.d.match(m),u=+c[2]+d.options.chart.label.offsetX;this.cross.attr({d:""+c[1]+u+c[3]}),n.attr({x:u})}}},k=function(t){t.Axis.prototype.protoEvents&&t.Axis.prototype.protoEvents.afterDrawCrosshair&&t.each(t.Axis.prototype.protoEvents.afterDrawCrosshair,function(t,e){t.order=e}),t.addEvent(t.Axis,"afterDrawCrosshair",function(e){if(t.defined(this.crosshair.label)&&this.crosshair.label.enabled&&this.cross){var i=this.chart,n=this.horiz,o=this.opposite,r=this.options.crosshair.label,s=n?"center":o?"right"===this.labelAlign?"right":"left":"left"===this.labelAlign?"left":"center",a=this.crossLabel;a||(a=this.crossLabel=i.renderer.label(null,null,null,r.shape||"callout").addClass("highcharts-crosshair-label"+(this.series[0]&&" highcharts-color-"+this.series[0].colorIndex)).attr({align:r.align||s,padding:t.pick(r.padding,8),r:t.pick(r.borderRadius,3),zIndex:8}).add(),a.attr({fill:r.backgroundColor||this.series[0]&&this.series[0].color||"#666666",stroke:r.borderColor||"","stroke-width":r.borderWidth||0}).css(t.extend({color:"#ffffff",fontWeight:"normal",fontSize:"11px",textAlign:"center"},r.style)))}},{order:-1})},L=new Promise(function(t){t()}).then(i.bind(null,409));L.then(function(t){b=t,b.forEachPolyfill=function(t,e){for(var i=0,n=this.length;i<n;){if(!1===t.call(e,this[i],i,this))return i;i++}},k(b),b.wrap(b.Axis.prototype,"setExtremes",w),b.wrap(b.Axis.prototype,"drawCrosshair",_),b.wrap(b.Pointer.prototype,"scaleGroups",x),i(846)(b),i(847)(b),i(2298)(b),i(2299)(b),i(2300)(b),i(2301)(b)}),n.exports=h.extend({chart:null,plotLines:null,comparisonMode:!1,_initOverscroll:function(){var t=1e3*c[this.period].seconds,e=this.chartSubscription.getLastCandle();this.overscrollData=s.map(s.range(d.options.general.candles.overscroll.total),function(i){return[e.timestamp+(i+1)*t,e.close]}),this.chart.addSeries({type:"line",color:"transparent",shadow:!1,animation:!1,data:this.overscrollData,showInNavigator:!0,tooltip:{enabled:!1,pointFormatter:function(){return null}}})},onDataLoad:function(){var t=this;this.comparisonMode?(this.plotLines&&this.plotLines.currentRate&&(this.plotLines.currentRate.destroy(),delete this.plotLines.currentRate),this._destroyTradingPlotLines()):(a.desktop()&&(this.chartDrawings=new u({chart:this.chart,options:this.drawings,start:this.chartSubscription.getFirstCandle().timestamp,onSave:function(e){return t.trigger("chart:drawings-save",e)},forExport:!1}),this.chartDrawings.externalHandlers.push(b.addEvent(this.chartDrawings,"enableEditing",this.enableDrawingsEditing.bind(this))),this.chartDrawings.externalHandlers.push(b.addEvent(this.chartDrawings,"disableEditing",this.disableDrawingsEditing.bind(this))),delete this.drawings),this._initCurrentRatePlotLine(),this._initTradingPlotLines(),this._initOverscroll(),this._initExtremes()),this._redrawChart()},bindEvents:function(t,e){var i=function(i){var n=t.searchPoint(i,!0);n&&e.setChange(n.y)};if(b.hasTouch){var n=b.addEvent(this.chart.container,"touchmove",i),o=b.addEvent(this.chart.container,"touchstart",i);return function(){n(),o()}}var r=b.addEvent(this.chart.container,"mousemove",i);return function(){r()}},handleHistoricalData:function(t,e){if(this.comparisonMode){var i=this._getMainSeries();if(i){i.setData(p.extendPoints(this.convertCandles(t),this.chartSubscription),!1);var n=this.bindEvents(i,e);e.on("remove",function(){n()}),e.setColor(i.color),this.changeCursor("comparison_crosshair")}}else this._setHistoricalData(t)},_updateCurrentRateLine:function(){"none"===this.rateLine||this.comparisonMode||this.plotLines&&this.plotLines.currentRate&&this.plotLines.currentRate.updateRate(this.chartSubscription.getLastCandle().close)},handleStreamData:function(t,e){this._updateHistoricalData(t,e),this._updateCurrentRateLine(),this._redrawChart()},changeType:function(t){this._changeType(t)},changeCursor:function(t){this._changeCursor(t)},changeTheme:function(t,e){this.applySettings(t)},applySettings:function(t){this.isExists()&&(this._applyChartSettings(t),this._redrawChart())},reflow:function(){this.isExists()&&this.chart.reflow()},makeScreenshot:function(){this._exportChart()},destroy:function(){this.stopListening(),this.chartDrawings&&this.chartDrawings.destroy(),this.chart&&this.chart.destroy&&(this.chart.destroy(),this.chart=null)},zoomIn:function(){this._zoom(.8)},zoomOut:function(){this._zoom(1.25)},isExists:function(){return s.isObject(this.chart)},isOpenPositionsVisible:function(){return this.tradesVisibility.showTrades&&this.tradesVisibility.showAllOpenPositions},isOrdersVisible:function(){return this.tradesVisibility.showTrades&&this.tradesVisibility.showAllOrders},_initCurrentRatePlotLine:function(){this.plotLines?(this.plotLines.currentRate&&this.plotLines.currentRate.destroy(),delete this.plotLines.currentRate):this.plotLines={},"none"!==this.rateLine&&(this.plotLines.currentRate=new g(this.chart,{showInfoLabel:!0,infoLabelKey:"chart.line."+this.rateLine,instrument:this.instrument}),this._updateCurrentRateLine())},updateTradesVisibilityForType:function(t,e,i,n,o,a){var l=this;this.plotLines[e]||(this.plotLines[e]=[]);var h=this.plotLines[e],c=s.pluck(n.models,"cid"),u=s.map(h,function(e){return e.options[t].cid}),d=o?c:s.intersection(c,a),p=s.difference(d,u),f=s.difference(u,d);if(f.length)for(var g=0,y=h.length;g<y;)f.indexOf(h[g].options[t].cid)>=0?(h[g].destroy(),h.splice(g,1),y--):g++;s.each(p,function(e){var o;h.push(new i(l.chart,(o={},r(o,t,n.get(e)),r(o,"instrument",l.instrument),o)))})},updateTradesVisibility:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tradesVisibility;this.enableTrading&&this.plotLines&&t.showTrades&&(this.updateTradesVisibilityForType("order","orders",v,this.instrument.getOrders(),t.showAllOrders,t.visibleTradesIds),this.updateTradesVisibilityForType("position","positions",y,this.instrument.getPositions(),t.showAllOpenPositions,t.visibleTradesIds)),this.tradesVisibility=t},updateTradingCentral:function(t){var e=this;if(this.isExists()){this.tcExremes={min:.9999*t.support3,max:1.0001*t.resistance3};var i=0;this.plotLines||(this.plotLines={}),this.plotLines.tc||(this.plotLines.tc={}),s.each(d.tradingCentralSettings,function(n,o){t[o]?(e.plotLines.tc[o]&&!e.plotLines.tc[o].destroyed||(e.plotLines.tc[o]=new f(e.chart,{className:"tc-"+o,color:t.lines[i++/3>>0].colors[0],showInfoLabel:!0,infoLabelAlign:n.align,infoLabelValue:n.text,precision:e.instrument.getPrecision()})),e.plotLines.tc[o].updateRate(t[o])):i++}),t.pivot===t.resistance1?(this.plotLines.tc.resistance1.destroy(),delete this.plotLines.tc.resistance1):t.pivot===t.support1&&(this.plotLines.tc.support1.destroy(),delete this.plotLines.tc.support1),this._updateValueExtremes(),this._redrawChart()}},updatePrecision:function(t){var e=this;L.then(function(){e.chart.update({tooltip:{valueDecimals:t}})})},startDrawing:function(t){this.isExists()&&this.chartDrawings&&(this.chartDrawings.startDrawing(t),o(this.chart.container).addClass("drawing-started"))},stopDrawing:function(){this.isExists()&&this.chartDrawings&&(this.chartDrawings.stopDrawing(),this.chartDrawings.setActiveDrawing(),o(this.chart.container).removeClass("drawing-started"))},clearDrawings:function(){this.isExists()&&this.chartDrawings&&(this.chartDrawings.clearDrawings(),o(this.chart.container).removeClass("drawing-started"))},_exportChart:function(){var t=this;this.isExists()&&this.chart.exportChartLocal({filename:this.instrument.getDisplayName()+"_"+l().format("YYYYMMDDHHmmss"),type:/Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent)?"image/svg+xml":"image/png"},this.configurator.createExportingConfig({onLoad:function(e){if(t.chartDrawings){new u({chart:e,options:t.chartDrawings.options,forExport:!0})}t.configurator.addChartInfoExporting(e),t.plotLines&&(t.plotLines.currentRate&&t.plotLines.currentRate.exportTo(e),s.each(t.plotLines.positions,function(t){return t.exportTo(e)}),s.each(t.plotLines.orders,function(t){return t.exportTo(e)}),s.each(t.plotLines.tc,function(t){return t.exportTo(e)}))},onRedraw:function(e){t._redrawHandler(e)}}))},resubscribe:function(t){var e=this,i=t.instrument,n=t.period,o=t.type,r=t.rateLine,s=t.indicators,a=t.settings,l=t.drawings,h=t.tradesVisibility,c=t.enableTrading,u=t.cursor,p=t.comparisonMode,f=t.chartSubscription;L.then(function(){e.destroy(),e.instrument=i,e.tradesVisibility=h,e.drawings=l,e.period=n,e.rateLine=r,e.comparisonMode=p,e.enableTrading=c,e.chartSubscription=f,e.extremes=null,e.tcExremes=null,e.chartDrawings&&(e.chartDrawings.destroy(),e.chartDrawings=void 0),e._destroyTradingPlotLines(),u=e.configurator?e.configurator.previousCursor:u,e.configurator=new d({instrumentInfo:e.instrument,type:o,settings:a,indicators:s,comparisonMode:p,onSetExtremes:e._setExtremesHandler.bind(e),onRedraw:e._redrawHandler.bind(e)}),e.chart=new b.StockChart(e.el,e.configurator.createHighchartsConfig()),e._detectIndicatorsSeries(),e._changeCursor(u),e.colors={"#42aa2d":!0,"#de67a7":!0,"#dd7130":!0,"#7a43b0":!0}})},_redrawHandler:function(t){},_setExtremesHandler:function(t){this.extremes=s.pick(t,"min","max"),this._updateValueExtremes()},_initExtremes:function(){var t=this.getTimestamps(),e=d.options.general.candles,i=e.visible;if(1===t.length||i>=t.length)this._getMainXAxis().setExtremes(s.first(t),s.last(t),!1,null);else{var n=t[t.length-(e.overscroll.total-e.overscroll.visible)-i],o=t[t.length-(e.overscroll.total-e.overscroll.visible)-1];this._getMainXAxis().setExtremes(n,o,!1,null)}},_getMainSeries:function(){return this.chart.get(d.options.names.series.main)},_getVolumeSeries:function(){return this.chart.get(d.options.names.series.volume)},_getMainXAxis:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart;return t?t.get(d.options.names.axis.mainX):null},_getMainYAxis:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chart;return t?t.get(d.options.names.axis.mainY):null},convertCandles:function(t){var e=this.configurator.getTypeConverter(),i=void 0,n=s.first(t);return s.map(t,function(t){if(!t.expansion)return i=e(t,i,n)})},_changeType:function(t){if(this.configurator.type!==t&&this.isExists()){var e=this._getMainSeries();e&&(e.remove(!1),this.configurator.type=t,this.chart.addSeries(this.configurator.createMainSeriesConfig(this.convertCandles(this.chartSubscription.getCandles())),!1),this._redrawChart())}},_setHistoricalData:function(t){var e=this,i=this._getMainSeries();if(i){var n=[],o=[],r=this.configurator.getTypeConverter(),a=void 0,l=s.first(t),h=[];s.each(t,function(t){t.studyValues&&s.each(t.studyValues.values,function(i,o){"NaN"!==i&&(n[o]=n[o]||[],n[o].push(e._toIndicatorPoint(t.timestamp,i)))}),t.expansion||(o.push(e._toIndicatorPoint(t.timestamp,t.volume)),a=r(t,a,l),h.push(a))}),i.setData(h,!1),this.configurator.hasVolume&&this._getVolumeSeries().setData(o,!1),s.each(this.inicatorsSeries,function(t,e){return t.setData(n[e],!1)})}},_updateHistoricalData:function(t,e){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._getMainSeries(),o=this.configurator.getTypeConverter();n&&s.each(t,function(t){t.studyValues&&s.each(t.studyValues.values,function(e,n){"NaN"!==e&&i.addOrUpdatePoint(i.inicatorsSeries[n],i._toIndicatorPoint(t.timestamp,e))}),t.expansion||(i.configurator.hasVolume&&i.addOrUpdatePoint(i._getVolumeSeries(),i._toIndicatorPoint(t.timestamp,t.volume)),i.addOrUpdatePoint(n,o(t,i._getLastPoint(),e)))})},_toIndicatorPoint:function(t,e){return[t,e]},addOrUpdatePoint:function(t,e){return t.xData[t.xData.length-1]<e[0]?(this._addPoint(t,e),{added:!0}):{added:!1,updatedIndex:this._updatePoint(t,e)}},_addPoint:function(t,e){t.addPoint(e,!1,!this.comparisonMode,!1)},_updatePoint:function(t,e){var i=t.xData.indexOf(e[0]),n=s.findWhere(t.points,{index:i});return n&&n.x===e[0]?n.update(e,!1,!1):(t.removePoint(i,!1,!1),t.addPoint(e,!1,!1,!1)),i},_getLastPoint:function(){var t=this._getMainSeries().yData;return t=t[t.length-2],s.isArray(t)?[0,t[0],t[1],t[2],t[3]]:[0,0,0,0,t]},_updateValueExtremes:function(){if(this.tcExremes){var t=this._getMainYAxis().getExtremes();this._getMainYAxis().setExtremes(Math.min(t.dataMin,this.tcExremes.min),Math.max(t.dataMax,this.tcExremes.max),!1)}},_redrawChart:function(){this.chart.redraw()},getTimestamps:function(){return s.union(s.pluck(this.chartSubscription.getCandles(),"timestamp"),s.pluck(this.overscrollData,"0"))},_zoom:function(t){if(this.isExists()&&(s.isUndefined(this.chartDrawings)||!this.chartDrawings.isDrawingEditingEnabled())&&!this.comparisonMode){var e=this.getTimestamps();this.extremes||(this.extremes=s.pick(this._getMainXAxis().getExtremes(),"min","max"));var i=Math.max(this.extremes.min,s.first(e)),n=Math.min(this.extremes.max,s.last(e));i=s.sortedIndex(e,i),n=s.sortedIndex(e,n);var o=(n-i)*t,r=(n+i)/2;i=Math.max(Math.round(r-o/2),0),n=Math.min(Math.round(r+o/2),e.length-1),e[i]&&e[n]&&this._getMainXAxis().setExtremes(e[i],e[n])}},_initTradingPlotLines:function(){var t=this;this._destroyTradingPlotLines(),this.enableTrading&&(this.listenTo(this.instrument.getPositions(),"add",function(e){t.isOpenPositionsVisible()&&t.plotLines.positions.push(new y(t.chart,{position:e,instrument:t.instrument}))}),this.listenTo(this.instrument.getOrders(),"add",function(e){t.isOrdersVisible()&&t.plotLines.orders.push(new v(t.chart,{order:e,instrument:t.instrument}))}),this.plotLines.positions=[],this.plotLines.orders=[],this.updateTradesVisibility())},_destroyTradingPlotLines:function(){this.plotLines&&(this.plotLines.positions&&(s.each(this.plotLines.positions,function(t){return t.destroy()}),delete this.plotLines.positions),this.plotLines.orders&&(s.each(this.plotLines.orders,function(t){return t.destroy()}),delete this.plotLines.orders))},_applyChartSettings:function(t){var e=t.switchers.showVolume!==this.configurator.settings.switchers.showVolume,i=t.switchers.showTrades!==this.configurator.settings.switchers.showTrades;this.configurator.settings=t;var n=this.configurator.createHighchartsConfig();this._updateChart(this.chart,n),this._updateAxes(this.chart.xAxis),this._updateAxes(this.chart.yAxis),this._updateNavigator(this.chart.navigator,n),this._updateMainSeries(this._getMainSeries(),n),this._updateVolumeSeries(e,n),i?(this.tradesVisibility.showTrades=t.switchers.showTrades,this.tradesVisibility.showTrades?this._initTradingPlotLines():this._destroyTradingPlotLines()):this._updatePlotLines(t),this._updateChartDrawings(t)},_updateChart:function(t,e){t.update({chart:e.chart},!1)},_updateAxes:function(t){var e=this;s.each(t,function(t){(void 0===t.options.id||t.options.id.indexOf("navigator")<0)&&t.update(e.configurator.getAxisSettings(t.isXAxis,t.options.id===d.options.names.axis.volume),!1)})},_updateNavigator:function(t,e){t.update(e.navigator,!1)},_updateMainSeries:function(t,e){t.update(e.plotOptions[this.configurator.type],!1)},_updatePlotLines:function(t){this.plotLines&&(this.plotLines.currentRate&&this.plotLines.currentRate.applySettings(t),s.each(this.plotLines.positions,function(e){return e.applySettings(t)}),s.each(this.plotLines.orders,function(e){return e.applySettings(t)}),s.each(this.plotLines.tc,function(e){return e.applySettings(t)}))},_updateChartDrawings:function(t){this.chartDrawings&&this.chartDrawings.applySettings(t)},_updateVolumeSeries:function(t,e){var i=this;t&&(this.configurator.hasVolume?(this.chart.addAxis(s.last(e.yAxis),!1,!1),this.chart.addSeries(s.last(e.series),!1).setData(s.map(this.historicalData,function(t){return i._toIndicatorPoint(t.timestamp,t.volume)},!1))):(this.chart.get(d.options.names.series.volume).remove(!1),this.chart.get(d.options.names.axis.volume).remove(!1))),this.configurator.hasVolume&&this.chart.get(d.options.names.series.volume).update(e.plotOptions.column,!1)},_detectIndicatorsSeries:function(){this.inicatorsSeries=s.filter(this.chart.series,function(t){return t.options.id!==this.main&&t.options.id!==this.volume&&t.options.id!==this.navigator},d.options.names.series)},_changeCursor:function(t){if(a.desktop()||"comparison_crosshair"===t){var e=this._getMainXAxis(),i=this._getMainYAxis();if(e&&i&&(!t||t!==this.configurator.currentCursor)){t=t||this.configurator.previousCursor||d.options.general.cursor,this._setCursorTypeClassName(this.$el,t);var n=this.configurator.createCursorConfig(t,this.period);e.update(n.xAxis,!1),s.each(this.chart.yAxis,function(t){t.options.id!==d.options.names.axis.navigatorY&&t.options.id!==d.options.names.axis.volume&&t.update(n.yAxis,!1)}),"drawing"===t||"comparison_crosshair"===t?this.trigger("cursor:unselect"):this.configurator.previousCursor=t,this.configurator.currentCursor=t,n.tooltip.enabled?this.configurator.enableTooltip():(this.configurator.disableTooltip(),this.chart.tooltip.hide(0)),this.chart.pointer.followTouchMove=!!n.tooltip.followTouchMove,this.chart.update({tooltip:n.tooltip},!1),this._redrawChart()}}},enableDrawingsEditing:function(){this.changeCursor("drawing")},disableDrawingsEditing:function(){this.changeCursor()},_setCursorTypeClassName:function(t,e){s.each(s.filter(t[0].classList,function(t){return 0===t.indexOf("cursor-")}),function(e){t.removeClass(e)}),t.addClass("cursor-"+e)},initialize:function(){h.prototype.initialize.apply(this,arguments)},addComparisonInstrument:function(t,e){function i(){l(),a=null,this.colors[r]=!0}var n=this,o=t.getSubscription(),r=void 0,a=void 0,l=void 0;for(var h in this.colors)if(this.colors[h]){r=h,this.colors[h]=!1;break}o.on({start:function(){},timeout:function(){},stop:function(){a&&(a.remove(),a=null)},load:function(e){var h=p.extendPoints(n.convertCandles(e),o);a=n.chart.addSeries(s.extend(n.configurator._createSeriesConfig(h,"ic-"+o.getInstrument().getSymbol(),o.getInstrument().getDisplayName()),{color:r})),l=n.bindEvents(a,t);var c=b.addEvent(a,"remove",function(){i.call(n),c()}),u=b.addEvent(a,"destroy",function(){i.call(n),u()});t.on("remove",function(){o.stop()}),t.setColor(a.color),n.colors[r]=!1},update:function(e){a&&s.each(e,function(e){e.expansion||n.addOrUpdatePoint(a,n.configurator.getTypeConverter()(e,n._getLastPoint(),t.getSubscription().getFirstCandle()))})}})}})}.call(e,i,e,t))&&(t.exports=s)}).call(e,i(0),i(4))},2275:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r,s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(r=function(t,e,n){var r=i(0),a=i(409),l=i(799),h=i(2194),c=i(2284),u={enabled:!1,handlers:[]},d={DOWN:"mousedown",MOVE:"mousemove",UP:"mouseup"},p={DELETE:46,ESC:27},f=function(){function t(e){var i=e.chart,n=e.options,s=e.start,a=e.onSave,l=e.forExport;o(this,t),this._chart=i,this._options=r.compact(n),this._onSave=a,this._start=s,this._type=h.defaultType,this.chart.chartDrawing=this,this.initSVG(),this.externalHandlers=[],l||this.initDrawingSettings()}return s(t,[{key:"chart",get:function(){return this._chart}},{key:"drawings",get:function(){return this._drawings},set:function(t){this._drawings=t}},{key:"options",get:function(){return this._options},set:function(t){this._options=t}},{key:"mainGroup",get:function(){return this._mainGroup}},{key:"backgroundRect",get:function(){return this._backgroundRect}},{key:"drawingFactory",get:function(){return this._drawingFactory}},{key:"onSave",get:function(){return this._onSave},set:function(t){this._onSave=t}},{key:"start",get:function(){return this._start}},{key:"yAxis",get:function(){return this.chart.get(l.options.names.axis.mainY)}},{key:"xAxis",get:function(){return this.chart.get(l.options.names.axis.mainX)}}]),s(t,[{key:"enableEditing",value:function(){u.enabled=!0,u.moved=!1,a.fireEvent(this,"enableEditing")}},{key:"disableEditing",value:function(){u.enabled=!1,u.moved=!1,a.fireEvent(this,"disableEditing")}},{key:"destroy",value:function(){this.removeActiveDrawingHandler.remove(),this.setActiveDrawing(null),r.each(this.externalHandlers,function(t){return t()}),r.each(this.drawings,function(t){return t.destroy()}),this.drawings=[]}},{key:"startDrawing",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h.defaultType;this.enableEditing(),this._type=t,this.bindEvents()}},{key:"stopDrawing",value:function(){this.disableEditing(),this._type=null,this.unbindEvents()}},{key:"initSVG",value:function(){this.initBackgroundRect(),this.initClipRect(),this.initMainGroup(),this.initLoadedDrawings(),this.initGlobalEvents()}},{key:"redraw",value:function(){this.updateClipRect(),this.updateDrawings()}},{key:"updateDrawings",value:function(){r.each(this.drawings,function(t){return t.redraw()})}},{key:"initBackgroundRect",value:function(){this._backgroundRect=this.chart.renderer.rect(0,0,0,0).attr({class:"drawings-background",height:"100%","pointer-events":"visible",width:"100%",zIndex:6}).add()}},{key:"initClipRect",value:function(){var t={x:this.yAxis.left,y:this.yAxis.top,width:this.yAxis.width,height:this.yAxis.height};this._clipRect=this.chart.renderer.clipRect(t)}},{key:"updateClipRect",value:function(){this._clipRect.attr({x:this.yAxis.left,y:this.yAxis.top,width:this.yAxis.width,height:this.yAxis.height})}},{key:"initMainGroup",value:function(){this._mainGroup=this.chart.renderer.g("drawings-container").attr({zIndex:7}).add().clip(this._clipRect)}},{key:"filterDrawings",value:function(t,e,i){return e?r.filter(t,function(t){var n=r.filter(t.keyPoints,function(t){return t.timestamp>e}).length;return i?0===n:0!==n}):t}},{key:"initLoadedDrawings",value:function(){var t=this;this._drawingFactory=new h(this.chart,this.mainGroup),this.drawings=r.compact(r.map(this.filterDrawings(this.options,this.start),function(e){return t.drawingFactory.createDrawing(e)}))}},{key:"initGlobalEvents",value:function(){a.wrap(a.Pointer.prototype,"drag",function(t,e){u.enabled||t.call(this,e)}),a.addEvent(this.chart,"redraw",this.redraw.bind(this)),a.addEvent(this.backgroundRect.element,d.DOWN,function(t){t.currentTarget===t.target&&!u.enabled&&u.drawing&&u.drawing.deactivate()})}},{key:"setActiveDrawing",value:function(t){u.drawing!==t&&(u.drawing&&(u.drawing.deactivate(!0),u.drawing=null,this.drawingSettingsBar.hide()),t&&(u.drawing=t,u.drawing.activate(!0),this.drawingSettingsBar.resetPosition(),this.drawingSettingsBar.show()))}},{key:"bindEvents",value:function(){this.addEvent(d.DOWN,this.mouseDownHandler.bind(this))}},{key:"unbindEvents",value:function(){for(var e in d)t.removeEvent(d[e])}},{key:"rebindEvents",value:function(){this.unbindEvents(),this.bindEvents()}},{key:"mouseDownHandler",value:function(t){this.enableEditing(),this.createDrawing(),this.updateDrawing(t),u.drawing.defaults.points>1&&(u.currentPointIndex=1),this.addEvent(d.MOVE,this.mouseMoveHandler.bind(this)),this.addEvent(d.UP,this.mouseUpHandler.bind(this))}},{key:"mouseMoveHandler",value:function(t){u.moved=!0,this.updateDrawing(t)}},{key:"mouseUpHandler",value:function(e){u.moved||(u.currentPointIndex=0),this.updateDrawing(e),u.currentPointIndex++,u.drawing.defaults.points===u.currentPointIndex?(u.drawing.addEvents(),this.rebindEvents(),u.drawing.isFinished(e)?this.finalizeDrawing(!0):this.unbindEvents()):t.removeEvent(d.DOWN)}},{key:"finalizeDrawing",value:function(t){this.disableEditing(),this.rebindEvents(),t&&this.saveDrawing()}},{key:"createDrawing",value:function(){var t={type:this._type,id:this._type+"_"+r.now()},e=this.drawingFactory.createDrawing(t);e.notSaved=!0,e.init(!0),e.activate(),u.currentPointIndex=0}},{key:"updateDrawing",value:function(t){u.drawing.update(u.currentPointIndex,t.chartX,t.chartY)}},{key:"saveDrawing",value:function(t){t&&u.drawing.notSaved||(u.drawing&&u.drawing.notSaved&&(this.drawings.push(u.drawing),delete u.drawing.notSaved,this.drawingSettingsBar.render()),this.options=r.uniq(r.pluck(this.drawings,"options").concat(this.filterDrawings(this.options,this.start,!0)),"id"),r.isFunction(this.onSave)&&this.onSave(this.options))}},{key:"clearDrawings",value:function(){this.setActiveDrawing(null),r.each(this.drawings,function(t){return t.destroy()}),this.drawings=[],this.options=[],r.isFunction(this.onSave)&&this.onSave(this.options)}},{key:"addEvent",value:function(e,i){var n=this;t.removeEvent(e),u.handlers[e]={remove:a.addEvent(this.chart.container,e,function(t){t=n.normalize(t),n.isInsideAxis(t)&&i(t)})}}},{key:"normalize",value:function(t){return t=t||window.event,t.chartX&&t.chartY?t:this.chart.pointer.normalize(t)}},{key:"isInsideAxis",value:function(t){return t.chartX>=this.yAxis.left&&t.chartY>=this.yAxis.top&&t.chartX<=this.yAxis.left+this.yAxis.width&&t.chartY<=this.yAxis.top+this.yAxis.height}},{key:"removeActiveDrawing",value:function(){if(u.drawing){var t=u.drawing;t.deactivate(),t.destroy();var e=this.drawings.indexOf(t);e>=0&&(this.drawings.splice(e,1),this.saveDrawing())}}},{key:"getActiveDrawing",value:function(){return u.drawing}},{key:"addKeyboardListener",value:function(t,e,i){var n=function(i){i=i||window.event,i.keyCode===t&&e()};return document.addEventListener("keydown",n,i||!1),{remove:function(){return document.removeEventListener("keydown",n)}}}},{key:"initDrawingSettings",value:function(){this.removeActiveDrawingHandler=this.addKeyboardListener(p.DELETE,this.removeActiveDrawing.bind(this)),this.drawingSettingsBar=new c({chartDrawing:this,parent:this.chart.container}),this.drawingSettingsBar.hide()}},{key:"isDrawingEditingEnabled",value:function(){return u.enabled}},{key:"applySettings",value:function(t){r.each(this.drawings,function(e){return e.applySettings&&e.applySettings(t)})}}],[{key:"removeEvent",value:function(t){if(u.handlers[t]){if(!r.isFunction(u.handlers[t].remove))throw new Error('Handler for "'+t+'" is not a function');u.handlers[t].remove(),delete u.handlers[t]}}}]),t}();n.exports=f}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0))},2276:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(a=function(t,e,n){var a=i(0),c=i(2024),u={id:null,keyPoints:[],type:"line",properties:{line:{lineColor:"#2e86ab",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},labels:{showPrice:!1,pricePlacement:"right"},defaultKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#2e86ab",lineColor:"#2e86ab",opacity:1},activeKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#ffc800",lineColor:"#ffc800",opacity:1},addingKeyPoint:{shape:"none"}},data:{}},d=function(t){function e(t,i,n){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n))}return s(e,t),l(e,[{key:"_init",value:function(){this.$container=this.createG(),this.$element=this.createLine(),this.$hoverElement=this.createLineHover(),this.$points=this.createPoints()}},{key:"_update",value:function(t,e){}},{key:"_move",value:function(t,e,i,n){}},{key:"_render",value:function(t){var e=void 0;switch(t){case 1:break;case 2:e=this.initPath(),this.$element.attr({d:e}),this.$hoverElement.attr({d:e})}}},{key:"_destroy",value:function(){this.$container.destroy()}},{key:"initPath",value:function(){return["M",this.$points[0].x,this.$points[0].y,"L",this.$points[1].x,this.$points[1].y]}},{key:"_setColor",value:function(t){this.$element.attr({stroke:t}),a.each(this.$points,function(e){return e.setColor(t)})}},{key:"defaults",get:function(){return a.extend(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:2})}},{key:"fxclientOptions",get:function(){return u}}]),e}(c);n.exports=d}.call(e,i,e,t))&&(t.exports=a)}).call(e,i(0))},2277:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(a=function(t,e,n){var a=i(0),c=i(2024),u={id:null,keyPoints:[],type:"horizontal_line",properties:{line:{lineColor:"#2e86ab",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},defaultKeyPoint:{shape:"none"},activeKeyPoint:{shape:"none"},addingKeyPoint:{shape:"none"},style:{extendLeft:!0,extendRight:!0}},data:{}},d=function(t){function e(t,i,n){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n))}return s(e,t),l(e,[{key:"_init",value:function(){this.$container=this.createG(),this.$points=this.createPoints(),this.$element=this.createLine(),this.$hoverElement=this.createLineHover()}},{key:"_update",value:function(t,e){}},{key:"_move",value:function(t,e,i,n){}},{key:"_render",value:function(){switch(this.options.keyPoints.length){case 1:var t=this.initPath();this.$element.attr({d:t}),this.$hoverElement.attr({d:t})}}},{key:"_destroy",value:function(){this.$container.destroy()}},{key:"initPath",value:function(){return["M",0,this.$points[0].y,"L",this.yAxis.width,this.$points[0].y]}},{key:"_setColor",value:function(t){this.$element.attr({stroke:t}),a.each(this.$points,function(e){return e.setColor(t)})}},{key:"defaults",get:function(){return a.extend(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:1})}},{key:"fxclientOptions",get:function(){return u}}]),e}(c);n.exports=d}.call(e,i,e,t))&&(t.exports=a)}).call(e,i(0))},2278:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(a=function(t,e,n){var a=i(0),c=i(2024),u={id:null,keyPoints:[],type:"vertical_line",properties:{line:{lineColor:"#2e86ab",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},defaultKeyPoint:{shape:"none"},activeKeyPoint:{shape:"none"},addingKeyPoint:{shape:"none"}},data:{}},d=function(t){function e(t,i,n){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n))}return s(e,t),l(e,[{key:"_init",value:function(){this.$container=this.createG(),this.$points=this.createPoints(),this.$element=this.createLine(),this.$hoverElement=this.createLineHover()}},{key:"_update",value:function(t,e){}},{key:"_move",value:function(t,e,i,n){}},{key:"_render",value:function(t){switch(t){case 1:var e=this.initPath();this.$element.attr({d:e}),this.$hoverElement.attr({d:e})}}},{key:"_destroy",value:function(){this.$container.destroy()}},{key:"initPath",value:function(){return["M",this.$points[0].x,0,"L",this.$points[0].x,this.yAxis.height]}},{key:"_setColor",value:function(t){this.$element.attr({stroke:t}),a.each(this.$points,function(e){return e.setColor(t)})}},{key:"defaults",get:function(){return a.extend(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:1})}},{key:"fxclientOptions",get:function(){return u}}]),e}(c);n.exports=d}.call(e,i,e,t))&&(t.exports=a)}).call(e,i(0))},2279:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(a=function(t,e,n){var a=i(0),c=i(2024),u=i(2137),d={id:null,keyPoints:[],type:"trend_channel",properties:{line:{lineColor:"#2e86ab",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},defaultKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#2e86ab",lineColor:"#2e86ab",opacity:1},activeKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#ffc800",lineColor:"#ffc800",opacity:1},addingKeyPoint:{shape:"none"}},data:{}},p=function(t){function e(t,i,n){return o(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n))}return s(e,t),l(e,[{key:"_init",value:function(){this.$container=this.createG(),this.$filledArea=this.createFilledArea(),this.$element=this.createLine(),this.$hoverElement=this.createLineHover(),this.$points=this.createPoints(),this.hidden={}}},{key:"_update",value:function(t,i){if(2===t){var n=e.parallelogram(this.$points[0],this.$points[1],i);i.setPixels((n[2].x+n[3].x)/2,(n[2].y+n[3].y)/2)}}},{key:"_move",value:function(t,i,n,o){if(!a.isUndefined(o))if(2!==o.index&&null!==this.hidden.height){var r=(this.$points[0].x+this.$points[1].x)/2,s=(this.$points[0].y+this.$points[1].y)/2;s+=this.hidden.height,this.$points[2].setPixels(r,s),this.$points[2].convert(!0)}else{var l=e.parallelogram(this.$points[0],this.$points[1],this.$points[2]);this.hidden.height=l[3].y-l[0].y,this.$points[2].setPixels((l[2].x+l[3].x)/2,(l[2].y+l[3].y)/2)}}},{key:"_render",value:function(t){var i=void 0;switch(t){case 1:break;case 2:i=["M",this.$points[0].x,this.$points[0].y,"L",this.$points[1].x,this.$points[1].y],this.$element.attr({d:i}),this.$hoverElement.attr({d:i});break;case 3:var n=e.parallelogram(this.$points[0],this.$points[1],this.$points[2]);this.hidden.height=n[3].y-n[0].y,this.$filledArea.attr({d:["M",n[0].x,n[0].y,"L",n[1].x,n[1].y,"L",n[2].x,n[2].y,"L",n[3].x,n[3].y]}),i=["M",n[0].x,n[0].y,"L",n[1].x,n[1].y,"M",n[2].x,n[2].y,"L",n[3].x,n[3].y],this.$element.attr({d:i}),this.$hoverElement.attr({d:i})}}},{key:"_destroy",value:function(){this.$container.destroy()}},{key:"_setColor",value:function(t){this.$element.attr({stroke:t}),this.$filledArea.attr({fill:t}),a.each(this.$points,function(e){return e.setColor(t)})}},{key:"defaults",get:function(){return a.extend(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:3})}},{key:"fxclientOptions",get:function(){return d}}],[{key:"parallelogram",value:function(t,e,i){var n=new u(e.x-t.x,e.y-t.y),o=new u(i.x-t.x,i.y-t.y),r=o.x*n.y-o.y*n.x;if(Math.abs(n.x)<.1)return[t,e,t,e];var s=r/n.x;return[t,e,new u(e.x,e.y-s),new u(t.x,t.y-s)]}}]),e}(c);n.exports=p}.call(e,i,e,t))&&(t.exports=a)}).call(e,i(0))},2280:function(t,e,i){(function(n){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(a=function(t,e,n){var a=i(0),c=i(2024),u=[0,.236,.382,.5,.618,.764,1,1.618,2.618,3.618,4.236],d={id:null,keyPoints:[],type:"line",properties:{line:{lineColor:"#2e86ab",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},labels:{showPrice:!1,pricePlacement:"right"},defaultKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#2e86ab",lineColor:"#2e86ab",opacity:1},activeKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#ffc800",lineColor:"#ffc800",opacity:1},addingKeyPoint:{shape:"none"}},data:{}},p=function(t){function e(t,i,n){o(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n));return s.precision=t.options.tooltip.valueDecimals,s}return s(e,t),l(e,[{key:"_init",value:function(){this.$container=this.createG(),this.$levels=[];for(var t=0;t<u.length;t++)this.$levels.push({$levelLine:this.createLine(),$priceLabel:this.createLabel(),$coefLabel:this.createLabel()});this.$element=this.createLine(),this.$hoverElement=this.createLineHover(),this.$points=this.createPoints()}},{key:"_update",value:function(t,e){}},{key:"_move",value:function(t,e,i,n){}},{key:"_render",value:function(t){var e=void 0;switch(t){case 1:break;case 2:var i=this.$points[0].x<this.$points[1].x?0:1,n=1-i,o=this.$points[i],r=this.$points[n];if(o===r)return;o.convert(!0),r.convert(!0);for(var s=o.y-r.y,a=0;a<this.$levels.length;a++){var l=this.$levels[a],h=r.y+s*u[a],c=r.value+(o.value-r.value)*u[a];l.$levelLine.attr({d:["M",o.x,h,"L",r.x,h]}),l.$priceLabel.attr({text:c.toFixed(this.precision)}),l.$priceLabel.attr({x:r.x-this.$levels[a].$priceLabel.width,y:h+2}),l.$coefLabel.attr({text:u[a].toFixed(3),x:o.x,y:h+2})}e=this.initPath(),this.$element.attr({d:e}),this.$hoverElement.attr({d:e})}}},{key:"_destroy",value:function(){this.$container.destroy()}},{key:"initPath",value:function(){return["M",this.$points[0].x,this.$points[0].y,"L",this.$points[1].x,this.$points[1].y]}},{key:"_setColor",value:function(t){this.$element.attr({stroke:t}),a.each(this.$levels,function(e){return e.$levelLine.attr({stroke:t})}),a.each(this.$points,function(e){return e.setColor(t)})}},{key:"defaults",get:function(){return a.extend(h(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:2})}},{key:"fxclientOptions",get:function(){return d}}]),e}(c);n.exports=p}.call(e,i,e,t))&&(t.exports=a)}).call(e,i(0))},2281:function(t,e,i){(function(n,o){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var l,h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(l=function(t,e,n){var o=i(0),l=i(4),u=i(2024),d=i(2138),p={id:null,keyPoints:[],type:"text",properties:{line:{lineColor:"#a3c4e3",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},labels:{showPrice:!1,pricePlacement:"right"},defaultKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#2e86ab",lineColor:"#2e86ab",opacity:1},activeKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#ffc800",lineColor:"#ffc800",opacity:1},addingKeyPoint:{shape:"none"},text:{textFill:"rgba(255, 255, 255, 1)",textBg:"transparent",textSize:"11px",backgroundOffsetWidth:7,backgroundOffsetHeight:5}},data:{text:""}},f=function(t){function e(t,i,n){return r(this,e),s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n))}return a(e,t),h(e,[{key:"_init",value:function(){var t=this;this.$container=this.createG(),this.$element=this.createLine(),this.$hoverElement=this.createLineHover(),this.$text=this.createText({text:this.prepareSvgText(this.options.data.text)}),this.$points=this.createPoints(),this.$text.on("mousedown",function(e){e.stopImmediatePropagation(),t.activate()}),this.$text.on("dblclick",function(e){e.stopImmediatePropagation(),t.activate(),new d(t)})}},{key:"_update",value:function(t,e){}},{key:"_move",value:function(t,e,i,n){this.$textNoteInput&&this.$textNoteInput.updatePosition(t,e,i,n)}},{key:"_isFinished",value:function(t){return this.waitForText(t),!1}},{key:"prepareSvgText",value:function(t){return o.isString(t)?t.replace(/\n/g,"<br/>"):null}},{key:"waitForText",value:function(t){t?this.$textNoteInput||(this.$textNoteInput=new e.Input(t,this)):new d(this)}},{key:"save",value:function(t){if(o.isObject(t)||o.isString(t)){if(o.isObject(t))this.options.properties.text.textSize=t["font-size"]+"px",this.options.data.text=t["text-note"];else{if(!o.isString(t))return;this.options.data.text=t,this.$textNoteInput&&(this.$textNoteInput.remove(),delete this.$textNoteInput)}o.isString(this.options.data.text)&&this.options.data.text.trim()?(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"finalize",this).call(this,!0),this.$text.attr({text:this.prepareSvgText(this.options.data.text)}).css({fontSize:parseInt(this.options.properties.text.textSize)+"px"}),this._render(this.$points.length)):(this.remove(),c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"finalize",this).call(this,!1))}else c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"save",this).call(this)}},{key:"_render",value:function(t){switch(t){case 1:var e=this.$points[0].x;this.$points[0].x+this.$text.getBBox().width>this.yAxis.width&&(e-=this.$text.getBBox().width);var i=this.$points[0].y;this.$text.attr({x:e,y:i});var n=["M",e,i,"h",this.$text.getBBox().width,"v",this.$text.getBBox().height,"h",-this.$text.getBBox().width,"Z"];this.$hoverElement.attr({d:n})}}},{key:"_destroy",value:function(){this.$textNoteInput&&this.$textNoteInput.remove(),this.$container.destroy()}},{key:"_setColor",value:function(t){this.$text.attr({fill:this.getFillColor(t)}),this.$text.attr({stroke:t}),o.each(this.$points,function(e){return e.setColor(t)})}},{key:"getFillColor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getColor();return"#a3c4e3"===t?"rgba(239, 247, 254)":u.lightenDarkenColor(t,75)}},{key:"defaults",get:function(){return o.extend(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:1})}},{key:"fxclientOptions",get:function(){return p}},{key:"configurableOptions",get:function(){return[{name:"font-size",title:__("chart_drawings.settings.text_size"),type:"select",options:["10","11","12","13","14","15","16"],value:parseInt(this.options.properties.text.textSize)},{name:"text-note",title:__("chart_drawings.settings.text_note"),type:"textarea",value:this.options.data.text}]}}]),e}(u);f.Input=function(){function t(e,i){var n=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{text:"",fontSize:"11px"};r(this,t),this.xAxis=i.xAxis,this.position=o.pick(e,"clientX","clientY","chartX","chartY"),this.onSaveCallback=i.save.bind(i),this.$container=l("<div>",{class:"text-note-area"}).css({fontSize:s.fontSize,top:this.position.clientY+"px",left:this.position.clientX+"px"}).appendTo(document.body),this.$textarea=l("<textarea>",{maxlength:"100","white-space":"pre"}).val(s.text).appendTo(this.$container),this.$textarea[0].focus(),this.updateSize(),this.$textarea.on("change drop keydown paste cut",this.onChange.bind(this)),setTimeout(function(){var t=[n.$textarea[0],n.$container[0],i.$points[0].$svg.element];n.outsideClickHandler=function(e){t.indexOf(e.target)<0&&n.applyText()},document.body.addEventListener("mousedown",n.outsideClickHandler,!0)},1)}return h(t,[{key:"updateSize",value:function(){this.$textarea.css("width","0px"),this.$textarea.css("height","0px");var t=Math.max(50,this.$textarea[0].scrollWidth);this.$textarea.css("width",t+"px");var e=Math.max(10,this.$textarea[0].scrollHeight);return this.$textarea.css("height",e+"px"),{width:t,height:e}}},{key:"updatePosition",value:function(t,e,i){this.$container.css({display:t?"block":"none",top:parseInt(this.$container.css("top"))+i+"px",left:parseInt(this.$container.css("left"))+e+"px"}),this.position.clientX+=e,this.position.clientY+=i,this.position.chartX+=e,this.position.chartY+=i,t&&(this.$textarea[0].focus(),this.render())}},{key:"applyText",value:function(){this.onSaveCallback(this.$textarea.val())}},{key:"remove",value:function(){document.body.removeEventListener("mousedown",this.outsideClickHandler,!0),this.$container.remove(),delete this.$container}},{key:"render",value:function(){if(this.$container){this.updateSize();var t=parseInt(this.$container.css("width"));this.$container.css("left",this.position.clientX-(this.position.chartX+t>this.xAxis.width?t:0)+"px")}}},{key:"onChange",value:function(t){var e=this;t&&(t.ctrlKey&&13===t.keyCode||27===t.keyCode)?this.applyText():setTimeout(function(){return e.render()},0)}}]),t}(),n.exports=f}.call(e,i,e,t))&&(t.exports=l)}).call(e,i(0),i(4))},2282:function(t,e){t.exports='<div class="drawing-settings-panel"><div class="drawing-settings-form"></div><div class="drawing-settings-footer"><div class="action-buttons"><button class="btn btn-primary fn-save"><%=__(\'actions.save\')%></button> <button class="btn fn-cancel"><%=__(\'actions.cancel\')%></button></div></div></div>'},2283:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)},l=i(4),h=i(2024),c=i(0),u=i(3),d=i(2139),p=c.template('\n        <span class="ml-key"><%= __(\'chart_drawings.measurer.start\')%> : </span><span class="ml-val" style="font-weight: bold; text-anchor: end"><%= start%></span>\n        <br/>\n        <span class="ml-key"><%= __(\'chart_drawings.measurer.end\')%> : </span><span class="ml-val" style="font-weight: bold; text-anchor: end"><%= end%></span>\n        <br/>\n        <span class="ml-key"><%= __(\'chart_drawings.measurer.high\')%> : </span><span class="ml-val" style="font-weight: bold; text-anchor: end"><%= high%></span>\n        <br/>\n        <span class="ml-key"><%= __(\'chart_drawings.measurer.low\')%> : </span><span class="ml-val" style="font-weight: bold; text-anchor: end"><%= low%></span>\n        <br/>\n        <span class="ml-key"><%= __(\'chart_drawings.measurer.difference\')%> : </span><span class="ml-val" style="font-weight: bold; text-anchor: end"><%= difference%></span>\n        <br/>\n        <span class="ml-key"><%= __(\'chart_drawings.measurer.candles\')%> : </span><span class="ml-val" style="font-weight: bold; text-anchor: end"><%= candles%></span>\n'),f={TIMESTAMP:0,CANDLE_CLOSE:4,POINT_CLOSE:1},g={id:null,keyPoints:[],type:"measurer",properties:{line:{lineColor:"#2e86ab",lineWidth:1,lineDash:[]},activeLine:{lineColor:"#ffc800",lineWidth:1,lineDash:[]},labels:{showPrice:!1,pricePlacement:"right"},defaultKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#2e86ab",lineColor:"#2e86ab",opacity:1},activeKeyPoint:{shape:"square",side:6,lineWidth:0,fillStyle:"#ffc800",lineColor:"#ffc800",opacity:1},addingKeyPoint:{shape:"none"}},data:{}},y=function(t){function e(t,i,r){n(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,r));return s.precision=t.options.tooltip.valueDecimals,s}return r(e,t),s(e,[{key:"_init",value:function(){this.$container=this.createG(),this.$filledArea=this.createFilledArea(),this.$filledArea.attr({"fill-opacity":"0.1","stroke-width":1,stroke:this.getColor(),dashstyle:d.DASH}),this.$label=this.createLabel({shape:"callout",className:"measurer-label"}).attr({align:"left",fill:this.chartDrawing.chart.options.chart.backgroundColor,stroke:"#919292","stroke-width":1,padding:4,r:0}).css({color:this.chartDrawing.chart.options.xAxis[0].labels.style.color}),this.$element=this.createLine(),this.$gridElement=this.createLine().attr({dashstyle:d.DOT}),this.$hoverElement=this.createLineHover(),this.$points=this.createPoints()}},{key:"_update",value:function(t,e){}},{key:"_move",value:function(t,e,i,n){}},{key:"_render",value:function(t){switch(t){case 1:break;case 2:var i=this.$points[0].x<this.$points[1].x?0:1,n=1-i,o=this.$points[i],r=this.$points[n];if(o===r)return;o.convert(!0),r.convert(!0);var s=o.value-r.value,a=100*s/o.value,h=this.getCandlesCount(o,r),d=this.getHighAndLow(o,r),f=d.high,g=d.low;this.$label.attr({text:p({start:u(o.timestamp).utc().format("DD/MM/YYYY HH:mm")+" : "+o.value.toFixed(this.precision),end:u(r.timestamp).utc().format("DD/MM/YYYY HH:mm")+" : "+r.value.toFixed(this.precision),high:u(f.timestamp).utc().format("DD/MM/YYYY HH:mm")+" : "+f.value.toFixed(this.precision),low:u(g.timestamp).utc().format("DD/MM/YYYY HH:mm")+" : "+g.value.toFixed(this.precision),difference:s.toFixed(this.precision)+" ("+a.toFixed(2)+"%)",candles:h})});var y=this.$label.text.element.getBBox().width;c.each(l(this.$label.element).find(".ml-val"),function(t){t.getAttribute("x")||(t.setAttribute("x",y),t.removeAttribute("dx"))}),this.$label.attr(e.getLabelPosition(this.$label,this.yAxis,o,r)),this.$element.attr({d:this.initPath()}),this.$filledArea.attr({d:["M",o.x,o.y,"L",r.x,o.y,"L",r.x,r.y,"L",o.x,r.y,"Z"]}),this.$gridElement.attr({d:["M",0,o.y,"L",o.x,o.y,"L",o.x,0,"M",r.x,0,"L",r.x,o.y,"L",this.yAxis.width,o.y,"M",this.yAxis.width,r.y,"L",r.x,r.y,"L",r.x,this.yAxis.height,"M",o.x,this.yAxis.height,"L",o.x,r.y,"L",0,r.y,"M",(o.x+r.x)/2,o.y,"L",(o.x+r.x)/2,r.y,"M",o.x,(o.y+r.y)/2,"L",r.x,(o.y+r.y)/2]}),this.$hoverElement.attr({d:["M",o.x,o.y,"L",r.x,o.y,"L",r.x,r.y,"L",o.x,r.y,"L",o.x,o.y,"L",r.x,o.y,"M",o.x,o.y,"L",r.x,r.y]})}}},{key:"getCandlesCount",value:function(t,e){var i=c.union.apply(this,c.map(this.xAxis.series,function(t){return t.xData}));return c.sortedIndex(i,e.timestamp)-c.sortedIndex(i,t.timestamp)}},{key:"_destroy",value:function(){this.$container.destroy()}},{key:"initPath",value:function(){return["M",this.$points[0].x,this.$points[0].y,"L",this.$points[1].x,this.$points[1].y]}},{key:"_setColor",value:function(t){this.$element.attr({stroke:t}),this.$filledArea.attr({fill:t,stroke:t}),this.$gridElement.attr({stroke:t}),c.each(this.$points,function(e){return e.setColor(t)})}},{key:"applySettings",value:function(t){this.$label&&this.$label.attr({fill:t.colors.common.background}).css({color:t.colors.common.foreground})}},{key:"getHighAndLow",value:function(t,e){var i={value:0,timestamp:null},n={value:1e10,timestamp:null};return c.each(this.xAxis.chart.series[0].options.data,function(o){var r=o[f.TIMESTAMP];if(r>=t.timestamp&&r<=e.timestamp){var s=o[f.CANDLE_CLOSE]||o[f.POINT_CLOSE];s>i.value&&(i.value=s,i.timestamp=r),s<n.value&&(n.value=s,n.timestamp=r)}}),{high:i,low:n}}},{key:"fxclientOptions",get:function(){return g}},{key:"defaults",get:function(){return c.extend(a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"defaults",this),{points:2})}}],[{key:"getLabelPosition",value:function(t,e,i,n){var o=t.height,r=t.width,s=e.height,a=e.width,l={min:{x:Math.min(i.x,n.x),y:Math.min(i.y,n.y)},max:{x:Math.max(i.x,n.x),y:Math.max(i.y,n.y)},middle:{x:(i.x+n.x)/2,y:(i.y+n.y)/2}},h={top:l.min.y-7-o,bottom:l.max.y+7+o,left:l.min.x-7-r,right:l.max.x+7+r};switch(!0){case s>h.bottom:return{x:l.middle.x-r/2,y:l.max.y+7,anchorX:l.middle.x,anchorY:l.max.y};case h.top>0:return{x:l.middle.x-r/2,y:l.min.y-o-7,anchorX:l.middle.x,anchorY:l.min.y};case h.left>0:return{x:l.min.x-r-7,y:l.middle.y-o/2,anchorX:l.min.x,anchorY:l.middle.y};case a>h.right:return{x:l.max.x+7,y:l.middle.y-o/2,anchorX:l.max.x,anchorY:l.middle.y};default:return{x:-r,y:-o,anchorX:-7,anchorY:-7}}}}]),e}(h);t.exports=y},2284:function(t,e,i){(function(n,o){var r;void 0!==(r=function(t,e,n){var o=i(0),r=i(4),s=(i(2),i(2042)),a=i(291),l=i(2138);n.exports=s.extend({className:"floating-drawing-settings",template:o.template(i(2285)),events:function(){return o.extend({},o.result(s.prototype,"events"),{"click .fn-drawing-remove":"removeDrawing","click .fn-drawing-settings":"showDrawingSettings"})},onMouseDown:function(t){s.prototype.onMouseDown.apply(this,arguments),t.stopPropagation()},onMouseUp:function(t){s.prototype.onMouseUp.apply(this,arguments)},onMouseMove:function(t){s.prototype.onMouseMove.apply(this,arguments),this.isDragReady&&t.stopPropagation()},initialize:function(t){this.chartDrawing=t.chartDrawing,s.prototype.initialize.apply(this,arguments),r(this.parent).append(this.el)},removeDrawing:function(){this.chartDrawing.removeActiveDrawing()},showDrawingSettings:function(){return new l(this.chartDrawing.getActiveDrawing())},hide:function(){this.$el.css({display:"none"})},show:function(){this.render(),this.$el.css({display:"block"})},render:function(){this.options.settingsAvailable=!1,this.options.colorAvailable=!1;var t=this.options.chartDrawing.getActiveDrawing();if(t&&!t.notSaved&&(this.options.settingsAvailable=t.configurableOptions&&t.configurableOptions.length>0,this.options.colorAvailable=t.getColor&&t.getColor()),s.prototype.render.call(this),this.options.colorAvailable){var e=new a({el:this.$el.find(".drawing-color")[0],value:t.getColor(),container:this.$el});this.listenTo(e,"change",function(e,i){return t.setColor(i)})}},resetPosition:function(){this.$el.css({top:"",bottom:"",left:"",right:""})}})}.call(e,i,e,t))&&(t.exports=r)}).call(e,i(0),i(4))},2285:function(t,e){t.exports='<div class="floating-drawing-settings-container"><div class="separator dots-separator"></div> <% if (settingsAvailable) {%> <div class="icon icon-settings drawing-settings fn-drawing-settings"></div> <%}%> <% if (colorAvailable) {%> <div class="drawing-color"></div> <%}%> <div class="icon icon-recycle-blue drawing-remove fn-drawing-remove"></div></div>'},2286:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(s=function(t,e,s){var l=i(2034),h={color:"#38424b",dashstyle:l.DASH_STYLES.SOLID,showRateLabel:!0},c=function(t){function e(t,i){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i))}return r(e,t),a(e,[{key:"defaults",get:function(){return h}}]),e}(l);s.exports=c}.call(e,i,e,t))&&(t.exports=s)},2287:function(t,e,i){t.exports=i.p+"images/64f113f33482.png"},2288:function(t,e,i){t.exports=i.p+"images/e55d8022bf98.png"},2289:function(t,e,i){t.exports=i.p+"images/673da6b1b7fa.png"},2290:function(t,e,i){t.exports=i.p+"images/abf4f0300532.png"},2291:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(s=function(t,e,s){var l=i(2034),h={color:"#de67a7",dashstyle:l.DASH_STYLES.SOLID,showRateLabel:!0},c=function(t){function e(t,i){return n(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i))}return r(e,t),a(e,[{key:"defaults",get:function(){return h}}]),e}(l);s.exports=c}.call(e,i,e,t))&&(t.exports=s)},2292:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)},l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(s=function(t,e,s){var h=(i(0),i(2)),c=i(2034),u=i(2293),d=i(2294),p=i(2025),f={color:"#2e86ab",dashstyle:c.DASH_STYLES.SOLID,handleEvents:!0,infoLabelKey:"chart.line.open",infoLabelShowRate:!0,showCloseButton:!0,showEditButton:!0,showInfoLabel:!0,showProfitLossLabel:!0,showRateLabel:!1,showTpslButton:!0},g=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.updateTplsButtonVisibility(),r.onInstrumentStatusChange(),r.updateRate(r.options.position.getCostBasis()),r.updatePl(r.options.position.getPLOpen()||0),r.listenTo(r.options.instrument,"change:closable change:editable",r.onInstrumentStatusChange.bind(r)),r.listenTo(r.options.position,"change:plOpen",function(t,e){return r.updatePl(e)}),r.listenTo(r.options.position,"change:takeProfit",r.onTakeProfitChange.bind(r)),r.listenTo(r.options.position,"change:stopLoss",r.onStopLossChange.bind(r)),r.listenTo(r.options.position,"remove",r.destroy.bind(r)),r}return r(e,t),l(e,[{key:"defaults",get:function(){return f}}]),l(e,[{key:"exportTo",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"exportTo",this).call(this,t),this.tpRateLine&&this.tpRateLine.exportTo(t),this.slRateLine&&this.slRateLine.exportTo(t)}},{key:"updateTplsButtonVisibility",value:function(){this.options.position.getTakeProfit()||this.options.position.getStopLoss()?this.$tpslButton.show(!0):this.tpRateLine||this.slRateLine||(this.$tpslButton.hide(),this.$tpslButton.enable(),this.tpslEnabled=!1)}},{key:"destroy",value:function(){this.destroyTPRateLine(),this.destroySLRateLine(),this.editPositionModel&&(this.editPositionModel.destroy(),this.editPositionModel=null),a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"onEditButtonCLick",value:function(){h.trigger("ui:edit-position",this.options.position,!0)}},{key:"onCloseButtonClick",value:function(){h.trigger("ui:close-position",this.options.position)}},{key:"onInstrumentStatusChange",value:function(){this.options.instrument.status.isEditable()?this.enableDragging():this.disableDragging(),this.options.instrument.status.isEditable()?this.$editButton.enable():this.$editButton.disable(),this.options.instrument.status.isClosable()?this.$closeButton.enable():this.$closeButton.disable()}},{key:"onTpslButtonClick",value:function(){this.tpslEnabled?(this.editPositionModel.destroy(),this.editPositionModel=null,this.destroyTPRateLine(),this.destroySLRateLine(),this.$tpslButton.enable()):(this.editPositionModel=p.createEditPositionModel(this.options.position,this.options.instrument),this.options.position.getTakeProfit()&&this.createTPRateLine(),this.options.position.getStopLoss()&&this.createSLRateLine(),this.$tpslButton.press()),this.tpslEnabled=!this.tpslEnabled}},{key:"onTakeProfitChange",value:function(){this.tpslEnabled&&(this.options.position.getTakeProfit()?this.tpRateLine?this.tpRateLine.updateRate(this.options.position.getTakeProfit().fixedPrice):this.createTPRateLine():this.destroyTPRateLine()),this.updateTplsButtonVisibility()}},{key:"onStopLossChange",value:function(){this.tpslEnabled&&(this.options.position.getStopLoss()?this.slRateLine?this.slRateLine.updateRate(this.options.position.getStopLoss().fixedPrice):this.createSLRateLine():this.destroySLRateLine()),this.updateTplsButtonVisibility()}},{key:"createSLRateLine",value:function(){this.slRateLine=new d(this.chart,{editPositionModel:this.editPositionModel,position:this.options.position,instrument:this.options.instrument})}},{key:"createTPRateLine",value:function(){this.tpRateLine=new u(this.chart,{editPositionModel:this.editPositionModel,position:this.options.position,instrument:this.options.instrument})}},{key:"destroySLRateLine",value:function(){this.slRateLine&&(this.slRateLine.destroy(),this.slRateLine=null)}},{key:"destroyTPRateLine",value:function(){this.tpRateLine&&(this.tpRateLine.destroy(),this.tpRateLine=null)}},{key:"applySettings",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"applySettings",this).call(this,t),this.slRateLine&&this.slRateLine.applySettings(t),this.tpRateLine&&this.tpRateLine.applySettings(t)}}]),e}(c);s.exports=g}.call(e,i,e,t))&&(t.exports=s)},2293:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(s=function(t,e,s){var h=(i(0),i(2)),c=i(2140),u=i(2025),d=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.editPositionModel=r.options.editPositionModel,r.updateRate(r.options.position.getTakeProfit().fixedPrice),r.updatePl(r.editPositionModel.getProfit()),u.initEditing(r,r.editPositionModel,!0,{onChangeProfitForTakeProfit:function(){r.updatePl(r.editPositionModel.getProfit())},onChangeRate:r.updateDragAndDropRange.bind(r)}),r}return r(e,t),a(e,[{key:"onEditButtonCLick",value:function(){h.trigger("ui:edit-position",this.options.position,!0)}},{key:"onCloseButtonClick",value:function(){u.removePositionTakeProfit(this.editPositionModel)}},{key:"onDrop",value:function(){return u.updatePositionTakeProfit(this.editPositionModel)}},{key:"getDragAndDropRange",value:function(){var t={},e=this.editPositionModel;return e.isBuy()?t.min=e.getValidationValueForProfit():t.max=e.getValidationValueForProfit(),t}},{key:"onRateUpdated",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRateUpdated",this).call(this),this.editPositionModel.setTakeProfit(this.rate)}},{key:"destroy",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),u.stopEditing(this,this.editPositionModel,!0)}}]),e}(c);s.exports=d}.call(e,i,e,t))&&(t.exports=s)},2294:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(s=function(t,e,s){var h=(i(0),i(2)),c=i(7),u=i(2141),d=i(2025),p=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.editPositionModel=r.options.editPositionModel,r.updateRate(r.options.position.getStopLoss().fixedPrice),r.updatePl(-r.editPositionModel.getLoss()),d.initEditing(r,r.editPositionModel,!0,{onChangeLossForStopLoss:function(){r.updatePl(-r.editPositionModel.getLoss())},onChangeRate:r.updateDragAndDropRange.bind(r)}),r}return r(e,t),a(e,[{key:"onEditButtonCLick",value:function(){h.trigger("ui:edit-position",this.options.position,!0)}},{key:"onCloseButtonClick",value:function(){d.removePositionStopLoss(this.editPositionModel)}},{key:"onDrop",value:function(){return d.updatePositionStopLoss(this.editPositionModel)}},{key:"getDragAndDropRange",value:function(){var t={},e=this.editPositionModel;return e.isBuy()?(t.max=e.getValidationValueForLoss(),c.isGuaranteedStopLossEnabled()&&(t.min=e.getGSLLimit())):(t.min=e.getValidationValueForLoss(),c.isGuaranteedStopLossEnabled()&&(t.max=e.getGSLLimit())),t}},{key:"onRateUpdated",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRateUpdated",this).call(this),this.editPositionModel.setStopLoss(this.rate)}},{key:"destroy",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),d.stopEditing(this,this.editPositionModel,!0)}}]),e}(u);s.exports=p}.call(e,i,e,t))&&(t.exports=s)},2295:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)},l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();void 0!==(s=function(t,e,s){var h=(i(0),i(2)),c=i(2034),u=i(2296),d=i(2297),p=i(2025),f={color:"#7a43b0",dashstyle:c.DASH_STYLES.SOLID,draggable:!0,handleEvents:!0,infoLabelShowRate:!0,showCloseButton:!0,showEditButton:!0,showInfoLabel:!0,showRateLabel:!1,showTpslButton:!0},g=function(t){function e(t,i){n(this,e),i.infoLabelKey="chart.line.order."+i.order.getType().toLowerCase();var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.updateTplsButtonVisibility(),r.onInstrumentStatusChange(),r.editOrderModel=p.createEditOrderModel(r.options.order,r.options.instrument),r.updateRate(r.options.order.getPrice()),p.initEditing(r,r.editOrderModel,!1,{onChangeProfitForTakeProfit:function(){r.updatePl(r.editOrderModel.getProfit())},onChangeRate:r.updateDragAndDropRange.bind(r)}),r.listenTo(r.options.instrument,"change:closable change:editable",r.onInstrumentStatusChange.bind(r)),r.listenTo(r.options.order,"change:stopLimitPrice change:modifiedTime",r.onPriceChange.bind(r)),r.listenTo(r.options.order,"change:takeProfit",r.onTakeProfitChange.bind(r)),r.listenTo(r.options.order,"change:stopLoss",r.onStopLossChange.bind(r)),r.listenTo(r.options.order,"change:quantity",r.onQuantityChange.bind(r)),r.listenTo(r.options.order,"remove",r.destroy.bind(r)),r}return r(e,t),l(e,[{key:"defaults",get:function(){return f}}]),l(e,[{key:"destroy",value:function(){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),this.destroyTPRateLine(),this.destroySLRateLine(),this.editOrderModel&&(p.stopEditing(this,this.editOrderModel,!0),this.editOrderModel.destroy(),this.editOrderModel=null)}},{key:"onEditButtonCLick",value:function(){h.trigger("ui:edit-order",this.options.order)}},{key:"onCloseButtonClick",value:function(){h.trigger("ui:cancel-order",this.options.order)}},{key:"onTpslButtonClick",value:function(){this.tpslEnabled?(this.destroyTPRateLine(),this.destroySLRateLine(),this.$tpslButton.enable()):(this.options.order.isTakeProfit()&&this.createTPRateLine(),this.options.order.isStopLoss()&&this.createSLRateLine(),this.$tpslButton.press()),this.tpslEnabled=!this.tpslEnabled}},{key:"onRateUpdated",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRateUpdated",this).call(this),this.editOrderModel.setCurrentPrice(this.rate),this.tpRateLine&&this.tpRateLine.updateRate(this.tpRateLine.rate+t),this.slRateLine&&this.slRateLine.updateRate(this.slRateLine.rate+t)}},{key:"onDrop",value:function(t){return this.editOrderModel.getTakeProfit()&&!this.tpRateLine&&this.editOrderModel.setTakeProfit(this.editOrderModel.getTakeProfit()+t),this.editOrderModel.getStopLoss()&&!this.slRateLine&&this.editOrderModel.setStopLoss(this.editOrderModel.getStopLoss()+t),p.updateOrder(this.editOrderModel)}},{key:"getDragAndDropRange",value:function(){var t={},e=this.editOrderModel;return"STOP"===this.options.order.getType()?e.isBuy()?t.min=e.getValidationValueForProfit():(t.max=e.getValidationValueForProfit(),t.min=e.getInstrumentModel().getPrecisionAsFloat()):e.isBuy()?(t.max=e.getValidationValueForLoss(),t.min=e.getInstrumentModel().getPrecisionAsFloat()):t.min=e.getValidationValueForLoss(),t}},{key:"exportTo",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"exportTo",this).call(this,t),this.tpRateLine&&this.tpRateLine.exportTo(t),this.slRateLine&&this.slRateLine.exportTo(t)}},{key:"updateTplsButtonVisibility",value:function(){this.options.order.isTakeProfit()||this.options.order.isStopLoss()?this.$tpslButton.show(!0):this.tpRateLine||this.slRateLine||(this.$tpslButton.hide(),this.$tpslButton.enable(),this.tpslEnabled=!1)}},{key:"onPriceChange",value:function(){this.updateRate(this.options.order.getPrice())}},{key:"onInstrumentStatusChange",value:function(){this.options.instrument.status.isEditable()?this.enableDragging():this.disableDragging(),this.options.instrument.status.isEditable()?this.$editButton.enable():this.$editButton.disable(),this.options.instrument.status.isClosable()?this.$closeButton.enable():this.$closeButton.disable()}},{key:"onQuantityChange",value:function(){this.editOrderModel.setAmount(this.options.order.get("quantity"))}},{key:"onTakeProfitChange",value:function(){this.tpslEnabled&&(this.options.order.isTakeProfit()?this.tpRateLine?this.tpRateLine.updateRate(this.options.order.getTakeProfit()):this.createTPRateLine():this.destroyTPRateLine()),this.updateTplsButtonVisibility()}},{key:"onStopLossChange",value:function(){this.tpslEnabled&&(this.options.order.isStopLoss()?this.slRateLine?this.slRateLine.updateRate(this.options.order.getStopLoss()):this.createSLRateLine():this.destroySLRateLine()),this.updateTplsButtonVisibility()}},{key:"createSLRateLine",value:function(){this.slRateLine=new d(this.chart,{editOrderModel:this.editOrderModel,order:this.options.order,instrument:this.options.instrument})}},{key:"createTPRateLine",value:function(){this.tpRateLine=new u(this.chart,{editOrderModel:this.editOrderModel,order:this.options.order,instrument:this.options.instrument})}},{key:"destroySLRateLine",value:function(){this.slRateLine&&(this.slRateLine.destroy(),this.slRateLine=null)}},{key:"destroyTPRateLine",value:function(){this.tpRateLine&&(this.tpRateLine.destroy(),this.tpRateLine=null)}},{key:"applySettings",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"applySettings",this).call(this,t),this.slRateLine&&this.slRateLine.applySettings(t),this.tpRateLine&&this.tpRateLine.applySettings(t)}}]),e}(c);s.exports=g}.call(e,i,e,t))&&(t.exports=s)},2296:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(s=function(t,e,s){var h=(i(0),i(2)),c=i(2140),u=i(2025),d=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.editOrderModel=i.editOrderModel,r.updateRate(r.options.order.getTakeProfit()),r.updatePl(r.editOrderModel.getProfit()),u.initEditing(r,r.editOrderModel,!0,{onChangeProfitForTakeProfit:function(){r.updatePl(r.editOrderModel.getProfit())}}),r.listenTo(r.options.order,"change:modifiedTime",function(){r.options.order.isTakeProfit()&&r.updateRate(r.options.order.getTakeProfit())}),r}return r(e,t),a(e,[{key:"onEditButtonCLick",value:function(){h.trigger("ui:edit-order",this.options.order)}},{key:"onCloseButtonClick",value:function(){u.removeOrderTakeProfit(this.editOrderModel)}},{key:"onDrop",value:function(){return u.updateOrderTakeProfit(this.editOrderModel)}},{key:"getDragAndDropRange",value:function(){var t={},e=this.editOrderModel;return e.isBuy()?t.min=e.getPrice()+e.minOrderDistance(!0):t.max=e.getPrice()-e.minOrderDistance(!0),t}},{key:"onRateUpdated",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRateUpdated",this).call(this),this.editOrderModel.setTakeProfit(this.rate)}},{key:"destroy",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),u.stopEditing(this,this.editOrderModel,!0)}}]),e}(c);s.exports=d}.call(e,i,e,t))&&(t.exports=s)},2297:function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s,a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,i);if(void 0===o){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,i,n)}if("value"in o)return o.value;var s=o.get;if(void 0!==s)return s.call(n)};void 0!==(s=function(t,e,s){var h=(i(0),i(2)),c=i(2141),u=i(7),d=i(2025),p=function(t){function e(t,i){n(this,e);var r=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i));return r.editOrderModel=i.editOrderModel,r.updateRate(r.options.order.getStopLoss()),r.updatePl(-r.editOrderModel.getLoss()),d.initEditing(r,r.editOrderModel,!0,{onChangeLossForStopLoss:function(){r.updatePl(-r.editOrderModel.getLoss())}}),r.listenTo(r.options.order,"change:modifiedTime",function(){r.options.order.isStopLoss()&&r.updateRate(r.options.order.getStopLoss())}),r}return r(e,t),a(e,[{key:"onEditButtonCLick",value:function(){h.trigger("ui:edit-order",this.options.order)}},{key:"onCloseButtonClick",value:function(){d.removeOrderStopLoss(this.editOrderModel)}},{key:"onDrop",value:function(){return d.updateOrderStopLoss(this.editOrderModel)}},{key:"getDragAndDropRange",value:function(){var t={},e=this.editOrderModel;return e.isBuy()?(t.max=e.getPrice()-e.minOrderDistance(!0),u.isGuaranteedStopLossEnabled()&&(t.min=e.calcClosePrice())):(t.min=e.getPrice()+e.minOrderDistance(!0),u.isGuaranteedStopLossEnabled()&&(t.max=e.calcClosePrice())),t}},{key:"onRateUpdated",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"onRateUpdated",this).call(this),this.editOrderModel.setStopLoss(this.rate)}},{key:"destroy",value:function(){l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this),d.stopEditing(this,this.editOrderModel,!0)}}]),e}(c);s.exports=p}.call(e,i,e,t))&&(t.exports=s)},2298:function(t,e,i){var n;void 0!==(n=function(t,e,n){n.exports=function(t){t||(t=i(409));var e=t.addEvent,n=t.removeEvent,o=t.createElement,r=t.css,s=t.defined,a=t.doc,l=t.each,h=t.extend,c=t.isMS,u=t.symbolSizes,d=t.merge;t.SVGRenderer.prototype.buttonIcon=function(t,i,n,o,r,s,a,l,u,p,f,g){var y=this.labelIcon(t,i,n,o,r,s,g,null,null,null,null,"button"),v=0;y.attr(d({padding:8,r:2},l));var m=void 0,b=void 0,w=void 0,x=void 0,_=void 0,k=void 0,L=void 0,P=void 0;return l=d({fill:"#f7f7f7",stroke:"#cccccc","stroke-width":1,style:{color:"#333333",cursor:"pointer",fontWeight:"normal"}},l),m=l.style,delete l.style,_=l.icon,delete l.icon,u=d(l,{fill:"#e6e6e6"},u),b=u.style,delete u.style,k=u.icon,delete u.icon,p=d(l,{fill:"#e6ebf5",style:{color:"#000000",fontWeight:"bold"}},p),w=p.style,delete p.style,L=p.icon,delete p.icon,f=d(l,{fill:"#e0e0e0",style:{color:"#cccccc",cursor:"not-allowed"}},f),x=f.style,delete f.style,P=f.icon,delete f.icon,e(y.element,c?"mouseover":"mouseenter",function(){3!==v&&y.setState(1)}),e(y.element,c?"mouseout":"mouseleave",function(){3!==v&&y.setState(v)}),y.setState=function(t){1!==t&&(y.state=v=t),y.removeClass(/highcharts-button-(normal|hover|pressed|disabled)/).addClass("highcharts-button-"+["normal","hover","pressed","disabled"][t||0]),y.attr([l,u,p,f][t||0]).css([m,b,w,x][t||0]),y.bImage.attr({href:[_,k,L,P][t||0]||o})},y.enable=function(){y.setState(0)},y.press=function(){y.setState(2)},y.disable=function(){y.setState(3)},y.updateNormalState=function(t){l=d(l,t),0===v&&y.attr(t)},y.attr(l).css(h({cursor:"default"},m)),y.on("click",function(t){3!==v&&a.call(y,t)})},t.SVGRenderer.prototype.labelIcon=function(e,i,c,p,f,g,y,v,m,b,w,x){var _=this,k=_.g("button"!==x&&"label"),L=k.text=_.text("",0,0,b).attr({zIndex:1}),P=void 0,S=k.bImage=_.image(p).attr({zIndex:1}),O=void 0,C=0,$=3,E=0,D=void 0,T=void 0,R=void 0,A=void 0,M=void 0,I={},B=void 0,j=void 0,z=/^url\((.*?)\)$/.test(y),V=z,F=void 0,H=void 0,N=void 0,Y=void 0,X=void 0;x&&k.addClass("highcharts-"+x),V=z,F=function(){return(B||0)%2/2},H=function(){var t=L.element.style,e=void 0,i={},n=(void 0===D||void 0===T||M)&&s(L.textStr)&&L.getBBox(),o=S.getBBox();O={width:(D||n.width||0)+(f||o.width||0)+(n.width&&(f||o.width)?$:0),height:Math.max(T||n.height||0,T||g||o.height||0),x:o.x||n.x,y:o.y||n.y},k.width=O.width+2*$+E,k.height=O.height+2*$,j=(.75*_.fontMetrics(t&&t.fontSize,L).b+k.height)/2,V&&(P||(k.bRect=P=_.symbols[y]||z?_.symbol(y):_.rect(),P.addClass(("button"===x?"":"highcharts-label-box")+(x?" highcharts-"+x+"-box":"")),P.add(k),e=F(),i.x=e,i.y=(w?-j:0)+e),i.width=Math.round(k.width),i.height=Math.round(k.height),P.attr(h(i,I)),I={})},Y=function(){var t=S.getBBox(),e=$+E+(t.width?t.width+$:0),i=void 0;i=w?0:j,s(D)&&O&&("center"===M||"right"===M)&&(e+={center:.5,right:1}[M]*(D-O.width)),e===L.x&&i===L.y||(L.attr("x",e),void 0!==i&&L.attr("y",i)),L.x=e,L.y=i},X=function(t,e){P?P.attr(t,e):I[t]=e},N=function(t,e){if(t&&e){var i=O.height-e;H(i/2),Y(),k.attr({visibility:"visible"}),k.attr({y:k.y+i/2})}var n=$+E,o=void 0;o=$,s(D)&&O&&("center"===M||"right"===M)&&(n+={center:.5,right:1}[M]*(D-O.width)),n===S.x&&n===S.y||(S.attr("x",n),void 0!==o&&S.attr("y",o)),S.x=n,S.y=o},k.onAdd=function(){L.add(k),S.add(k),f&&g&&S.attr({width:f,height:g}),k.attr({text:e||0===e?e:"",x:i,y:c}),P&&s(v)&&k.attr({anchorX:v,anchorY:m}),f&&g||(k.attr({visibility:"hidden"}),u[p]?N(u[p].width,u[p].height):o("img",{src:p,onload:function(){0===this.width&&(r(this,{position:"absolute",top:"-999em"}),a.body.appendChild(this)),u[p]={width:this.width,height:this.height},this.parentNode&&this.parentNode.removeChild(this),N(this.width,this.height)}}))},k.widthSetter=function(e){D=t.isNumber(e)?e:null},k.heightSetter=function(t){T=t},k["text-alignSetter"]=function(t){M=t},k.paddingSetter=function(t){s(t)&&t!==$&&($=k.padding=t,Y())},k.paddingLeftSetter=function(t){s(t)&&t!==E&&(E=t,Y())},k.alignSetter=function(t){(t={left:0,center:.5,right:1}[t])!==C&&(C=t,O&&k.attr({x:R}))},k.textSetter=function(t){void 0!==t&&L.textSetter(t),H(),Y(),N()},k["stroke-widthSetter"]=function(t,e){t&&(V=!0),B=this["stroke-width"]=t,X(e,t)},k.strokeSetter=k.fillSetter=k.rSetter=function(t,e){"fill"===e&&t&&(V=!0),X(e,t)},k.anchorXSetter=function(t,e){v=k.anchorX=t,X(e,Math.round(t)-F()-R)},k.anchorYSetter=function(t,e){m=k.anchorY=t,X(e,t-A)},k.xSetter=function(t){k.x=t,C&&(t-=C*((D||O.width)+2*$)),R=Math.round(t),k.attr("translateX",R)},k.ySetter=function(t){A=k.y=Math.round(t),k.attr("translateY",A)};var U=k.css;return h(k,{css:function(t){if(t){var e={};t=d(t),l(k.textProps,function(i){void 0!==t[i]&&(e[i]=t[i],delete t[i])}),L.css(e)}return U.call(k,t)},getBBox:function(){return{width:O.width+2*$,height:O.height+2*$,x:O.x-$,y:O.y-$}},shadow:function(t){return t&&(H(),P&&P.shadow(t)),k},destroy:function(){n(k.element,"mouseenter"),n(k.element,"mouseleave"),L&&(L=L.destroy()),P&&(P=P.destroy()),S&&(S=S.destroy()),t.SVGElement.prototype.destroy.call(k),k=_=H=Y=X=N=null}})}}}.call(e,i,e,t))&&(t.exports=n)},2299:function(t,e,i){function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var o;void 0!==(o=function(t,e,o){var r=["up","none","down"],s=function(t,e){return t>e?r[2]:t<e?r[0]:r[1]},a=function(t){for(var e={general:t},i={},n=[],o=0,a=r.length;o<a;o++)e[r[o]]=[],i[r[o]]=[];for(var l,h,c,u,d,p,f=1,g=t.xMap.length;f<g;f++)l=t[3*f+1],h=t[3*f+2],c=t[3*f-2],u=t[3*f-1],d=s(h,u),p!==d&&(e[d].push("M",c,u),i[d].push(t.xMap[f-1])),e[d].push("L",l,h),i[d].push(t.xMap[f]),n.push(d),p=d;return e.up.xMap=i.up,e.none.xMap=i.none,e.down.xMap=i.down,{paths:e,directions:n}};o.exports=function(t){t||(t=i(409));var e=t.each;t.seriesType("up-down-line","line",{upColor:"#1ecd93",color:"#3d6bb1",downColor:"#ff433d"},{drawGraph:function(){var t,i=this,o=this.options,s=(t={},n(t,r[0],o.upColor),n(t,r[1],o.color),n(t,r[2],o.downColor),t),l=(this.gappedPath||this.getGraphPath).call(this),h=[["graph","highcharts-graph",o.lineColor||this.color,o.dashStyle,"general"]];e(r,function(t){return h.push(["updown-graph-"+t,"highcharts-graph highcharts-updown-graph-"+t,s[t]||i.color,o.dashStyle,t])});var c=a(l);e(i.points,function(t,e){t.color=s[c.directions[e]]||i.color}),e(h,function(t,e){var n=t[0],r=i[n],s=c.paths[t[4]],a=void 0;r?(r.endX=s.xMap,r.animate({d:s})):s.length&&(i[n]=i.chart.renderer.path(s).addClass(t[1]).attr({zIndex:1}).add(i.group),a={stroke:t[2],"stroke-width":o.lineWidth,fill:i.fillGraph&&i.color||"none"},t[3]?a.dashstyle=t[3]:"square"!==o.linecap&&(a["stroke-linecap"]=a["stroke-linejoin"]="round"),r=i[n].attr(a).shadow(0===e&&o.shadow)),r&&(r.startX=s.xMap,r.isArea=s.isArea)}),this.graph&&this.graph.hide()},setState:function(i){t.Series.prototype.setState.call(this,i);var n=this,o=this.options.states,s=this.options.lineWidth;n.state=i,o[i]&&!1===o[i].enabled||(i&&(s=o[i].lineWidth||s+(o[i].lineWidthPlus||0)),n.graph&&!n.graph.dashstyle&&e(r,function(t){return n["updown-graph-"+t]&&n["updown-graph-"+t].attr({"stroke-width":s})}))}})}}.call(e,i,e,t))&&(t.exports=o)},2300:function(t,e,i){var n;void 0!==(n=function(t,e,n){n.exports=function(t){t||(t=i(409)),t.seriesType("heikin-ashi","candlestick",{})}}.call(e,i,e,t))&&(t.exports=n)},2301:function(t,e,i){var n;void 0!==(n=function(t,e,n){n.exports=function(t){t||(t=i(409)),t.seriesType("comparison","line",{})}}.call(e,i,e,t))&&(t.exports=n)},2302:function(t,e,i){var n;void 0!==(n=function(t,e,n){var o=i(13);n.exports=o.extend({setChange:function(t){this.set("change",t)},setColor:function(t){this.set("color",t)},setName:function(t){this.set("name",t)},setSubscription:function(t){this.set("subscription",t)},getChange:function(){return this.get("change")},formatChange:function(){return this.get("change")+"%"},getColor:function(){return this.get("color")},getName:function(){return this.get("name")},getSymbol:function(){return this.get("symbol")},getSubscription:function(){return this.get("subscription")}})}.call(e,i,e,t))&&(t.exports=n)},2303:function(t,e,i){var n;void 0!==(n=function(t,e,n){var o=i(45),r=i(15),s=r.mobile()?3:4;n.exports=o.extend({full:!1,contains:function(t){return!!this.findWhere({symbol:t})},isFull:function(){return this.full},add:function(t,e){this.isFull()||(o.prototype.add.call(this,t,e),this.length>=s&&(this.trigger("full",!0),this.full=!0))},remove:function(t,e){o.prototype.remove.call(this,t,e),this.isFull()&&(this.trigger("full",!1),this.full=!1)}})}.call(e,i,e,t))&&(t.exports=n)},2304:function(t,e,i){var n;void 0!==(n=function(t,e,n){var o=i(815),r=i(833),s=i(280),a=i(419);n.exports=s.extend({show:function(t){var e=this.$el.parent();e.css("display","flex"),t?e.addClass("first-search"):e.hasClass("first-search")&&e.removeClass("first-search"),e.find("input")[0].focus()},hide:function(){this.$el.parent().css("display","none")},initialize:function(){s.prototype.initialize.apply(this,arguments);var t=this.$el.find(".search-block-input input")[0];t.setAttribute("size",t.getAttribute("placeholder").length)},openResults:function(){var t=this;this.grid=o({className:"instruments-table",collection:this.collection,empty:r,shouldHideColumns:!0,source:"search",customRowsComponent:i(834),customRowComponent:i(835),columns:[{key:"name",type:a,style:{width:"100%"}}],onRowClick:function(e,i){t.options.onRowClick&&t.options.onRowClick(i.get("symbol")),t.closeResults(),t.hide()}},this.$el.find(".results")[0]),this.$el.find(".results").css("display","block")}})}.call(e,i,e,t))&&(t.exports=n)},2305:function(t,e){t.exports='<div class="chart-no-data"><div class="chart-no-data-image"></div><div class="chart-no-data-message"><%-__(\'chart.no_data\')%></div></div>'},2306:function(t,e,i){(function(n){var o;void 0!==(o=function(t,e,o){var r=i(1);o.exports=r.createClass({displayName:"exports",getDefaultProps:function(){return{mainInstrument:null,comparisonInstruments:null}},getInitialState:function(){return{mainInstrument:this.props.mainInstrument,comparisonInstruments:this.props.comparisonInstruments}},componentDidMount:function(){this.state.mainInstrument.on("change:color change:change",this.update,this),this.state.comparisonInstruments.on("update change:color change:change",this.update,this)},componentWillUnmount:function(){this.state.mainInstrument.off("change:color change:change",this.update,this),this.state.comparisonInstruments.off("update change:color change:change",this.update,this)},update:function(){this.setState({mainInstrument:this.state.mainInstrument,comparisonInstruments:this.state.comparisonInstruments})},removeInstrument:function(t){this.state.comparisonInstruments.remove(t),this.update()},setMainInstrument:function(t){this.state.mainInstrument.off("change:color change:change",this.update,this),t.on("change:color change:change",this.update,this),this.setState({mainInstrument:t})},renderInstrument:function(t,e){var i=this;return r.createElement("div",{className:"ic",key:t.getName()},r.createElement("div",{className:"ic-color",style:{backgroundColor:t.getColor()}}),r.createElement("div",{className:"ic-name"},t.getName()),r.createElement("div",{className:"ic-change"},n.isNumber(t.getChange())?t.formatChange():""),!e&&r.createElement("div",{className:"ic-btn-cancel",title:__("chart.instruments_comparison.remove"),onClick:function(){i.removeInstrument(t)}},r.createElement("i",null)))},render:function(){var t=this;return r.createElement("div",null,this.renderInstrument(this.state.mainInstrument,!0),this.state.comparisonInstruments.map(function(e){return t.renderInstrument(e)}))}})}.call(e,i,e,t))&&(t.exports=o)}).call(e,i(0))},2816:function(t,e,i){"use strict";(function(t){var n=i(12),o=i.n(n),r=i(2273),s=i.n(r),a=s.a.extend({initialize:function(t){s.a.prototype.initialize.apply(this,arguments),this.render(),t.symbol&&s.a.prototype.onInstrumentSelected.call(this,t.symbol,void 0,{})},render:function(){this.template=t.template(i(2817)),s.a.prototype.render.call(this)},getLoadingContainer:function(){return this.$el},destroy:function(){this.chartSubscription&&this.chartSubscription.stop(),o.a.prototype.destroy.call(this)}});e.a=a}).call(e,i(0))},2817:function(t,e){t.exports='<div class="chart-panel-content"><div class="chart-container"></div></div>'}});