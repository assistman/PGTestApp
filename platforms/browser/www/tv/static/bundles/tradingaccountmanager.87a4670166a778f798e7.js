webpackJsonp([5],{1361:function(t,e,i){"use strict";function n(t,e,i,n){var s={textPrevPrice:i?r.splitThousands(t.format(i)):"",textPrice:e?r.splitThousands(t.format(e)):""};return!c.isNumber(i)&&n&&(i=e),c.isNumber(e)&&c.isNumber(i)&&(s.elem=l.PriceColorer.domDifference(s.textPrice,s.textPrevPrice,e-i,"tv-data-table__red-text","tv-data-table__green-text")),s}function s(t,i){var n,s,r;for(void 0===i&&(i=f),n=0,s=e.formatters;n<s.length;n++)if(r=s[n],r.name===t)return r;return i}var r,o,a,l,u,c,d,h,p,_,f,b;Object.defineProperty(e,"__esModule",{value:!0}),r=i(183),o=i(56),a=i(126),l=i(453),u=i(97),c=i(15),d=i(119),i(441),h=new a.DateTimeFormatter,p=new d.PercentageFormatter,b={},b[3]="tv-data-table__grey-text",b[6]="tv-data-table__blue-text",b[5]="tv-data-table__red-text",b[2]="tv-data-table__green-text",b[1]="tv-data-table__red-green-text",b[4]=void 0,_=b,f={name:"default",format:function(t){return t.value+""}},e.formatters=[{name:"symbol",format:function(t){var e=t.value,i=t.row;return t.$container.on("click",function(){return o.symbol.setValue(i.symbol)}),e}},{name:"side",format:function(t){var e=t.value,i=t.$container,n=u.sideToText(e);return 1===e?i.addClass("tv-data-table__blue-text"):i.addClass("tv-data-table__light-red-text"),n}},{name:"type",format:function(t){var e=t.value;return u.orderTypeToText(e)}},{name:"formatPrice",format:function(t){var e=t.value,i=t.priceFormatter,s=t.prevValue,r=n(i,e,s);return r.elem||r.textPrice}},{name:"formatPriceForexSup",format:function(t){var e=t.value,i=t.priceFormatter,s=t.prevValue,r=i.hasForexAdditionalPrecision(),o=n(i,e,s,r);return e&&o.elem&&r&&o.elem.last().lastCharSup(),o.elem||o.textPrice}},{name:"status",format:function(t){var e=t.value,i=t.$container,n=u.orderStatusToText(e),s=_[e];return s&&i.addClass(s),n}},{name:"date",format:function(t){var e=t.value;return e?h.format(new Date(e)):""}},{name:"localDate",format:function(t){var e=t.value;return e?h.formatLocal(new Date(e)):""}},{name:"fixed",format:function(t){var e=t.value;return Math.abs(e||0)<.001?"0.00":r.splitThousands((e||0).toFixed(2))}},{name:"pips",format:function(t){var e=t.value;return c.isNumber(e)?Math.abs(e)<.01?"0.0":r.splitThousands(e.toFixed(1)):""}},{name:"integerSeparated",format:function(t){var e=t.value;return c.isNumber(e)?r.splitThousands(e.toFixed(0)):""}},{name:"profit",format:function(t){var e,i,n,s=t.value,o=t.$container;return c.isNumber(s)?(e=s&&Math.round(100*s)/100,i=e>0?"+":"",n=e<0?"tv-data-table__red-text":e>0?"tv-data-table__green-text":"",o.addClass(n),i+r.splitThousands((e||0).toFixed(2))):$.t("n/a")}},{name:"percentage",format:function(t){var e=t.value;return c.isNumber(e)?p.format(e):""}}],e.tableFormatterByName=s},1376:function(t,e,i){"use strict";var n,s,r;Object.defineProperty(e,"__esModule",{value:!0}),n=i(0),s=i(1445),r=function(t){function e(e,i,n){var s=t.call(this,e,i)||this;return s._tableControllers=n,s}return n.__extends(e,t),e.prototype.reset=function(){this._tableControllers.forEach(function(t){return t.reset()}),t.prototype.reset.call(this)},
e.prototype.destroy=function(){this._tableControllers.forEach(function(t){return t.destroy()}),t.prototype.destroy.call(this)},e.prototype.updateVisibleContent=function(){this._tableControllers.forEach(function(t){return t.table().updateVisibleContent()}),t.prototype.updateVisibleContent.call(this)},e.prototype._onActiveChanged=function(t){this._tableControllers.forEach(function(e){return e.setActive(t)})},e}(s.Page),e.TablePage=r},1377:function(t,e,i){"use strict";(function(t){function n(t,e){return t-e>y}function s(t,e){return t<e?1:t>e?-1:0}function r(t){return t||""}var o,a,l,u,c,d,h,p,_,f,b,v,g,m,y,C,w;Object.defineProperty(e,"__esModule",{value:!0}),i(13),o=i(190),a=i(6),l=i(17),u=i(1446),c=a.getLogger("Table"),d=i(20),i(151),i(427),h=i(1447),p=i(148),_=i(8),f=5e3,b=20,v='<div class="tv-dropdown tv-dropdown-behavior tv-data-table__dropdown-button-wrap js-init-switcher"><div class="tv-dropdown-behavior__button apply-common-tooltip js-dropdown-toggle" title="'+$.t("Column setup")+'">'+h+"</div></div>",g='<div class="tv-dropdown__body tv-dropdown-behavior__body tv-data-table__dropdown-wrap i-hidden"></div>',m='<div class="tv-dropdown-behavior__scroll"><div class="tv-dropdown-behavior__inscroll">{{#columns}}{{^isAlwaysVisible}}<div class="tv-dropdown-behavior__item js-column-item"><label data-field="{{property}}" class="tv-control-select__option-wrap js-fields-item"><label class="tv-control-checkbox"><input type="checkbox" name="{{property}}" class="js-field-checkbox tv-control-checkbox__input i-inited" {{#isVisible}}checked{{/isVisible}}><span class="tv-control-checkbox__box ">'+p+'</span><span class="tv-control-checkbox__ripple js-ripple"></span></label><span class="tv-control-checkbox__label tv-data-table__dropdown-label--breakable js-checkbox-label">{{label}}</span></label></div>{{/isAlwaysVisible}}{{/columns}}</div></div>',y=7,C=38,w=function(){function e(t,e,i,n){var s,a,u=this;this._data=[],this._dataIndicesCache={},this._delayedUpdateInterval=null,this._updateVisibleRowsTimeout=null,this._option=i||{},this._priceFormatterFn=n,this._columns=e,this._visibleColumns=this._createVisibleStore(this._option.id),this._idx=d.getInt(this._option.id+".sort._idx",this._option.idx||0),this._asc=d.getBool(this._option.id+".sort._asc",this._option.asc||!1),this._formatters={},this._group=this._option.group,this._defaultPriceFormatter=new l.PriceFormatter,this._cleanHead(),this._toggleVisibleSwitcher=$('<div><div class="tv-data-table__dropdown-button js-dropdown-button"></div></div>'),this._idProperty=r(this._option.idProperty||e[0].property),s=this._renderTable(o.tvDataTable,r(this._option.className)),$(s).appendTo(t),this._head=this._option.className?$(t).find("."+this._option.className+" thead"):$(t).find("thead"),this._body=this._option.className?$(t).find("."+this._option.className+" tbody"):$(t).find("tbody"),this._initSwitcher(),a=this._head.find("tr").children(),this._columns.forEach(function(t,e){var i,n,s,r=a[e];for(u._isCellHidden(e)&&$(r).addClass("i-hidden"),i=r.querySelectorAll(".tv-data-table__sortable"),
n=function(t){var n=i[t];n.addEventListener("click",function(t){t.preventDefault(),u._head.find(".tv-data-table__sortable--asc, .tv-data-table__sortable--desc").removeClass("tv-data-table__sortable--asc tv-data-table__sortable--desc"),u._idx===e?u._asc=!u._asc:(u._idx=e,u._asc=!1),n.classList.add(u._asc?"tv-data-table__sortable--asc":"tv-data-table__sortable--desc"),d.setValue(u._option.id+".sort._idx",u._idx),d.setValue(u._option.id+".sort._asc",u._asc),u._sortViewImpl()})},s=0;s<i.length;s++)n(s)}),this._head.find("th:eq("+this._idx+") .tv-data-table__sortable").addClass(this._asc?"tv-data-table__sortable--asc":"tv-data-table__sortable--desc"),this._sortTimeout=null,this._visibleRange=null,this._delayedData={},this._active=!1}return e.prototype.setActive=function(t){this._active!==t&&(this._active=t,this._updateVisibleRows())},e.prototype.destroy=function(){this._sortTimeout&&clearTimeout(this._sortTimeout),this._delayedUpdateInterval&&clearInterval(this._delayedUpdateInterval),this._updateVisibleRowsTimeout&&clearTimeout(this._updateVisibleRowsTimeout)},e.prototype.addRow=function(e,i){var n,s,r,a,l,u,c,d,h=this;if(void 0===i&&(i=!0),n=e[this._idProperty],-1!==(s=this._findIndexById(n)))return void this._scheduleUpdateRow(s,e);if(a=0,i)for(l=this._data.length-1;l>=0;l--)-1===this._compare(e,this._data[l])&&(r=this._data[l],a=l);u=t.render(o.tvDataTableRow,{rowClassName:e.type?"tv-data-table__stroke--hl tv-data-table__stroke--hl-"+e.type:""}),c=Object.assign({$row:$(u)},e),void 0===c.priceFormatter&&this._resolveFormatter(c),d=c.priceFormatter||this._defaultPriceFormatter,this._columns.forEach(function(e,i){var n,s,r,a=$(t.render(o.tvDataTableCell,{contain:""}));a[0].className+=" "+e.className,n=e.formatter&&h._formatters[e.formatter]?h._formatters[e.formatter]:h._extractValue,s=e.property?c[e.property]:c,r=n({value:s,priceFormatter:d,row:c,$container:a}),e.fixedWidth&&(r=$('<span class="js-fixedwidth inlined">').append(r)),"object"==typeof r?h._append(a,r):a.append(r),h._isCellHidden(i)&&a.addClass("i-hidden"),h._append(c.$row,a)}),r?(this._data.splice(a,0,c),c.$row.insertBefore(r.$row)):(this._data.push(c),c.$row.appendTo(this._body)),this._clearDataIndicesCache(),this.updateVisibleContent()},e.prototype.updateRowById=function(t,e){var i,n=this._findIndexById(t);if(-1===n)return void c.logWarn("Id "+t+" not found");i=this._delayedData[t]||this._data[n],this._scheduleUpdateRow(n,Object.assign({},i,e))},e.prototype.addRows=function(t){var e=this;t.forEach(function(t){return e.addRow(t,!1)}),this._sortViewImpl()},e.prototype.deleteRow=function(t){var e=this._findIndexById(t),i=this._data[e];-1!==e&&(i.$row.remove(),this._data.splice(e,1),this.updateVisibleContent()),delete this._delayedData[t],this._clearDataIndicesCache()},e.prototype.updateVisibleContent=function(){var t,e=this;this._updateVisibleRowsTimeout&&clearTimeout(this._updateVisibleRowsTimeout),t=100,this._updateVisibleRowsTimeout=setTimeout(function(){return e._updateVisibleRows()},t)},e.prototype.deleteRows=function(){
this._removeAllChildren(this._body[0]),this._data=[],this._clearDataIndicesCache(),this._delayedData={},this._updateVisibleRows()},e.prototype.highlightRowById=function(t){var e=this._rowElementById(t);e&&e.highlight(2)},e.prototype.setRowActiveById=function(t,e){var i=this.rowById(t);i&&this._setRowActive(i,e)},e.prototype.setRowActiveByFilter=function(t){var e=this;this._data.forEach(function(i){return e._setRowActive(i,t(i))})},e.prototype.addFormatter=function(t,e){this._formatters[t]=e},e.prototype.addFormatters=function(t){var e=this;t.forEach(function(t){return e.addFormatter(t.name,t.format)})},e.prototype.isRowInViewport=function(t){if(!this._active)return!1;if(this._updateVisibleRowsTimeout&&this._updateVisibleRows(),!this._visibleRange)return!0;var e=this._findIndexById(t);return e>=this._visibleRange.from&&e<=this._visibleRange.to},e.prototype.setColumnAvailable=function(t,e){try{this._visibleColumns[this._getColumnIdx(t)].forceInvisible=!e,this._applyColumnVisibility(t)}catch(e){c.logWarn("Column "+t+" not found")}},e.prototype.setRowLinkedByFilter=function(t){var e=this;this._data.forEach(function(i){return e._setRowLinked(i,t(i))})},e.prototype.setRowLinkedById=function(t,e){var i=this.rowById(t);i&&this._setRowLinked(i,e)},e.prototype.rowById=function(t){var e=this._findIndexById(t);if(-1!==e)return this._data[e]},e.prototype.rowIdAtEvent=function(t){var e=$(t.srcElement||t.target).parents().andSelf(),i=this._data.find(function(t){return e.is(t.$row)});if(i)return i[this._idProperty]},e.prototype.rowsCount=function(){return this._data.length},e.prototype._setRowLinked=function(t,e){t&&t.isRowLinked!==e&&(t.isRowLinked=e,t.$row[0].classList.toggle("tv-data-table__stroke--hl",e),t.$row[0].classList.toggle("tv-data-table__stroke--hl-active",e))},e.prototype._setRowActive=function(t,e){t&&t.isRowActive!==e&&(t.isRowActive=e,this._applyRowActivityToElement(t.$row,!!t.isRowActive))},e.prototype._append=function(t,e){t[0].appendChild(e[0])},e.prototype._resolveFormatter=function(t){var e=this;this._priceFormatterFn&&this._priceFormatterFn(t).then(function(i){var n=e._findIndexById(t[e._idProperty]);-1!==n&&(e._data[n].priceFormatter=i,e._updateRow(Object.assign({},e._data[n]),n,!0))})},e.prototype._updateVisibleRows=function(){this._updateVisibleRowsTimeout&&(clearTimeout(this._updateVisibleRowsTimeout),delete this._updateVisibleRowsTimeout);var t=this._visibleRange;0!==this._data.length&&this._active?this._visibleRange=u.findVisibleRange(this._visibleRange,this._data):this._visibleRange=null,(!!t!=!!this._visibleRange||this._visibleRange&&(this._visibleRange.from!==_.ensure(t).from||this._visibleRange.to!==_.ensure(t).to))&&(c.logDebug(this._option.id+" visible rows changed. Previous: from "+(t&&t.from)+", to "+(t&&t.to)+". New: from "+(this._visibleRange&&this._visibleRange.from)+", to "+(this._visibleRange&&this._visibleRange.to)+"."),this._forceUpdateDelayedData(this._visibleRange))},e.prototype._removeAllChildren=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},
e.prototype._scheduleUpdateRow=function(t,e){var i=this;if(this._visibleRange&&t>=this._visibleRange.from-1&&t<=this._visibleRange.to+1)return void this._updateRow(e,t);this._delayedData[e[this._idProperty]]=e,this._delayedUpdateInterval||(this._delayedUpdateInterval=setInterval(function(){return i._forceUpdateDelayedData(null,b)},f))},e.prototype._forceUpdateDelayedData=function(t,e){var i,n,s,r,o,a=0,l=Object.keys(this._delayedData);for(i=0,n=l;i<n.length&&(s=n[i],r=this._delayedData[s],o=this._findIndexById(r[this._idProperty]),-1!==o?(!t||o>=t.from-1&&o<=t.to+1)&&(this._updateRow(r,o),delete this._delayedData[s],a++):c.logWarn("Row has been removed"),!e||a!==e);i++);!this._delayedUpdateInterval||e&&0!==Object.keys(this._delayedData).length||(clearInterval(this._delayedUpdateInterval),delete this._delayedUpdateInterval)},e.prototype._updateRow=function(e,i,n){var s,a,l,u,c=this;if(void 0===n&&(n=!1),void 0===i||-1===i)throw Error("row not exist");s=this._data[i],a=!!this._group&&this._group(s)!==this._group(e),l=s.priceFormatter||this._defaultPriceFormatter,u=$.extend({},s),this._columns.forEach(function(i,d){var h,p,_,f,b,v,g=r(i.modificationProperty||i.property);(n||g&&u[g]!==e[g])&&(d===c._idx&&(a=!0),h=s[g],s[g]=e[g],p=s.$row.find("td:eq("+d+")"),_=c._elementFormatterForColumn(i),f=i.property?s[i.property]:s,b=$(t.render(o.tvDataTableCell,{contain:""})),b[0].className+=" "+i.className,v=_({value:f,priceFormatter:l,row:e,prevValue:i.highlightDiff?h:null,$container:b}),i.fixedWidth&&(v=$("<span>").addClass("js-fixedwidth tv-data-table__cell--inlined").css("min-width",p.find(".js-fixedwidth").width()).append(v)),c._isCellHidden(d)&&b.addClass("i-hidden"),"object"==typeof v&&1===v.length?c._append(b,v):b.append(v),b.insertBefore(p),p.remove())}),a&&this._sortView(),delete e.$row,Object.assign(s,e)},e.prototype._elementFormatterForColumn=function(t){return t.formatter&&this._formatters[t.formatter]?this._formatters[t.formatter]:this._extractValue},e.prototype._rowElementById=function(t){var e=this.rowById(t);return e&&e.$row},e.prototype._compare=function(t,e){var i,n,o,a=r(this._columns[this._idx].sortProp||this._columns[this._idx].property),l=r(t[a]),u=r(e[a]),c=0;return this._hasGroups()&&(i=this._group(t),n=this._group(e),c=s(i,n)),c||(c=t.isTotalRow?1:e.isTotalRow?-1:0),c||(c=s(l,u),this._asc&&(c=-c)),c||(o=r(this._columns[0].sortProp||this._columns[0].property),l=r(t[o]),u=r(e[o]),c=s(l,u)),c},e.prototype._hasGroups=function(){return"function"==typeof this._group},e.prototype._sortViewImpl=function(){var t,e,i;for(this._data.sort(this._compare.bind(this)),t=null,e=this._data.length-1;e>=0;e--)i=this._data[e].$row[0],t&&t.parentNode&&t.parentNode.insertBefore(i,t),t=i;this._clearDataIndicesCache()},e.prototype._sortView=function(){var t=this;this._sortTimeout||(this._sortTimeout=setTimeout(function(){t._sortViewImpl(),t._sortTimeout=null},1e3))},e.prototype._applyRowActivityToElement=function(t,e){t.toggleClass("tv-data-table__stroke--grayed",e)},e.prototype._cleanHead=function(){
var t=this._columns.length-1,e=this._columns[t];-1!==e.label.toLowerCase().indexOf("dropdown")&&(e.label="")},e.prototype._renderTable=function(e,i){var n=this._columns.length-1,s=this._columns[n];return""===s.label?(s.label=this._toggleVisibleSwitcher.html(),this._visibleColumns[n].isAlwaysVisible=!0):(this._columns.push({label:this._toggleVisibleSwitcher.html(),className:"tv-data-table__cell--buttons-cell",notSortable:!0,fixedWidth:!1,property:"dropdown",formatter:""}),this._visibleColumns.push({isVisible:!0,isAlwaysVisible:!0,property:r(s.property),label:""})),t.render(e,{columns:this._columns,className:"tv-data-table--trading-cqg "+i,bodies:[{className:""}]})},e.prototype._initSwitcher=function(){var e,i,s=this,r=$(t.render(m,{columns:this._visibleColumns})),o=$(g),a=$(v),l=null,u=null,c=n(this._visibleColumns.length,this._visibleColumns.filter(function(t){return t.isAlwaysVisible}).length);r.appendTo(o),o.appendTo(a),c&&(e=$('<div class="tv-data-table__dropdown-search-wrap">').prependTo(o),l=$('<input type="text" placeholder='+$.t("Search")+' class="tv-data-table__dropdown-search-input">').appendTo(e),u=$('<div class="tv-control-select__option-wrap tv-data-table__search-no-matches js-hidden">'+$.t("No matches")+"</div>").appendTo(o),this._initSearchInput(o,r,a,l,u,c)),this._initDropdown(r,o,a,l,c),c&&l&&this._handleDropdownClosed(r,o,a,c,l,_.ensure(u)),a.on("change",".js-fields-item",function(t){s._handleChecked($(t.currentTarget),r)}),i=this._head.find(".js-dropdown-button"),a.appendTo(i),this._countAndSetPosition(o,a),this._countAndSetHeight(r,o,a,c)},e.prototype._handleChecked=function(t,e){var i=t.data("field"),n=t.find(".js-field-checkbox"),s=!n[0].checked,r=this._getColumnIdx(i);s?this._hideColumn(r):this._showColumn(r),e.find(":checked").prop("disabled",this._isLastColumnVisible())},e.prototype._handleDropdownClosed=function(t,e,i,n,s,r){var o=this;i.on("afterCloseMenu",function(){if(""!==s.val()){var a=t.find(".js-column-item").size()*C;s.val(""),t.find(".js-column-item").toggleClass("js-hidden",!1),r.toggleClass("js-hidden",!0),t.toggleClass("js-hidden",!1),t.css("height",a+"px"),o._countAndSetHeight(t,e,i,n)}})},e.prototype._initDropdown=function(t,e,i,n,s){var r=this;i.tvDropdown(i,{scroll:!0}).on("beforeOpenMenu",function(){r._countAndSetPosition(e,i),r._countAndSetHeight(t,e,i,s),r._isLastColumnVisible()&&t.find(":checked").prop("disabled",!0)}),n&&i.on("afterOpenMenu",function(){n.first().focus()})},e.prototype._initSearchInput=function(t,e,i,n,s,r){var o=this;n.on("change input",function(){var a,l,u,c,d,h,p=n.val().trim().toLowerCase(),_=e.find(".js-column-item");if(0!==p.length)for(a=_.length,l=0;l<a;l++)u=$(_[l]).find(".js-checkbox-label").text().toLowerCase(),c=-1===u.indexOf(p),$(_[l]).toggleClass("js-hidden",c);else _.removeClass("js-hidden");d=e.find(".js-column-item:not(.js-hidden)").size(),h=!!d,s.toggleClass("js-hidden",h),h&&e.css("height",C*d+"px"),o._countAndSetHeight(e,t,i,r)})},e.prototype._countAndSetHeight=function(t,e,i,n){
var s=$(document.getElementsByClassName("js-table-container")[0]),r=s.height(),o=s.offset(),a=55,l=this._option.id&&(-1!==this._option.id.indexOf("balance")||-1!==this._option.id.indexOf("collaterals")),u=n?a:0,c=10,d=C*t.find(".js-column-item:not(.js-hidden)").size(),h=parseInt(e.css("top"))-(o?o.top:0);l&&0<h?d>r-h?t.css("height",r-h-u-c+"px"):t.css("height",d+"px"):d>r-u-c?t.css("height",r-u-c+"px"):t.css("height",d+"px"),i.tvDropdown("updateScroll")},e.prototype._countAndSetPosition=function(t,e){var i=e.offset(),n=t.width();t.css({left:i.left-n+37+"px",top:i.top-25+"px"})},e.prototype._createVisibleStore=function(t){var e,i,n,s=[],o=this._columns.filter(function(t){return t.hideByDefault}).map(function(t){return t.property}),a=d.getJSON(t+".invisibleColumns",o),l=this._columns.length;for(e=0;e<l;e++)i=this._columns[e],n=-1!==a.indexOf(i.property),s.push({isVisible:!n,isAlwaysVisible:!0===i.notHideable,property:r(i.property),label:i.label});return s},e.prototype._toggleVisibleState=function(t,e){this._visibleColumns[this._getColumnIdx(t)].isVisible=e;var i=function(t,e){return e.isVisible||t.push(e.property),t};d.setJSON(this._option.id+".invisibleColumns",this._visibleColumns.reduce(i,[]))},e.prototype._showColumn=function(t){this._toggleVisibleState(this._visibleColumns[t].property,!0),this._applyColumnVisibility(this._visibleColumns[t].property)},e.prototype._isLastColumnVisible=function(){return 1===this._visibleColumns.filter(function(t){return t.isVisible&&t.label&&t.property&&"dropdown"!==t.property}).length},e.prototype._hideColumn=function(t){this._toggleVisibleState(this._visibleColumns[t].property,!1),this._applyColumnVisibility(this._visibleColumns[t].property)},e.prototype._applyColumnVisibility=function(t){var e=this._getColumnIdx(t),i=this._head.find("th:eq("+e+")"),n=$("td:nth-child("+(e+1)+")",this._body),s=this._visibleColumns[e];!s.isVisible&&!s.isAlwaysVisible||s.forceInvisible?(i.addClass("i-hidden"),n.addClass("i-hidden")):(i.removeClass("i-hidden"),n.removeClass("i-hidden"))},e.prototype._isCellHidden=function(t){var e=this._visibleColumns[t];return!e.isVisible||!!e.forceInvisible},e.prototype._getColumnIdx=function(t){var e,i=this._visibleColumns.length;for(e=0;e<i;e++)if(this._visibleColumns[e].property===t)return e;throw Error("Unknown column")},e.prototype._extractValue=function(t){return t.value},e.prototype._findIndexById=function(t){var e,i,n=this._dataIndicesCache[t];return void 0!==n?n:(e=this._idProperty,i=this._data.findIndex(function(i){return i[e]===t}),this._dataIndicesCache[t]=i,i)},e.prototype._clearDataIndicesCache=function(){this._dataIndicesCache={}},e}(),e.Table=w}).call(e,i(34))},1391:function(t,e,i){"use strict";var n,s,r;Object.defineProperty(e,"__esModule",{value:!0}),n=i(8),s=i(1443),r=function(){function t(t,e,i){this._active=!1,this._created=!1,this._started=!1,this._fullUpdateDelegate=null,this._partialUpdateDelegate=null,this._deleteUpdateDelegate=null,this._fullUpdateCancel=null,this._table=t,this._source=e,this._subscriptions=i}
return t.prototype.start=function(){this._started||(this._subscribeUpdates(),this._started=!0)},t.prototype.stop=function(){this._started&&(this._unsubscribeUpdates(),this.reset(),this._started=!1)},t.prototype.isStarted=function(){return this._started},t.prototype.setActive=function(t){n.assert(!t||this._started,"Should be started first"),this._active!==t&&(this._active=t,this._active&&!this._created&&this._fullUpdate(),this._table.setActive(t))},t.prototype.isActive=function(){return this._active},t.prototype.reset=function(){this._active?this._fullUpdate():(this._deleteRows(),this._created=!1)},t.prototype.destroy=function(){this._unsubscribeUpdates(),this._table.destroy()},t.prototype.table=function(){return this._table},t.prototype._update=function(t){return!!this._created&&(this._table.addRow(t),!0)},t.prototype._deleteRow=function(t){this._created&&this._table.deleteRow(t)},t.prototype._deleteRows=function(){this._table.deleteRows(),this._created=!1},t.prototype._fullUpdate=function(){var t,e=this;return this._deleteRows(),this._active?(this._fullUpdateCancel&&this._fullUpdateCancel(),t=s.makeCancelable(this._source()),this._fullUpdateCancel=t.cancel,t.promise.then(function(t){e._fullUpdateCancel=null,e._table.addRows(t),e._created=!0,e._onCreated()}).catch(function(t){if("object"!=typeof t||!0!==t.isCanceled)throw t})):Promise.resolve()},t.prototype._onCreated=function(){},t.prototype._subscribeUpdates=function(){if(this._fullUpdateDelegate)throw Error("should unsubscribe first");this._fullUpdateDelegate=this._subscriptions.fullUpdateDelegate,this._fullUpdateDelegate.subscribe(this,this._fullUpdate),this._partialUpdateDelegate=this._subscriptions.rowUpdateDelegate,this._partialUpdateDelegate.subscribe(this,this._update),this._subscriptions.rowDeleteDelegate&&(this._deleteUpdateDelegate=this._subscriptions.rowDeleteDelegate,this._deleteUpdateDelegate.subscribe(this,this._deleteRow))},t.prototype._unsubscribeUpdates=function(){this._fullUpdateDelegate&&(this._fullUpdateDelegate.unsubscribe(this,this._fullUpdate),delete this._fullUpdateDelegate),this._partialUpdateDelegate&&(this._partialUpdateDelegate.unsubscribe(this,this._update),delete this._partialUpdateDelegate),this._deleteUpdateDelegate&&(this._deleteUpdateDelegate.unsubscribe(this,this._deleteRow),delete this._deleteUpdateDelegate)},t}(),e.TableController=r},1408:function(t,e,i){"use strict";function n(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.childNodes[0]}function s(t){var e='\n\t\t<span class="tv-data-table__button tv-data-table__edit-button" title="'+window.t("Edit")+'">\n\t\t\t'+a+"\n\t\t</span>",i=n(e);return i.addEventListener("click",function(e){return t()}),i}function r(t,e){var i='\n\t\t<span class="tv-data-table__button tv-data-table__close-button" title="'+(e||window.t("Close",{context:"position"}))+'">\n\t\t\t'+l+"\n\t\t</span>",s=n(i);return s.addEventListener("click",function(e){return t()}),s}function o(t,e,i){var n,o,a=document.createElement("span");return i&&(n=s(i),a.appendChild(n)),t&&(o=r(t,e),
a.appendChild(o)),a}var a,l;Object.defineProperty(e,"__esModule",{value:!0}),a=i(1450),l=i(266),i(11),e.createEditButton=s,e.createCloseButton=r,e.getSettingsButtons=o},1409:function(t,e,i){"use strict";var n,s,r,o;Object.defineProperty(e,"__esModule",{value:!0}),n=i(0),s=i(56),r=i(1391),o=function(t){function e(e,i,n){var r=t.call(this,e,i,n)||this;return r._onLinkingBound=r._onLinking.bind(r),s.proSymbol.subscribe(r._onLinkingBound),r}return n.__extends(e,t),e.prototype.destroy=function(){s.proSymbol.unsubscribe(this._onLinkingBound),t.prototype.destroy.call(this)},e.prototype._update=function(e){if(!t.prototype._update.call(this,e))return!1;var i=s.proSymbol.value();return this.table().setRowLinkedById(e.id,i===e.symbol),!0},e.prototype._onCreated=function(){this.table().setRowLinkedByFilter(function(t){return t.symbol===s.proSymbol.value()})},e.prototype._onLinking=function(t){this.table().setRowLinkedByFilter(function(e){return e.symbol===t})},e}(r.TableController),e.LinkingTableController=o},1441:function(t,e){},1442:function(t,e,i){"use strict";var n,s,r,o,a;Object.defineProperty(e,"__esModule",{value:!0}),n=i(0),s=i(1391),r=i(1444),o=i(1377),a=function(t){function e(e){var i=this,n=$("<div>"),r={id:e.id,idProperty:"id"},a=new o.Table(n,e.columns,r,e.priceFormatterFn),l=new s.TableController(a,e.source,e.subscriptions),u={id:e.id,name:e.title,headerCounter:!1,formatters:e.formatters};return i=t.call(this,n,u,[l])||this,l.start(),i}return n.__extends(e,t),e}(r.CustomTablePage),e.SingleTablePage=a},1443:function(t,e,i){"use strict";function n(t){var e=!1;return{promise:new Promise(function(i,n){t.then(function(t){return e?n({isCanceled:!0}):i(t)}),t.catch(function(t){return n(e?{isCanceled:!0}:t)})}),cancel:function(){e=!0}}}Object.defineProperty(e,"__esModule",{value:!0}),e.makeCancelable=n},1444:function(t,e,i){"use strict";var n,s,r,o;Object.defineProperty(e,"__esModule",{value:!0}),n=i(0),s=i(1376),r=i(1361),o=function(t){function e(e,i,n){var s=t.call(this,e,i,n)||this;return n.forEach(function(t){return t.table().addFormatters(i.formatters.concat(r.formatters))}),s}return n.__extends(e,t),e}(s.TablePage),e.CustomTablePage=o},1445:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){this._active=!1,this._$content=t,this._id=e.id,this._name=e.name;var i=e.headerCounter?'<div class="counter"><div class="counter__text">'+e.name+'</div><div class="counter__count">0</div></div>':"<span>"+e.name+"</span>";this._$header=$(i),this._countElement=this._$header.find(".counter__count")[0]}return t.prototype.setActive=function(t){this._active!==t&&(this._active=t,this._onActiveChanged(t))},t.prototype.isActive=function(){return this._active},t.prototype.reset=function(){},t.prototype.destroy=function(){},t.prototype.updateVisibleContent=function(){},t.prototype.header=function(){return this._$header},t.prototype.content=function(){return this._$content},t.prototype.name=function(){return this._name},t.prototype.id=function(){return this._id||this._name},
t.prototype.contextItems=function(t){return[]},t.prototype.topline=function(){return null},t.prototype._setCount=function(t){this._countElement&&(this._countElement.innerHTML=t+"")},t.prototype._onActiveChanged=function(t){},t}();e.Page=n},1446:function(t,e,i){"use strict";function n(t,e){return!c(t)}function s(t,e){return!c(e)}function r(t,e,i){var n,s,o,a;return i<e?NaN:(n=i-e+1,s=n>>1,o=e+s,c(t[o])?o:(a=r(t,e,o-1),isNaN(a)?r(t,o+1,i):a))}function o(t,e){if(t){if(c(e[t.from]))return t.from;if(c(e[t.to]))return t.to}return r(e,0,e.length-1)}function a(t,e){var i,r,a=o(t,e);return isNaN(a)?null:(i=l.lowerbound(e,1,n,0,a+1),r=l.upperbound(e,1,s,a+1,e.length)-1,isNaN(i)||isNaN(r)?null:{from:Math.max(0,i),to:Math.min(r,e.length-1)})}var l,u,c;Object.defineProperty(e,"__esModule",{value:!0}),i(13),l=i(86),u=i(452),c=function(t){return t&&u.isVisible(t.$row)},e.findVisibleRange=a},1447:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 26" width="3" height="13"><circle cx="3" cy="3" r="3"/><circle cx="3" cy="13" r="3"/><circle cx="3" cy="23" r="3"/></svg>'},1448:function(t,e,i){"use strict";var n,s,r,o,a,l;Object.defineProperty(e,"__esModule",{value:!0}),n=i(0),s=i(1376),r=i(1391),o=i(1377),a=i(1361),l=function(t){function e(e){var i,n=$("<div>"),s=[];return e.tables.forEach(function(t){var e,i=$("<div>"),l=new o.Table(i,t.columns,t.options,t.priceFormatterFn);t.title&&$('<h3 class="tv-data-table__header">').text(t.title).appendTo(n),i.appendTo(n),e=new r.TableController(l,t.source,t.subscriptions),s.push(e),l.addFormatters(t.formatters.concat(a.formatters)),e.start()}),i={id:e.id,name:e.title,headerCounter:!1},t.call(this,n,i,s)||this}return n.__extends(e,t),e}(s.TablePage),e.TitledTablesPage=l},1449:function(t,e,i){"use strict";(function(n){function s(t){return t&&t.__esModule?t:{default:t}}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var l,u,c,d,h,p,_,f,b,v,g,m,y,C,w,T,S,D,F,x,O,U,P;Object.defineProperty(e,"__esModule",{value:!0}),l=function t(e,i,n){var s,r,o;return null===e&&(e=Function.prototype),void 0===(s=Object.getOwnPropertyDescriptor(e,i))?(r=Object.getPrototypeOf(e),null===r?void 0:t(r,i,n)):"value"in s?s.value:void 0!==(o=s.get)?o.call(n):void 0},u=function(){function t(t,e){var i,n;for(i=0;i<e.length;i++)n=e[i],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=i(1361),d=i(1408),h=i(72),p=i(96),_=i(97),f=i(429),b=i(9),v=s(b),g=i(1409),
m=i(1376),y=i(1377),C=i(1451),i(11),w=i(188),T=0,S=-1,D=function(){function t(e,i,n,s){a(this,t),this._source=e,this._totalCount=0,this._activeCount=0,this._orderUpdateDelegate=i,this._fullUpdateDelegate=n,this._possibleStatuses=s,this._statusCount=this._emptyStatuses(),this.countChanged=new v.default,this._recalcCountsDelayed=w(this._recalcCounts.bind(this),100)}return u(t,[{key:"_emptyStatuses",value:function(){var t={};return this._possibleStatuses.forEach(function(e){t[e]=0}),t}},{key:"start",value:function(){this._orderUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._recalcCounts()}},{key:"stop",value:function(){this._statusCount=this._emptyStatuses(),this._orderUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed)}},{key:"_recalcCounts",value:function(){var t=this,e=this._emptyStatuses();this._source().then(function(i){var n=0;i.forEach(function(t){e[t.status]++,t.status!==p.ORDERSTATUS.WORKING&&t.status!==p.ORDERSTATUS.INACTIVE||n++}),t._possibleStatuses.forEach(function(i){e[i]!==t._statusCount[i]&&(t._statusCount[i]=e[i],t.countChanged.fire(i,t._statusCount[i]))}),t._totalCount!==i.length&&(t._totalCount=i.length,t.countChanged.fire(T,t._totalCount)),t._activeCount!==n&&(t._activeCount=n,t.countChanged.fire(S,t._activeCount))})}}]),t}(),F=function(t){function e(t,i,n,s){a(this,e);var o=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n,s));return o._filterStatus=null,o}return o(e,t),u(e,[{key:"setFilterStatus",value:function(t){this._filterStatus=t,this.isStarted()&&(this.stop(),this.start())}},{key:"filterStatus",value:function(){return this._filterStatus}},{key:"_satisfy",value:function(t){return!this._filterStatus||t.status===this._filterStatus}}]),e}(C.AbstractObjectsFilter),x=function(t){function e(t,i,n,s,o){a(this,e);var l=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n,s));return l._functor=o,l}return o(e,t),u(e,[{key:"_satisfy",value:function(t){return this._functor(t)}}]),e}(C.AbstractObjectsFilter),O=function(){function t(e,i,n){a(this,t),this._source=e,this._rowUpdateDelegate=i,this._fullUpdateDelegate=n,this._orders=[],this.newStatusDelegate=new v.default}return u(t,[{key:"start",value:function(){var t=this;this._source().then(function(e){t._orders=e.slice(0),t._rowUpdateDelegate.subscribe(t,t._onRowUpdated),t._fullUpdateDelegate.subscribe(t,t._onFullUpdate)})}},{key:"stop",value:function(){this._fullUpdateDelegate.unsubscribe(this,this._onFullUpdate),this._rowUpdateDelegate.unsubscribe(this,this._onRowUpdated),this._orders=[]}},{key:"_onFullUpdate",value:function(){this.stop(),this.start()}},{key:"_onRowUpdated",value:function(t){var e=this._orders.find(function(e){return e.id===t.id});e&&e.status===t.status||(this.newStatusDelegate.fire(t),e?e.status=t.status:this._orders.push($.extend({},t)))}}]),t}(),U=function(t){function e(t,i,n,s){a(this,e);var o=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,i,n))
;return o._filterStatusGetter=s,o}return o(e,t),u(e,[{key:"fullUpdate",value:function(){return this._fullUpdate()}},{key:"_onCreated",value:function(){var t=this;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_onCreated",this).call(this),this.table().setRowActiveByFilter(function(e){return!t._filterStatusGetter()&&!(0,_.isOrderActive)(e.status)})}},{key:"_update",value:function(t){return!!l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_update",this).call(this,t)&&(this.table().setRowActiveById(t.id,!this._filterStatusGetter()&&!(0,_.isOrderActive)(t.status)),!0)}}]),e}(g.LinkingTableController),P=function(t){function e(t){var i,s,o,l,u,p,b,v,g,m,C,w,T,S,P,j;return a(this,e),i=t.formatters||[],s=new x(t.source,t.subscriptions.rowUpdateDelegate,null,t.subscriptions.fullUpdateDelegate,t.filter),o=new D(s.filterSource.bind(s),s.filterObjectUpdateDelegate,s.filterFullUpdateDelegate,t.possibleOrderStatuses),l=new F(s.filterSource.bind(s),s.filterObjectUpdateDelegate,s.filterObjectDeleteDelegate,s.filterFullUpdateDelegate),u=t.subscriptions.fullUpdateDelegate,t.source=l.filterSource.bind(l),t.subscriptions.rowUpdateDelegate=l.filterObjectUpdateDelegate,t.subscriptions.rowDeleteDelegate=l.filterObjectDeleteDelegate,t.subscriptions.fullUpdateDelegate=l.filterFullUpdateDelegate,p=$("<div>"),b={id:t.tableId,className:"orders",group:function(t){return+(0,_.isOrderActive)(t.status)},idProperty:"id"},v=new y.Table(p,t.columns,b,t.priceFormatterFn),g={id:t.id,name:t.title,headerCounter:t.headerCounter},m=new U(v,t.source,t.subscriptions,function(){return C._ordersFilter.filterStatus()}),C=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,p,g,[m])),C._ordersTable=m,C._globalFullUpdateDelegate=u,C._statusWatcher=new O(s.filterSource.bind(s),s.filterObjectUpdateDelegate,s.filterFullUpdateDelegate),C._orderPreFilter=s,C._ordersFilter=l,C._statusesCount=o,C._activeCount=0,C._highlightChanges=t.highlightChanges,C._possibleOrderStatuses=t.possibleOrderStatuses,C._pendingNewOrdersByStatuses={},w="Orders Page",T=(0,h.tradingService)(),C._closeFn=function(){return T.trackEvent(w,"Cancel Order"),t.cancelFn.apply(t,arguments)},C._editFn=null!==t.modifyFn?function(){return T.trackEvent(w,"Edit Order"),t.modifyFn.apply(t,arguments)}:null,S={name:"orderSettings",format:function(t){var e,i,n=t.value;return(0,_.isOrderActive)(n.status)?(e=C._closeFn?function(){return C._closeFn(n.id)}:null,i=C._editFn?function(){return C._editFn(n)}:null,$((0,d.getSettingsButtons)(e,$.t("Cancel"),i))):$((0,d.getSettingsButtons)())}},v.addFormatters(c.formatters.concat([S]).concat(i)),
P='\n\t\t<div class="tv-tabs tv-tabs--no-border tv-tabs--secondary-active tv-tabs--no-margin tv-tabs--semi-compact">\n\t\t\t{{#filter}}\n\t\t\t\t<div class="tv-tabs__tab {{id}}">\n\t\t\t\t\t<div class="tv-tabs__wrap">\n\t\t\t\t\t\t<div class="counter">\n\t\t\t\t\t\t\t<div class="counter__text">{{name}}</div>\n\t\t\t\t\t\t\t<div class="counter__count counter__count--{{id}}">0</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{{/filter}}\n\t\t</div>',j=C._possibleOrderStatuses.map(C._translateStatus),C._filter=$(n.render(P,{filter:[{id:"status-all",name:$.t("All")}].concat(j)})),C._filterTabs=Reflect.construct(f.Tabs,[C._filter.get(0),null,{noSlider:!0}]),C._subscribeUpdates(),C}return o(e,t),u(e,[{key:"_subscribeUpdates",value:function(){this._ordersTable.start(),this._orderPreFilter.start(),this._ordersFilter.start(),this._statusesCount.start(),this._statusWatcher.start(),this._statusWatcher.newStatusDelegate.subscribe(this,this._onNewStatus),this._filterTabs.tabChanged.subscribe(this,this._onFilterChanged),this._statusesCount.countChanged.subscribe(this,this._onCountChanged),this._globalFullUpdateDelegate.subscribe(this,this._onGlobalFullUpdate)}},{key:"_unsubscribeUpdates",value:function(){this._statusWatcher.newStatusDelegate.unsubscribe(this,this._onNewStatus),this._statusWatcher.stop(),this._ordersFilter.stop(),this._statusesCount.stop(),this._ordersTable.stop(),this._filterTabs.tabChanged.unsubscribe(this,this._onFilterChanged),this._statusesCount.countChanged.unsubscribe(this,this._onCountChanged),this._globalFullUpdateDelegate.unsubscribe(this,this._onGlobalFullUpdate)}},{key:"destroy",value:function(){this._unsubscribeUpdates(),l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"destroy",this).call(this)}},{key:"_onGlobalFullUpdate",value:function(){this._pendingNewOrdersByStatuses={},this._updateFiltersActiveState()}},{key:"_count",value:function(){this._setCount(this._activeCount)}},{key:"_translateStatus",value:function(t){var e=(0,_.orderStatusToText)(t),i=e[0].toUpperCase()+e.slice(1);return{id:(0,_.orderStatusId)(t),name:i}}},{key:"contextItems",value:function(t){var e,i=this,n=[],s=this._ordersTable.table().rowIdAtEvent(t);return s?(e=this._ordersTable.table().rowById(s),null!==this._editFn&&n.push({text:$.t("Edit Order..."),enabled:(0,_.isOrderActive)(e.status),action:function(){return i._editFn(e)}}),n.push({text:$.t("Cancel Order"),enabled:(0,_.isOrderActive)(e.status),action:function(){return i._closeFn(s)}}),n):n}},{key:"_onFilterChanged",value:function(t){var e=this,i=0===t?null:this._possibleOrderStatuses[t-1];this._ordersFilter.setFilterStatus(i),this._ordersTable.table().setColumnAvailable("status",0===t),this._ordersTable.fullUpdate().then(function(){i&&e._pendingNewOrdersByStatuses[i]&&e._pendingNewOrdersByStatuses[i].forEach(function(t){return e._ordersTable.table().highlightRowById(t)}),e._removeActiveState()})}},{key:"_onCountChanged",value:function(t,e){var i,n=this._filter.find(".counter .counter__count")
;return t===T?void $(n[0]).text(e):t===S&&this._activeCount!==e?(this._activeCount=e,void this._count()):void(-1!==(i=this._possibleOrderStatuses.indexOf(t))&&$(n[i+1]).text(e))}},{key:"_onNewStatus",value:function(t){var e=this;t.status!==p.ORDERSTATUS.PLACING&&(this._possibleOrderStatuses.forEach(function(i){if(e._pendingNewOrdersByStatuses[i]){var n=e._pendingNewOrdersByStatuses[i].indexOf(t.id);-1!==n&&e._pendingNewOrdersByStatuses[i].splice(n,1)}}),this._pendingNewOrdersByStatuses[t.status]||(this._pendingNewOrdersByStatuses[t.status]=[]),this._pendingNewOrdersByStatuses[t.status].push(t.id),setTimeout(function(){var i=e._ordersFilter.filterStatus(),n=!1;i&&i!==t.status||e._ordersTable.table().isRowInViewport(t.id)&&(e._ordersTable.table().highlightRowById(t.id),n=!0),n||e._pendingNewOrdersByStatuses[t.status]&&-1!==e._pendingNewOrdersByStatuses[t.status].indexOf(t.id)&&e._updateFiltersActiveState(),e._scheduleRemoveActiveState()},0))}},{key:"_scheduleRemoveActiveState",value:function(){var t=this;this._activeStateRemovalScheduled||(this._activeStateRemovalScheduled=!0,setTimeout(function(){return t._removeActiveState()},1e3))}},{key:"_removeActiveState",value:function(){this._activeStateRemovalScheduled=!1;var t=this._ordersFilter.filterStatus();t?this._pendingNewOrdersByStatuses[t]=[]:this._pendingNewOrdersByStatuses={},this._updateFiltersActiveState()}},{key:"_updateFiltersActiveState",value:function(){var t=this;this._highlightChanges&&this._possibleOrderStatuses.forEach(function(e){var i=t._pendingNewOrdersByStatuses[e]&&t._pendingNewOrdersByStatuses[e].length;t._filter.find("."+(0,_.orderStatusId)(e)+" .counter__count").toggleClass("i-active",!!i)})}},{key:"topline",value:function(){return this._filter}},{key:"filter",get:function(){return this._filter}}]),e}(m.TablePage),e.default=P,t.exports=e.default}).call(e,i(34))},1450:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M0 46l35-35 14 14-35 35H0zM39 7l6-6c5-5 19 9 14 14l-6 6z"/></svg>'},1451:function(t,e,i){"use strict";var n,s;Object.defineProperty(e,"__esModule",{value:!0}),n=i(9),s=function(){function t(t,e,i,s){this.filterFullUpdateDelegate=new n,this.filterObjectUpdateDelegate=new n,this.filterObjectDeleteDelegate=new n,this._filteredObjects=[],this._requestsCount=0,this._started=!1,this._objectsRequest=null,this._source=t,this._objectUpdateDelegate=e,this._objectDeleteDelegate=i,this._fullUpdateDelegate=s}return t.prototype.start=function(){var t,e,i=this;this._requestsCount++,t=this._source,e=this._objectsRequest||Promise.resolve([]),this._objectsRequest=e.then(function(){return t()}).then(function(t){var e=t.filter(function(t){return i._satisfy(t)});return i._requestsCount--,i._requestsCount||(i.stop(),i._filteredObjects=e,i._objectsRequest=null,i._objectUpdateDelegate.subscribe(i,i._onObjectUpdated),i._objectDeleteDelegate&&i._objectDeleteDelegate.subscribe(i,i._onObjectDeleted),i._fullUpdateDelegate.subscribe(i,i._onFullUpdate),i._started=!0),e.slice(0)})},t.prototype.stop=function(){
this._objectUpdateDelegate.unsubscribe(this,this._onObjectUpdated),this._fullUpdateDelegate.unsubscribe(this,this._onFullUpdate),this._objectDeleteDelegate&&this._objectDeleteDelegate.unsubscribe(this,this._onObjectDeleted),this._filteredObjects=[],this._started=!1},t.prototype.isStarted=function(){return this._started},t.prototype.filterSource=function(){return this._objectsRequest?this._objectsRequest:Promise.resolve(this._filteredObjects.slice(0))},t.prototype._satisfy=function(t){throw Error("should be implemented")},t.prototype._onFullUpdate=function(){this.stop(),this.start(),this.filterFullUpdateDelegate.fire()},t.prototype._onObjectDeleted=function(t){var e=this._filteredObjects.find(function(e){return e.id===t});e&&this.filterObjectDeleteDelegate.fire(e.id)},t.prototype._onObjectUpdated=function(t){var e=this._filteredObjects.find(function(e){return e.id===t.id}),i=e?this._filteredObjects.indexOf(e):-1;this._satisfy(t)?(e?this._filteredObjects[i]=t:this._filteredObjects.push(t),this.filterObjectUpdateDelegate.fire(t)):e&&(this.filterObjectDeleteDelegate.fire(e.id),this._filteredObjects.splice(i,1))},t}(),e.AbstractObjectsFilter=s},1452:function(t,e,i){"use strict";(function(t){function n(t,e,i,n,s,r){var o={id:t,className:"positions",idProperty:"id"},a=new c.Table(e,s,o,r);return new m(a,i,n)}var s,r,o,a,l,u,c,d,h,p,_,f,b,v,g,m,y;Object.defineProperty(e,"__esModule",{value:!0}),s=i(0),r=i(1361),o=i(1408),a=i(72),l=i(429),u=i(9),c=i(1377),d=i(8),h=i(1376),p=i(1409),i(11),_=i(20),f=i(188),b="Trading.PositionsTable.Filter",v='\n\t<div>\n\t\t<div class="tv-tabs tv-tabs--no-border tv-tabs--secondary-active tv-tabs--no-margin tv-tabs--semi-compact js-filter-wrapper">\n\t\t\t{{#filter}}\n\t\t\t\t<div class="tv-tabs__tab {{id}}">\n\t\t\t\t\t<div class="tv-tabs__wrap">\n\t\t\t\t\t\t<div class="counter">\n\t\t\t\t\t\t\t<div class="counter__text">{{name}}</div>\n\t\t\t\t\t\t\t<div class="counter__count counter__count--{{id}}">0</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t{{/filter}}\n\t\t</div>\n\t</div>',g=function(){function t(t,e,i){this._totalCount=0,this._recalcCountsDelayed=f(this._recalcCounts.bind(this),100),this._source=t,this._rowUpdateDelegate=e,this._fullUpdateDelegate=i,this.countChanged=new u}return t.prototype.start=function(){this._rowUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.subscribe(this,this._recalcCountsDelayed),this._recalcCounts()},t.prototype.stop=function(){this._rowUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed),this._fullUpdateDelegate.unsubscribe(this,this._recalcCountsDelayed)},t.prototype._recalcCounts=function(){var t=this;this._source().then(function(e){var i=e.filter(function(t){return 0!==t.qty});t._totalCount!==i.length&&(t._totalCount=i.length,t.countChanged.fire(t._totalCount))})},t}(),m=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s.__extends(e,t),e.prototype._update=function(e){return!!t.prototype._update.call(this,e)&&(0===e.qty&&this._deleteRow(e.id),!0)},e
}(p.LinkingTableController),y=function(e){function i(t){var i,s,a,l,u,c,h,p,f=this,v=$("<div>"),m={id:"positions",name:window.t("Positions"),headerCounter:!0},y=$("<div>"),C=n(t.brokerId+".positions",y,t.positions.source,Object.assign({},t.positions.subscriptions,{fullUpdateDelegate:t.fullUpdateDelegate}),t.positions.columns,t.priceFormatterFn);return v.append(y),i=[C],s=null,a=null,t.trades&&(s=$("<div>"),a=n(t.brokerId+".trades",s,t.trades.source,Object.assign({},t.trades.subscriptions,{fullUpdateDelegate:t.fullUpdateDelegate}),t.trades.columns,t.priceFormatterFn),v.append(s),i.push(a)),f=e.call(this,v,m,i)||this,f._$positionsTableContainer=y,f._$tradesTableContainer=s,f._positionsTable=C,f._tradesTable=a,l=t.formatters||[],f._fullUpdateDelegate=t.fullUpdateDelegate,f._posSubscriptions=t.positions.subscriptions,f._checkSupportTrades=t.checkSupportTrades,f._storeFunctions(t),u={name:"posSettings",format:function(t){var e=f._closePositionFn?f._closePositionFn.bind(null,t.row.id):null,i=f._editPositionFn?f._editPositionFn.bind(null,t.row.id):null;return $(o.getSettingsButtons(e,window.t("Close",{context:"position"}),i))}},C.table().addFormatters([u].concat(r.formatters).concat(l)),t.trades?(c={name:"tradeSettings",format:function(t){var e,i;return!1===t.row.canBeClosed?"":(e=f._closeTradeFn?f._closeTradeFn.bind(null,t.row.id):null,i=f._editTradeFn?f._editTradeFn.bind(null,t.row.id):null,$(o.getSettingsButtons(e,window.t("Close",{context:"position"}),i)))}},d.ensure(a).table().addFormatters([c].concat(r.formatters).concat(l)),f._tradesCounter=new g(t.trades.source,t.trades.subscriptions.countUpdateDelegate,f._fullUpdateDelegate)):f._tradesCounter=null,f._positionsCounter=new g(t.positions.source,f._posSubscriptions.countUpdateDelegate,f._fullUpdateDelegate),f._constructFilter(),f._checkShowFilter(),f._subscribeUpdates(),h=_.getInt(b,0),p=f._checkSupportTrades()?h:1,f._filterTabs.setActivePage(p),f._selectPage(p),f}return s.__extends(i,e),i.prototype.contextItems=function(t){var e,i=this._activeTableController().table().rowIdAtEvent(t);return i?(e=[],0===this._filterTabs.index()?(this._closeTradeFn&&e.push({text:window.t("Close Position"),action:this._closeTradeFn.bind(null,i)}),this._editTradeFn&&e.push({text:window.t("Edit Position..."),action:this._editTradeFn.bind(null,i)})):(this._closePositionFn&&e.push({text:window.t("Close Position"),action:this._closePositionFn.bind(null,i)}),this._editPositionFn&&e.push({text:window.t("Edit Position..."),action:this._editPositionFn.bind(null,i)}),this._reversePositionFn&&e.push({text:window.t("Reverse Position"),action:this._reversePositionFn.bind(null,i)})),e):[]},i.prototype.topline=function(){return this._filter},i.prototype.destroy=function(){this._unsubscribeUpdates(),e.prototype.destroy.call(this)},i.prototype._onActiveChanged=function(t){t?this._activeTableController().setActive(!0):(this._positionsTable.setActive(!1),this._tradesTable&&this._tradesTable.setActive(!1))},i.prototype._onPositionsCountChanged=function(t){this._setCount(t),this._setTabCount(1,t)},
i.prototype._onTradesCountChanged=function(t){this._setTabCount(0,t)},i.prototype._setTabCount=function(t,e){this._filter.find(".counter .counter__count")[t].innerHTML=e+""},i.prototype._activeTableController=function(){return this._checkSupportTrades()&&0===this._filterTabs.index()?d.ensure(this._tradesTable):this._positionsTable},i.prototype._subscribeUpdates=function(){this._positionsCounter.start(),this._positionsCounter.countChanged.subscribe(this,this._onPositionsCountChanged),this._tradesCounter&&(this._tradesCounter.start(),this._tradesCounter.countChanged.subscribe(this,this._onTradesCountChanged)),this._filterTabs.tabChanged.subscribe(this,this._selectPage),this._fullUpdateDelegate.subscribe(this,this._checkShowFilter)},i.prototype._unsubscribeUpdates=function(){this._positionsCounter.stop(),this._positionsCounter.countChanged.unsubscribe(this,this._onPositionsCountChanged),this._tradesCounter&&(this._tradesCounter.stop(),this._tradesCounter.countChanged.unsubscribe(this,this._onTradesCountChanged)),this._filterTabs.tabChanged.unsubscribe(this,this._selectPage),this._fullUpdateDelegate.unsubscribe(this,this._checkShowFilter)},i.prototype._constructFilter=function(){this._filter=$(t.render(v,{filter:[{id:"type-individual",name:window.t("Individual Positions")},{id:"type-net",name:window.t("Net Positions")}]})),this._filterTabs=new l.Tabs(this._filter.find(".js-filter-wrapper").get(0),void 0,{noSlider:!0})},i.prototype._checkShowFilter=function(){var t=this._filter.find(".js-filter-wrapper");this._checkSupportTrades()?t.removeClass("js-hidden"):(t.addClass("js-hidden"),this._tradesTable&&this._tradesTable.stop())},i.prototype._selectPage=function(t){var e=1===t;e?this._positionsTable.start():this._tradesTable&&this._tradesTable.start(),this._$positionsTableContainer.toggleClass("js-hidden",!e),this._$tradesTableContainer&&this._$tradesTableContainer.toggleClass("js-hidden",e),this._positionsTable.setActive(e),this._tradesTable&&this._tradesTable.setActive(!e),_.setValue(b,t)},i.prototype._storeFunctions=function(t){var e,i,n,s,r,o=d.ensure(a.tradingService()),l="Positions Page",u=t.positions.closeFn;this._closePositionFn=u?function(t){return o.trackEvent(l,"Close Position"),u(t)}:null,e=t.positions.editFn,this._editPositionFn=e?function(t){return o.trackEvent(l,"Edit Position"),e(t)}:null,i=t.positions.reverseFn,this._reversePositionFn=i?function(t){return o.trackEvent(l,"Reverse Position"),i(t)}:null,(n=t.trades)&&(s=n.closeFn,this._closeTradeFn=s?function(t){return o.trackEvent(l,"Close Trade"),s(t)}:null,r=n.editFn,this._editTradeFn=r?function(t){return o.trackEvent(l,"Edit Trade"),r(t)}:null)},i}(h.TablePage),e.PositionPage=y}).call(e,i(34))},1453:function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){
if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a,l,u,c,d;Object.defineProperty(e,"__esModule",{value:!0}),a=function(){function t(t,e){var i,n;for(i=0;i<e.length;i++)n=e[i],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=function t(e,i,n){var s,r,o;return null===e&&(e=Function.prototype),void 0===(s=Object.getOwnPropertyDescriptor(e,i))?(r=Object.getPrototypeOf(e),null===r?void 0:t(r,i,n)):"value"in s?s.value:void 0!==(o=s.get)?o.call(n):void 0},u=i(9),c=n(u),d=function(t){function e(t){s(this,e);var i=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return i._delegates=t,i._isSubscribed=!1,i}return o(e,t),a(e,[{key:"subscribe",value:function(t,i,n){var s=this;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"subscribe",this).call(this,t,i,n),!this._isSubscribed&&this._listeners.length&&this._delegates.forEach(function(t){return t.subscribe(s,s._onFire)})}},{key:"unsubscribe",value:function(t,i){var n=this;l(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"unsubscribe",this).call(this,t,i),this._isSubscribed&&0===this._listeners.length&&this._delegates.forEach(function(t){return t.unsubscribe(n,n._onFire)})}},{key:"_onFire",value:function(){this.fire.apply(this,arguments)}}]),e}(c.default),e.default=d,t.exports=e.default},1454:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),i(11),e.notificationColumns=[{label:$.t("Time"),property:"time",formatter:"localDate",className:"tv-data-table__cell--text tv-data-table__cell--text-nowrap"},{label:$.t("Title"),property:"title",className:"tv-data-table__cell--text tv-data-table__cell--text-nowrap"},{label:$.t("Text"),property:"text",className:"tv-data-table__cell--text"}]},1455:function(t,e,i){"use strict";function n(t,e){var i,n,s;return void 0===e&&(e=""),i=document.createElement("div"),i.className="tv-account-manager__el "+e,n=document.createElement("div"),n.className="tv-account-manager__text",n.textContent=t,s=document.createElement("div"),s.className="tv-account-manager__data js-collateral-value",i.appendChild(n),i.appendChild(s),i}var s,r;Object.defineProperty(e,"__esModule",{value:!0}),s=i(1361),r=function(){function t(t,e){this._infoUnsubscribe=[],this._infoUnsubscribe=e.reverse().map(function(e,i){var r,o,a,l="js-"+i,u=n(e.text,l),c=u.getElementsByClassName("js-collateral-value")[0];return t.appendChild(u),r=e.formatter||"fixed",o=s.tableFormatterByName(r),a=function(t){var e=o.format({value:t,$container:$(c),row:{}});c.textContent=(""+e).replace(/&nbsp;/g," ")},e.wValue.subscribe(a),void 0!==e.wValue.value()&&a(e.wValue.value()),function(){return e.wValue.unsubscribe(a)}})}return t.prototype.destroy=function(){
this._infoUnsubscribe.forEach(function(t){return t()})},t}(),e.AccountSummaryRow=r},1456:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><path fill-rule="evenodd" d="M14.59 6.857s-.57 0-.723-.533c-.115-.457-.305-.876-.534-1.295-.228-.497.153-.878.153-.878l.57-.57c.23-.23.23-.61 0-.877l-.76-.762c-.23-.23-.61-.23-.877 0l-.572.57s-.38.382-.877.154c-.418-.23-.837-.42-1.294-.534-.533-.152-.533-.723-.533-.723v-.8a.602.602 0 0 0-.61-.61H7.467a.602.602 0 0 0-.61.61v.8s0 .57-.533.723c-.457.115-.876.305-1.295.534-.497.228-.878-.153-.878-.153l-.57-.57c-.23-.23-.61-.23-.877 0l-.762.76c-.23.23-.23.61 0 .877l.57.572s.382.38.154.877c-.23.418-.42.837-.534 1.294-.152.495-.723.533-.723.533h-.8a.602.602 0 0 0-.61.61v1.066c0 .343.267.61.61.61h.8s.57 0 .723.533c.115.457.305.876.534 1.295.228.497-.153.878-.153.878l-.57.57c-.23.23-.23.61 0 .877l.76.762c.23.23.61.23.877 0l.572-.57s.38-.382.877-.154c.418.23.837.42 1.294.534.495.152.533.723.533.723v.8c0 .343.267.61.61.61h1.066c.343 0 .61-.267.61-.61v-.8s0-.57.533-.723c.457-.115.876-.305 1.295-.534.497-.228.878.153.878.153l.57.57c.23.23.61.23.877 0l.762-.76c.23-.23.23-.61 0-.877l-.57-.572s-.382-.38-.154-.877c.23-.418.42-.837.534-1.294.152-.495.723-.533.723-.533h.8c.343 0 .61-.267.61-.61V7.467a.602.602 0 0 0-.61-.61h-.8zM4 8c0-2.222 1.778-4 4-4s4 1.778 4 4-1.812 4-4 4c-2.222 0-4-1.778-4-4z"/></svg>'},451:function(t,e,i){"use strict";function n(t){var e,i;if(t&&t.__esModule)return t;if(e={},null!=t)for(i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function s(t){return t&&t.__esModule?t:{default:t}}function r(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,i){function n(s,r){var o,a;try{o=e[s](r),a=o.value}catch(t){return void i(t)}if(!o.done)return Promise.resolve(a).then(function(t){n("next",t)},function(t){n("throw",t)});t(a)}return n("next")})}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a,l,u,c,d,h,p,_,f,b,v,g,m,y,C,w,T,S,D,F,x,O,U,P,j,R,k,E,A,I;Object.defineProperty(e,"__esModule",{value:!0}),a=i(428),l=s(a),u=function(){function t(t,e){var i,n,s=[],r=!0,o=!1,a=void 0;try{for(i=t[Symbol.iterator]();!(r=(n=i.next()).done)&&(s.push(n.value),!e||s.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&i.return&&i.return()}finally{if(o)throw a}}return s}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function t(t,e){var i,n;for(i=0;i<e.length;i++)n=e[i],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),i(1441),d=i(429),h=i(73),p=s(h),_=i(56),f=s(_),b=i(1),v=n(b),g=i(1442),m=i(1448),y=i(1449),C=s(y),w=i(1452),T=i(1453),S=s(T),D=i(82),F=i(97),x=i(96),O=i(1454),U=i(187),P=i(72),j=i(1455),$.t("Username or password is incorrect"),
R=[x.ORDERSTATUS.WORKING,x.ORDERSTATUS.INACTIVE,x.ORDERSTATUS.FILLED,x.ORDERSTATUS.CANCELED,x.ORDERSTATUS.REJECTED],k=[x.ORDERSTATUS.FILLED,x.ORDERSTATUS.CANCELED,x.ORDERSTATUS.REJECTED],E=function(t){var e=t.accId,n=void 0===e?"":e,s=(t.brokerName,t.tabsCount),r=void 0===s?0:s;return'\n<div class="tv-account-manager">\n\t<div class="tv-account-manager__top-panel">\n\t\t<div class="tv-tabs tv-tabs--semi-compact tv-tabs--no-margin tv-tabs--no-border">\n\t\t\t'+A(r)('<div class="tv-tabs__tab js-tab"></div>')+'\n\t\t</div>\n\t\t<div class="controls">\n\t\t\t<div class="controls__elem controls__elem--disabled account-selector js-account-dropdown">\n\t\t\t\t<span class="js-account-name">'+n+'</span>\n\t\t\t</div>\n\t\t\t<div class="controls__elem option js-tab-options">'+i(1456)+'</div>\n\t\t</div>\n\t</div>\n\t<div class="tv-account-manager__secondary-panel js-cesondary-panel">\n\t\t<div class="js-secondary-tabs"></div>\n\t\t<div class="tv-account-manager__summary js-summary"></div>\n\t</div>\n\t<div class="tv-account-manager__content js-content js-table-container">\n\t\t'+A(r)('<div class="tv-account-manager__page js-page"></div>')+"\n\t</div>\n</div>"},A=function(t){return function(e){return Array(t).fill(e).join("")}},I=function(){function t(e,i){o(this,t),this._adapter=e,this._bridge=i,this._container=i.$body,this._$spinnerWrapper=null,this._prevConnectionStatus=this._adapter.connectionStatus(),this._pages=[],this._topLines={},this._trading=(0,P.tradingService)(),this._updateAccountIdBinded=this._updateAccountId.bind(this),this._adapter.connectionStatusUpdate.subscribe(this,this._onStatusChange),this._onStatusChange(this._adapter.connectionStatus())}return c(t,[{key:"drawAttention",value:function(){this._loginForm&&this._loginForm.drawAttention&&this._loginForm.drawAttention()}},{key:"_onStatusChange",value:function(t,e){var i,n,s,r=this;this._container.empty(),this._unsubscribe(),this._spinner&&(this._spinner.stop(),Reflect.deleteProperty(this,"_spinner")),null!==this._$spinnerWrapper&&(this._$spinnerWrapper.remove(),this._$spinnerWrapper=null),i=this._adapter.metainfo().configFlags.authorizationType,t===x.CONNECTSTATUSES.ERROR||t===x.CONNECTSTATUSES.DISCONNECTED?(e&&$("<div>").addClass("trading-connection-error-message").text($.t(e)).appendTo(this._container),"undefined"!=typeof LoginForm&&void 0!==i&&(this._loginForm=new LoginForm(this._adapter.metainfo(),this._trading),this._container.append(this._loginForm.content()),this._loginForm.focus(),this._loginForm.getAuthInfo().then(function(t){var e=t.username,i=t.password,n=t.type;r._adapter.signIn(e,i,n)})),this.unbindContexMenu()):this._loginForm&&(this._loginForm.remove(),Reflect.deleteProperty(this,"_loginForm")),t===x.CONNECTSTATUSES.CONNECTING&&(this._$spinnerWrapper=$('<div class="tv-account-manager__spinner-wrapper">'),n=$('<div class="tv-account-manager__spinner-container">').appendTo(this._$spinnerWrapper),this._spinner=(0,U.unifiedSpinner)().spin(n.get(0)),
"oauth"===i&&this._prevConnectionStatus!==x.CONNECTSTATUSES.CONNECTED&&(s=$('<a class="tv-account-manager__cancel-login-button">').text($.t("Cancel")),s.click(this._disconnectBroker.bind(this)),this._$spinnerWrapper.append(s)),this._$spinnerWrapper.appendTo(this._container)),t===x.CONNECTSTATUSES.CONNECTED&&(this._create(),this._fullupdate()),this._prevConnectionStatus=t}},{key:"priceFormatter",value:function(t){return t.symbol?this._trading.formatter(t.symbol):Promise.resolve(null)}},{key:"_updateAccountId",value:function(t){this._accName.text(t.name)}},{key:"_create",value:function(){var t,e,i,n,s,r,o,a,l,u,c,h,p,_,f,b=this;this._pages=this.pages.map(function(t){return Reflect.construct(t.constructor,[t.ctorArgument])}),t=this._info=this._adapter.accountManagerInfo(),e=this._info.accountTitle,i=this._pages.length,this._container.append($(E({tabsCount:i,brokerName:e,accId:""}))),n=this._container.find(".js-tab-options"),(0,D.bindPopupMenu)(n,this._adapter.buttonDropdownActions.bind(this._adapter),{reverse:!0}),s=function(t,e){return t&&e&&t.id===e.id},r=this._container.find(".js-account-dropdown"),this._accName=this._container.find(".js-account-name"),this._accountSummaryRow&&this._accountSummaryRow.destroy(),this._info.summary&&(o=this._container.find(".js-summary"),this._accountSummaryRow=new j.AccountSummaryRow(o[0],this._info.summary)),this._info.account?this._info.account.subscribe(this._updateAccountIdBinded,{callWithLast:!0}):r.addClass("js-hidden"),t.accountsList&&(a=function(){return t.accountsList.map(function(e){return void 0===e.currency&&(e.currency="USD"),{html:'<div class="pair"><div>'+e.name+"</div><div>"+e.currency+"</div></div>",action:function(){s(e,t.account.value())||t.account.setValue(e)},active:s(e,t.account.value())}})},r.removeClass("controls__elem--disabled").append($('<span class="tv-caret"></span>')),(0,D.bindPopupMenu)(r,a,{direction:"down",notCloseOnButtons:!0,reverse:!0,activeClass:"i-dropped i-active",addClass:"account-selector"})),this._contentWrapper=this._container.find("div.content-wrapper"),l=this._container.find(".js-page"),u=this._container.find(".js-tab"),this._pages.forEach(function(t,e){l.eq(e).html(t.content()),u.eq(e).html(t.header())}),c=this._container.find(".js-content"),h=this.tabs=Reflect.construct(d.Tabs,[this._container.find(".tv-tabs").get(0),c.get(0)]),h.tabChanged.subscribe(this,this._onPageChanged),this.unbindContexMenu(),this._dispatch=this.bindContextMenu(),this._dispatchHeightHandler&&(this._dispatchHeightHandler(),delete this._dispatchHeightHandler),p=function(){b._pages.forEach(function(t){return t.updateVisibleContent()})},c.on("scroll",p),_=function(t){c.css("height",t-78+"px"),p()},this._bridge.height.subscribe(_,{callWithLast:!0}),this._dispatchHeightHandler=function(){return b._bridge.height.unsubscribe(_)},f=function(t){t?b._updatePagesActiveStatuses():b._pages.forEach(function(t){return t.setActive(!1)})},this._bridge.visible.subscribe(f,{callWithLast:!0}),this._dispatchVisibilityHandler=function(){return b._bridge.visible.unsubscribe(f)},
this._attachFilter()}},{key:"_onPageChanged",value:function(t){this._attachFilter(),this._trading.trackEvent("Bottom Panel","Select "+this._pages[t].id()+" page"),this._updatePagesActiveStatuses()}},{key:"_updatePagesActiveStatuses",value:function(){var t,e=this._adapter.connectionStatus()===x.CONNECTSTATUSES.CONNECTED,i=this.tabs.index();for(t=0;t<this._pages.length;t++)this._pages[t].setActive(i===t&&e)}},{key:"_detachFilter",value:function(){this._container.find(".js-secondary-tabs").children().addClass("js-hidden")}},{key:"_attachFilter",value:function(){var t,e;this._detachFilter(),this._topLines[this._currentPageIndex()]?this._topLines[this._currentPageIndex()].removeClass("js-hidden"):this._currentPage().topline()&&(t=this._currentPage().topline(),e=this._container.find(".js-secondary-tabs"),t.appendTo(e),this._topLines[this._currentPageIndex()]=t)}},{key:"_fullupdate",value:function(){this._pages.forEach(function(t){return t.reset()})}},{key:"_unsubscribe",value:function(){this._info&&this._info.account&&this._info.account.unsubscribe(this._updateAccountIdBinded),this.tabs&&(this.tabs.tabChanged.unsubscribe(this,this._onPageChanged),this.tabs.stop()),this._dispatchHeightHandler&&(this._dispatchHeightHandler(),delete this._dispatchHeightHandler),this._dispatchVisibilityHandler&&(this._dispatchVisibilityHandler(),delete this._dispatchVisibilityHandler),this._container.find(".js-secondary-tabs").empty(),this._topLines={}}},{key:"remove",value:function(){this._adapter.connectionStatusUpdate.unsubscribe(this,this._onStatusChange),this._unsubscribe(),this._pages.forEach(function(t){return t.destroy()}),this.unbindContexMenu(),this._container.empty()}},{key:"bindContextMenu",value:function(){var t=this,e=function(e){e.preventDefault(),t._contextItems(e).then(function(t){v.enabled("property_pages")||(t=t.slice(0,-1)),p.default.createMenu((0,F.convertActionDescriptionsToActions)(t)).show(e)})};return this._container.on("contextmenu",e),this._container.off.bind(this._container,"contextmenu",e)}},{key:"unbindContexMenu",value:function(){this._dispatch&&(this._dispatch(),Reflect.deleteProperty(this,"_dispatch"))}},{key:"_getCurrentPrice",value:function(t){return this._trading.realtimeProvider().quotesSnapshot(t).then(function(t,e){return(e+t)/2})}},{key:"_currentPageIndex",value:function(){return this.tabs.index()}},{key:"_currentPage",value:function(){return this._pages[this._currentPageIndex()]}},{key:"_contextItems",value:function(){function t(t){return e.apply(this,arguments)}var e=r(l.default.mark(function t(e){var i,n,s,r,o,a,c,d,h,p=this;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i="Bottom Panel Context Menu",n=f.default.proSymbol.value(),t.next=4,Promise.all([this._getCurrentPrice(n),this._trading.suggestedQty().value(n)]);case 4:if(s=t.sent,r=u(s,2),o=r[0],a=r[1],c=this._currentPage().contextItems(e),!this._info||!this._info.contextMenuActions){t.next=13;break}return t.next=12,this._info.contextMenuActions(e,c);case 12:return t.abrupt("return",t.sent);case 13:return d={
separator:!0},c.length&&c.push(d),h=[{text:$.t("Create New Order..."),action:function(){p._trading.trackEvent(i,"New Order"),p._adapter.placeOrder({symbol:n,price:o,qty:a})}},d,{text:$.t("Show Buy/Sell Panel"),checkable:!0,checked:this._adapter.host().floatingTradingPanelVisibility().value(),action:function(){var t=p._adapter.host().floatingTradingPanelVisibility().value();p._trading.trackEvent(i,"Show Panel",t?"Uncheck":"Check"),p._adapter.host().floatingTradingPanelVisibility().setValue(!t)}}],v.enabled("property_pages")&&h.push(d,{text:$.t("Trading properties..."),action:function(){p._trading.trackEvent(i,"Trading Properties"),p._adapter.host().showTradingProperties()}}),this._trading.availableBrokers().length>1&&h.push(d,{text:$.t("Disconnect"),action:function(){p._trading.trackEvent(i,"Disconnect"),p._disconnectBroker()}}),t.abrupt("return",c.concat(h));case 19:case"end":return t.stop()}},t,this)}));return t}()},{key:"_disconnectBroker",value:function(){var t=this._trading.activeBroker();t&&(void 0!==t.metainfo().configFlags.authorizationType?t.disconnect():this._trading.selectBroker(null))}},{key:"pages",get:function(){var t=this,e=this._adapter.metainfo().id,i=this._adapter.accountManagerInfo(),n=this._adapter.metainfo().configFlags,s=[];return s.push({constructor:w.PositionPage,ctorArgument:{brokerId:e,formatters:i.customFormatters||[],priceFormatterFn:this.priceFormatter.bind(this),checkSupportTrades:function(){return n.supportTrades},positions:{source:function(){return t._adapter.positions().then(function(t){return t.filter(function(t){return 0!==t.qty})})},closeFn:this._adapter.closePosition.bind(this._adapter),editFn:n.supportPositionBrackets?this._adapter.editPositionBrackets.bind(this._adapter):null,reverseFn:n.supportReversePosition?this._adapter.reversePosition.bind(this._adapter):null,columns:i.positionColumns,subscriptions:{rowUpdateDelegate:new S.default([this._adapter.positionPartialUpdate,this._adapter.positionUpdate]),countUpdateDelegate:this._adapter.positionUpdate,plSubscription:this._adapter.subscribePL.bind(this._adapter)}},trades:n.supportTrades?{source:function(){return t._adapter.trades().then(function(t){return t.filter(function(t){return 0!==t.qty})})},closeFn:n.supportCloseTrade?this._adapter.closeTrade.bind(this._adapter):null,editFn:n.supportTradeBrackets?this._adapter.editTradeBrackets.bind(this._adapter):null,reverseFn:null,columns:i.tradeColumns||i.positionColumns,subscriptions:{rowUpdateDelegate:new S.default([this._adapter.tradePartialUpdate,this._adapter.tradeUpdate]),countUpdateDelegate:this._adapter.tradeUpdate,plSubscription:this._adapter.subscribePL.bind(this._adapter)}}:null,fullUpdateDelegate:this._adapter.fullUpdate}}),s.push({constructor:C.default,ctorArgument:{id:"Orders",title:$.t("Orders"),source:this._adapter.orders.bind(this._adapter),cancelFn:this._adapter.cancelOrder.bind(this._adapter),modifyFn:this._adapter.metainfo().configFlags.supportModifyOrder?this._adapter.modifyOrder.bind(this._adapter):null,columns:i.orderColumns,headerCounter:!0,tableId:e+".orders",
formatters:i.customFormatters||[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._adapter.fullUpdate,rowUpdateDelegate:new S.default([this._adapter.orderPartialUpdate,this._adapter.orderUpdate]),orderUpdateDelegate:this._adapter.orderUpdate},possibleOrderStatuses:R.filter(function(t){return!i.possibleOrderStatuses||-1!==i.possibleOrderStatuses.indexOf(t)}),filter:i.historyColumns&&i.historyColumns.length?function(t){return!!t.updateTime}:function(){return!0},highlightChanges:!0}}),i.historyColumns&&i.historyColumns.length&&s.push({constructor:C.default,ctorArgument:{id:"History",title:$.t("History"),source:this._adapter.orders.bind(this._adapter),cancelFn:this._adapter.cancelOrder.bind(this._adapter),modifyFn:this._adapter.modifyOrder.bind(this._adapter),columns:i.historyColumns,headerCounter:!1,tableId:e+".history",formatters:i.customFormatters||[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._adapter.fullUpdate,rowUpdateDelegate:new S.default([this._adapter.orderPartialUpdate,this._adapter.orderUpdate]),orderUpdateDelegate:this._adapter.orderUpdate},possibleOrderStatuses:k.filter(function(t){return!i.possibleOrderStatuses||-1!==i.possibleOrderStatuses.indexOf(t)}),filter:function(){return!0},highlightChanges:!1}}),i.pages&&i.pages.forEach(function(n){var r=n.tables.map(function(s){var r,o={title:s.name||"",columns:s.columns,source:(0,F.wrapDeferredWithPromise)(s.getData),options:{id:e+"."+n.id+"."+s.id,className:"balances",idProperty:"id"},formatters:i.customFormatters||[],priceFormatterFn:t.priceFormatter.bind(t),subscriptions:{fullUpdateDelegate:t._adapter.fullUpdate,rowUpdateDelegate:s.changeDelegate}},a=s.initialSorting;return void 0!==a&&(r=s.columns.findIndex(function(t){return t.id===a.columnId}),-1===r&&(r=s.columns.findIndex(function(t){return t.property===a.columnId})),-1!==r&&(o.options.idx=r,o.options.asc=a.asc)),o});s.push({constructor:m.TitledTablesPage,ctorArgument:{id:n.id,title:n.title,tables:r}})}),v.enabled("show_trading_notifications_history")&&s.push({constructor:g.SingleTablePage,ctorArgument:{id:"notifications_log",title:$.t("Notifications log"),source:function(){return Promise.resolve(t._trading.getNotifications())},columns:O.notificationColumns,formatters:[],priceFormatterFn:this.priceFormatter.bind(this),subscriptions:{fullUpdateDelegate:this._trading.onNotificationsChanged,rowUpdateDelegate:this._trading.onNewNotification}}}),s}}]),t}(),e.default=I,t.exports=e.default}});