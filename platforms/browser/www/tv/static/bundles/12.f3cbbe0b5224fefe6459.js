webpackJsonp([12],{1404:function(t,e,r){"use strict";function s(t){var e={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded",Referer:"https://www.tradingview.com/chart/OlHDdzUm/"};return void 0!==t&&(e.Authorization="Bearer "+t),e}function i(t){return void 0===t&&(t=m.Get),m[t].toLowerCase()}function o(t){return!(!t||t.hasOwnProperty("s")&&"error"===t.s)}function n(t,e,r,i,o){return void 0===r&&(r=m.Get),_.__awaiter(this,void 0,void 0,function(){var n,a,u,c;return _.__generator(this,function(l){switch(l.label){case 0:n=i?f.createUrlParams(i):i,a={method:m[r],headers:s(e)},n&&r!==m.Get&&(a.body=n),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,fetch(t,a)];case 2:if(u=l.sent(),!u.ok)throw Error(u.statusText);return[2,u];case 3:throw c=l.sent(),c.message=d(c),o&&o.logError(c.message),c;case 4:return[2]}})})}function a(t,e,r,s,i){return void 0===r&&(r=m.Get),_.__awaiter(this,void 0,void 0,function(){var a,u,c;return _.__generator(this,function(l){switch(l.label){case 0:return[4,n(t,e,r,s,i)];case 1:return a=l.sent(),[4,a.json()];case 2:if(u=l.sent(),!o(u))throw c=u.errmsg?u.errmsg:y,i&&i.logError(c),Error(c);return[2,u]}})})}function u(t,e,r,s,i){return void 0===r&&(r=m.Get),_.__awaiter(this,void 0,void 0,function(){var o;return _.__generator(this,function(n){switch(n.label){case 0:return[4,a(t,e,r,s,i)];case 1:return o=n.sent(),[2,o.d?o.d:o]}})})}function c(t){return t="/"===t[t.length-1]?t.slice(0,-1):t}function l(t){return t="/"===t[t.length-1]?t:t+"/"}function h(t,e,r){return _.__awaiter(this,void 0,void 0,function(){var s,i;return _.__generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,u(t,void 0,m.Post,{login:e,password:r})];case 1:return s=o.sent(),[2,s];case 2:throw i=o.sent();case 3:return[2]}})})}function d(t){var e;return e=t instanceof Error?t.message:"object"==typeof t?JSON.stringify(t):""+t,g.stripTags(e)}function p(t,e){return void 0===e&&(e=null),_.__awaiter(this,void 0,void 0,function(){return _.__generator(this,function(s){return[2,new Promise(function(s,i){new Promise(function(t){t()}).then(function(i){var o=r(47).createDialog,n=null!==e?window.t("This brokerage account is not for trading this market. {break}  Select the account {account} and try again.").format({break:"</br>",account:e}):window.t("This symbol cannot be traded through {brokerTitle}.").format({brokerTitle:t}),a='\n\t\t\t\t<p class="tv-text">\n\t\t\t\t'+n+"\n\t\t\t\t</p>\n\t\t\t",u=o({title:window.t("Can't place the order"),content:a,width:500,type:"modal",draggable:!1,destroyOnClose:!0,closeOnOutsideClick:!1,addClass:"tv-text",actions:[{name:"ok",text:window.t("Ok"),type:"primary",method:"close"}]});u.on("action:yes",function(){s()}),u.open()}.bind(null,r)).catch(r.oe)})]})})}var _,f,g,y,m;Object.defineProperty(e,"__esModule",{value:!0}),_=r(0),f=r(1533),r(437),r(11),g=r(189),y=window.t("Failed to fetch"),function(t){t[t.Get=1]="Get",t[t.Post=2]="Post",t[t.Put=3]="Put",t[t.Delete=4]="Delete"}(m=e.HttpMethod||(e.HttpMethod={})),e.getHeaders=s,e.getHttpMethodValue=i,
e.isRestStatusOk=o,e.restRequest=n,e.restRequestDataWOD=a,e.restRequestData=u,e.removeTrailingSlash=c,e.addTrailingSlash=l,e.authorize=h,e.getErrorMessage=d,e.showUntradableSymbolDialogWithAccount=p},1426:function(t,e,r){"use strict";function s(t){return{valid:!0,data:t}}function i(t,e,r,i){return void 0===i&&(i=s),o.__awaiter(this,void 0,void 0,function(){var s,a,u,c,l;return o.__generator(this,function(o){switch(o.label){case 0:s={method:n.HttpMethod[e],headers:r},o.label=1;case 1:return o.trys.push([1,4,,5]),[4,fetch(t,s)];case 2:if(a=o.sent(),!a.ok)throw Error(a.statusText);return[4,a.json()];case 3:if(u=o.sent(),c=i(u),!c.valid)throw Error(c.errormsg);return[2,c.data];case 4:throw l=o.sent(),Error(l.message+": "+t);case 5:return[2]}})})}var o,n;Object.defineProperty(e,"__esModule",{value:!0}),o=r(0),n=r(1404),e.requestUrl=i},1427:function(t,e,r){"use strict";var s,i,o,n,a,u,c,l;Object.defineProperty(e,"__esModule",{value:!0}),s=r(0),i=r(1404),o=r(6),n=r(1426),a=r(8),u=r(9),c=o.getLogger("Trading.Requester"),l=function(){function t(t,e,r,s,i){this._requestInterval=null,this._requestTimeOut=null,this._errorsCount=0,this._status=0,this._snapshot=!0,this._url=t,this._headers=r,this._method=e,this._requestInterval=s,this.update=new u,this.statusChanged=new u,this._extractResponseData=i}return t.prototype.start=function(){this._status=1,this._errorsCount=0,this._request()},t.prototype.stop=function(){this._status=0,this._clearResetRequestTimeout()},t.prototype.status=function(){return this._status},t.prototype.changeUrl=function(t){a.assert(1!==this._status,"Cannot change URL: requester is running"),this._url=t},t.prototype._request=function(){return s.__awaiter(this,void 0,void 0,function(){var t,e,r;return s.__generator(this,function(s){switch(s.label){case 0:if(1!==this._status)return[2];s.label=1;case 1:return s.trys.push([1,3,4,7]),t=this._url,[4,n.requestUrl(this._url,this._method,this._headers,this._extractResponseData)];case 2:return e=s.sent(),this._errorsCount=0,t===this._url&&1===this._status&&(this.update.fire(e,this._snapshot),this._snapshot=!1),[3,7];case 3:return r=s.sent(),c.logError(i.getErrorMessage(r)+": "+this._url),this._errorsCount++,this._failOnErrorsCount(),[3,7];case 4:return null===this._requestInterval||1!==this._status?[3,6]:[4,this._makeNextRequest()];case 5:s.sent(),s.label=6;case 6:return[7];case 7:return[2]}})})},t.prototype._clearResetRequestTimeout=function(){null!==this._requestTimeOut&&(clearTimeout(this._requestTimeOut),this._requestTimeOut=null)},t.prototype._failOnErrorsCount=function(){this._errorsCount>20&&(this._clearResetRequestTimeout(),this._status=2,this.statusChanged.fire(this._status))},t.prototype._makeNextRequest=function(){return s.__awaiter(this,void 0,void 0,function(){var t=this;return s.__generator(this,function(e){return this._requestTimeOut=null,this._requestTimeOut=setTimeout(function(){return s.__awaiter(t,void 0,void 0,function(){return s.__generator(this,function(t){switch(t.label){case 0:return[4,this._request()];case 1:return t.sent(),[2]}})})
},this._requestInterval),[2]})})},t}(),e.DataPulseRequester=l},1532:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),r(11),e.ORDERCOLUMNS=[{label:window.t("Symbol"),className:"tv-data-table__cell--symbol-cell",formatter:"symbol",property:"brokerSymbol",notHideable:!0},{label:window.t("Side"),className:"",property:"side",formatter:"side"},{label:window.t("Type"),className:"",property:"type",formatter:"type"},{label:window.t("Qty"),className:"tv-data-table__cell--right-align",property:"qty",formatter:"integerSeparated",help:window.t("Size in lots")},{label:window.t("Limit Price"),className:"tv-data-table__cell--right-align",property:"limitPrice",formatter:"formatPrice"},{label:window.t("Stop Price"),className:"tv-data-table__cell--right-align",property:"stopPrice",formatter:"formatPrice"},{label:window.t("Take Profit"),className:"tv-data-table__cell--right-align",property:"takeProfit",formatter:"formatPrice"},{label:window.t("Stop Loss"),className:"tv-data-table__cell--right-align",property:"stopLoss",formatter:"formatPrice"},{label:window.t("Avg Fill Price"),className:"tv-data-table__cell--right-align",property:"avgPrice",formatter:"formatPrice"},{id:"status",label:window.t("Status"),className:"",property:"status",formatter:"status"},{label:window.t("Update Time"),className:"",property:"updateTime",formatter:"localDate"},{label:window.t("Order id"),className:"",property:"id"},{label:"",className:"tv-data-table__cell--buttons-cell",formatter:"orderSettings",notSortable:!0,modificationProperty:"status"}],e.HISTORYCOLUMNS=[{label:window.t("Symbol"),className:"tv-data-table__cell--symbol-cell",formatter:"symbol",property:"brokerSymbol",notHideable:!0},{label:window.t("Side"),className:"",property:"side",formatter:"side"},{label:window.t("Type"),className:"",property:"type",formatter:"type"},{label:window.t("Qty"),className:"tv-data-table__cell--right-align",property:"qty",formatter:"integerSeparated",help:window.t("Size in lots")},{label:window.t("Limit Price"),className:"tv-data-table__cell--right-align",property:"limitPrice",formatter:"formatPrice"},{label:window.t("Stop Price"),className:"tv-data-table__cell--right-align",property:"stopPrice",formatter:"formatPrice"},{label:window.t("Take Profit"),className:"tv-data-table__cell--right-align",property:"takeProfit",formatter:"formatPriceForexSup"},{label:window.t("Stop Loss"),className:"tv-data-table__cell--right-align",property:"stopLoss",formatter:"formatPriceForexSup"},{id:"status",label:window.t("Status"),className:"",property:"status",formatter:"status"},{label:window.t("Update Time"),className:"",property:"updateTime",formatter:"localDate"},{label:window.t("Order id"),className:"",property:"id"},{label:"",className:"tv-data-table__cell--buttons-cell",formatter:"orderSettings",notSortable:!0,modificationProperty:"status"}],e.BALANCECOLUMNS=[{label:window.t("Balance"),className:"tv-data-table__cell--right-align",property:"balance",formatter:"fixed",notSortable:!0,fixedWidth:!0},{label:window.t("Equity"),
className:"tv-data-table__cell--right-align",property:"equity",formatter:"fixed",notSortable:!0,fixedWidth:!0},{label:window.t("Total Profit"),className:"tv-data-table__cell--right-align",property:"profit",formatter:"profit",notSortable:!0,fixedWidth:!0}],e.POSITIONCOLUMNS=[{label:window.t("Symbol"),className:"tv-data-table__cell--symbol-cell",formatter:"symbol",property:"brokerSymbol",notHideable:!0},{label:window.t("Side"),className:"",property:"side",formatter:"side"},{label:window.t("Qty"),className:"tv-data-table__cell--right-align",property:"qty",formatter:"integerSeparated",help:window.t("Size in lots")},{label:window.t("Avg Fill Price"),className:"tv-data-table__cell--right-align",property:"avgPrice",formatter:"formatPrice"},{label:window.t("Take Profit"),className:"tv-data-table__cell--right-align",property:"takeProfit",formatter:"formatPriceForexSup"},{label:window.t("Stop Loss"),className:"tv-data-table__cell--right-align",property:"stopLoss",formatter:"formatPriceForexSup"},{label:window.t("Profit"),className:"tv-data-table__cell--right-align",property:"unrealizedPl",formatter:"profit",fixedWidth:!0},{label:"",className:"tv-data-table__cell--buttons-cell",formatter:"posSettings",notSortable:!0,modificationProperty:"status"}]},1533:function(t,e,r){"use strict";function s(t){var e=/\+/g;return decodeURIComponent(t.replace(e," ")).replace(/<\/?[^>]+(>|$)/g,"")}function i(t){var e,r=/([^&=]+)=?([^&]*)/g,i={};if(!t)return i;for(e=r.exec(t);e;)i[s(e[1])]=s(e[2]),e=r.exec(t);return i}function o(){return i(window.location.search.substring(1))}function n(){return i(window.location.hash.split("#")[1])}function a(t){var e,r=[];for(e in t)t.hasOwnProperty(e)&&null!=t[e]&&r.push({key:e,pair:encodeURIComponent(e)+"="+encodeURIComponent(t[e])});return r.sort(function(t,e){return t.key>e.key?1:t.key<e.key?-1:0}).map(function(t){return t.pair}).join("&")}Object.defineProperty(e,"__esModule",{value:!0}),e.decode=s,e.getUrlParams=o,e.getHashUrlParams=n,e.createUrlParams=a},1534:function(t,e,r){"use strict";var s,i,o,n;Object.defineProperty(e,"__esModule",{value:!0}),s=r(1427),i=r(97),o=r(9),n=function(){function t(t,e,r,i,n,a,u){this.update=new o,this.statusChanged=new o,this._data=[],this._status=0,this._requester=new s.DataPulseRequester(t,e,r,i,u),this._idField=n,this._keys=a}return t.prototype.start=function(){this._status=1,this._requester.update.subscribe(this,this._onNewData),this._requester.statusChanged.subscribe(this,this._onStatusChanged),this._requester.start()},t.prototype.stop=function(){this._status=0,this._requester.update.unsubscribe(this,this._onNewData),this._requester.statusChanged.unsubscribe(this,this._onStatusChanged),this._requester.stop(),delete this._requester},t.prototype._onNewData=function(t,e){if(1===this._status){var r=i.findArraysDifferences(this._data,t,this._idField,this._keys);(r.added.length>0||r.modified.length>0||r.removed.length>0)&&(this._data=t,this.update.fire(r,e))}},t.prototype._onStatusChanged=function(t){this._status=t,this.statusChanged.fire(t)},t}(),e.ChangesPulseRequester=n},
473:function(t,e,r){"use strict";function s(t){var e=t.checked?t:B;localStorage.setItem("digital-signature-state",JSON.stringify(e))}function i(){var t=localStorage.getItem("digital-signature-state");return null!==t?JSON.parse(t):B}function o(){var t=i();return{customFields:[{id:"digitalSignature",title:window.t("Digital Signature"),placeHolder:window.t("Enter your personal digital signature"),value:t,customInfo:{checkboxTitle:window.t("Save"),asterix:!0}}]}}function n(t){return t.s&&"ok"!==t.s?{valid:!1,errormsg:t.errmsg}:{valid:!0,data:t.d}}function a(t){return t=t||"market",U[t]}function u(t){return t=t||2,D[t]}function c(t){return"sell"===t?-1:1}function l(t){return-1===t?"sell":"buy"}function h(t){return I[t]}function d(){return"?requestId="+T.randomHashN(10)}function p(t){var e=w.formatNumber(t.balance),r=w.formatNumber(t.unrealizedPl);return[[[e,w.formatNumber(t.balance+t.unrealizedPl),r]]]}function _(t){return void 0!==t.accountManager&&Array.isArray(t.accountManager)&&t.accountManager.length>0}function f(t){return t.amData&&Array.isArray(t.amData)&&t.amData.length>0?t.amData:p(t)}function g(t,e){var r=2!==e.status&&1!==e.status,s=r?e.limitPrice:void 0,i=r?e.stopPrice:void 0;3===e.type?t.stopLoss=i:t.takeProfit=s}function y(t){var e,r,s,i,o=[];for(e=0,r=t;e<r.length;e++)s=r[e],i={name:s.title,value:s.id,hasDatePicker:s.hasDatePicker,hasTimePicker:s.hasTimePicker},o.push(i);return o}function m(t){return t.map(function(t){return{price:t[0],volume:t[1]}})}var v,b,P,w,k,T,S,q,O,U,D,I,R,A,B,x,M;Object.defineProperty(e,"__esModule",{value:!0}),v=r(0),b=r(1532),P=r(8),w=r(97),k=r(1426),T=r(35),S=r(1404),q=r(1534),O=r(1427),U={limit:1,market:2,stop:3,stoplimit:4},M={},M[1]="limit",M[2]="market",M[3]="stop",M[4]="stoplimit",D=M,I={pending:4,inactive:3,working:6,rejected:5,filled:2,cancelled:1},R=["qty","status","filledQty","avgPrice","limitPrice","stopPrice","parentId"],A=["instrument","qty","side","avgPrice","unrealizedPl","realizedPl","stopLoss","takeProfit"],B={checked:!1,text:""},x=function(){function t(t,e,r,s){var i,o;void 0===s&&(s=null),i=this,this._accountType=1,this._accountManagerTablesData=[],this._accountManagerTablesDelegates=[],this._requesters={},this._depthSubscriptions={},this._host=t,this._restUrl=S.addTrailingSlash(e),this._metainfo=r,this._realtimeSubscriptions=new Set,this._initData(),this._tokenStorageKey="rest-token-"+r.id,this._logger=t.getLogger(),this._mapper=t.createMapper(P.ensure(r.id)),this._status=this._host.factory.createWatchedValue(3),this._account=t.factory.createWatchedValue({id:"",name:"",currencySign:"",config:{},instruments:[]}),this._summaryValues={balance:t.factory.createWatchedValue(),equity:t.factory.createWatchedValue(),unrealizedPl:t.factory.createWatchedValue()},this._setAccountBinded=this._setAccount.bind(this),s&&(o=new Date,o.setDate(o.getDate()+5),this._saveAccessToken({access_token:s,expiration:o.valueOf()})),this._createButtonDropdownOptions(),this._host.floatingTradingPanelVisibility().subscribe(function(){i._createButtonDropdownOptions()}),
this._host.domVisibility().subscribe(function(){i._createButtonDropdownOptions()}),setTimeout(function(){return i._tryConnect()},0)}return t.prototype.chartContextMenuActions=function(t,e){return this._host.defaultContextMenuActions(t,e)},t.prototype.accountInfo=function(){return Promise.resolve(this._account.value())},t.prototype.accountManagerInfo=function(){var t,e,r=this,s=[{text:$.t("Account Balance"),wValue:this._summaryValues.balance},{text:$.t("Equity"),wValue:this._summaryValues.equity},{text:$.t("Open Profit"),wValue:this._summaryValues.unrealizedPl}],i=this._account.value().config.supportOrderBrackets||this._account.value().config.supportPositionBrackets,o=[];return _(this._brokerConfig)&&(o=P.ensure(this._brokerConfig.accountManager).map(function(t,e){return Object.assign({},{id:t.id,title:t.title,getData:function(){return Promise.resolve(r._accountManagerTablesData[e])},changeDelegate:r._accountManagerTablesDelegates[e],columns:t.columns.map(function(t){return Object.assign({},{id:t.id,label:t.title,property:t.id,notSortable:!t.sortable,fixedWidth:t.fixedWidth})})})})),t=function(t){return i||"stopLoss"!==t.property&&"takeProfit"!==t.property},e={accountTitle:P.ensure(this._metainfo.title),account:this._account,accountsList:this._accounts,orderColumns:b.ORDERCOLUMNS.filter(t),pages:[{id:"summary",title:$.t("Account Summary"),tables:o}],positionColumns:b.POSITIONCOLUMNS.filter(t),summary:s,customFormatters:[]},this._account.value().config.supportOrdersHistory&&(e.historyColumns=b.HISTORYCOLUMNS.filter(t)),e},t.prototype.currentAccount=function(){return this._account.value().name},t.prototype.currentAccountType=function(){return 1===this._accountType?"demo":"real"},t.prototype.executions=function(t){return Promise.resolve(this._tvExecutions.filter(function(e){return e.symbol===t}))},t.prototype.orders=function(){return Promise.resolve(this._tvOrders)},t.prototype.positions=function(){return Promise.resolve(this._tvPositions)},t.prototype.cancelOrder=function(t,e){return v.__awaiter(this,void 0,void 0,function(){var r,s=this;return v.__generator(this,function(i){return r=this._getOrderIdRestUrl(t),e?[2,S.restRequestData(r,this._getAccessToken(),S.HttpMethod.Delete)]:[2,this._host.showCancelOrderDialog(t,function(){return S.restRequest(r,s._getAccessToken(),S.HttpMethod.Delete)})]})})},t.prototype.modifyOrder=function(t,e,r){return v.__awaiter(this,void 0,void 0,function(){var n,a,u,c,l,h,d=this;return v.__generator(this,function(p){return n=this._account.value().config.supportDigitalSignature,2===t.parentType?void 0===this._tvPositionById(t.parentId)?[2]:(a=this._getPositionBracketsById(t.parentId),[2,this.editPositionBrackets(P.ensure(t.brokerSymbol),1===t.type?3:1,{takeProfit:t.limitPrice||a.takeProfit,stopLoss:t.stopPrice||a.stopLoss},e)]):1===t.parentType?(u=this._tvOrderById(P.ensure(t.parentId)),[2,this.modifyOrder(v.__assign({},u,{stopLoss:t.stopPrice,takeProfit:t.limitPrice}),e,t.stopPrice?1:3)]):e?(c=n?i().text:null,[2,this._modifyOrder(t,c)]):(a=this._getOrderBrackets(t.id),l=Object.assign({},t),
l.stopLoss=t.stopLoss?t.stopLoss:a.stopLoss,l.takeProfit=t.takeProfit?t.takeProfit:a.takeProfit,h=n?o():void 0,[2,this._host.showOrderDialog(l,function(t,e){var r=null;return void 0!==e&&(r=e.digitalSignature.text,s(e.digitalSignature)),d._modifyOrder(t,r)},r,h)])})})},t.prototype.placeOrder=function(t,e){return v.__awaiter(this,void 0,void 0,function(){var r,n,a,u,c,l,h,d=this;return v.__generator(this,function(p){switch(p.label){case 0:return[4,this.isTradable(t.symbol)];case 1:return r=p.sent(),n=this._account.value().config.supportDigitalSignature,r?e?(a=n?i().text:null,[2,this._placeOrder(t,a)]):(u=n?o():void 0,[2,this._host.showOrderDialog(t,function(t,e){var r=null;return void 0!==e&&(r=e.digitalSignature.text,s(e.digitalSignature)),d._placeOrder(t,r)},void 0,u)]):[3,2];case 2:c=void 0,l=null,p.label=3;case 3:return p.trys.push([3,5,,6]),[4,this._mapFromTV(t.symbol)];case 4:return c=p.sent(),l=this._getAccountWithTradableSymbol(c),[3,6];case 5:return h=p.sent(),this._logger.logWarn("Cannot map symbol: "+t.symbol),[3,6];case 6:S.showUntradableSymbolDialogWithAccount(P.ensure(this._metainfo.title),l),p.label=7;case 7:return[2]}})})},t.prototype.cancelOrders=function(t,e,r,s){return v.__awaiter(this,void 0,void 0,function(){var i,o=this;return v.__generator(this,function(n){return i=function(){return Promise.all(r.map(function(t){return o.cancelOrder(t,!0)})).then(function(){})},s?[2,i()]:[2,this._host.showCancelMultipleOrdersDialog(t,e,r.length,i)]})})},t.prototype.editPositionBrackets=function(t,e,r,s){var i,o,n,a,u=this;return s?this._editPositionBrackets(t,r):(i=P.ensure(this._tvPositionById(t)),o=this._getPositionBracketsById(t),n=r&&r.stopLoss?r.stopLoss:o.stopLoss,a=r&&r.takeProfit?r.takeProfit:o.takeProfit,this._host.showPositionBracketsDialog(i,{stopLoss:n,takeProfit:a},e||null,function(e){return u._editPositionBrackets(t,e)}))},t.prototype.closePosition=function(t,e){var r=this;return e?this._closePosition(t):this._host.showClosePositionDialog(t,function(){return r._closePosition(t)})},t.prototype.isTradable=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r;return v.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._mapFromTV(t)];case 1:return e=s.sent(),[2,-1!==this._instruments.findIndex(function(t){return t.name===e})];case 2:return r=s.sent(),[2,!1];case 3:return[2]}})})},t.prototype.subscribeRealtime=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r;return v.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._mapFromTV(t)];case 1:return e=s.sent(),this._realtimeSubscriptions.add(e),[3,3];case 2:return r=s.sent(),this._logger.logError(S.getErrorMessage(r)),[2];case 3:return this._changeQuotesRequesterUrl(),[2]}})})},t.prototype.unsubscribeRealtime=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r;return v.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._mapFromTV(t)];case 1:return e=s.sent(),
this._realtimeSubscriptions.delete(e)&&this._changeQuotesRequesterUrl(),[3,3];case 2:return r=s.sent(),this._logger.logError(S.getErrorMessage(r)),[3,3];case 3:return[2]}})})},t.prototype.subscribeDOME=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s,i,o;return v.__generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._mapFromTV(t)];case 1:return e=a.sent(),r=this._getDepthUrl(e),s=new O.DataPulseRequester(r,S.HttpMethod.Get,this._getHeaders(),this._getPullingInterval("quotes"),n),i=this._onDepthUpdate.bind(this,t),s.update.subscribe(this,i),s.start(),this._depthSubscriptions[t]={callback:i,requester:s},[3,3];case 2:return o=a.sent(),this._logger.logError(S.getErrorMessage(o)),[2];case 3:return[2]}})})},t.prototype.unsubscribeDOME=function(t){try{this._depthSubscriptions[t].requester.update.unsubscribe(this,this._depthSubscriptions[t].callback),this._depthSubscriptions[t].requester.stop(),delete this._depthSubscriptions[t]}catch(t){this._logger.logError(S.getErrorMessage(t))}},t.prototype.signIn=function(t,e,r){return v.__awaiter(this,void 0,void 0,function(){var r,s,i,o;return v.__generator(this,function(n){switch(n.label){case 0:this._setStatus(2),n.label=1;case 1:return n.trys.push([1,5,,6]),localStorage.removeItem(this._tokenStorageKey),[4,this._authorize(t,e)];case 2:return r=n.sent(),this._saveAccessToken(r),s=this,[4,this._getBrokerConfig()];case 3:return s._brokerConfig=n.sent(),[4,this._initializeAccount()];case 4:return n.sent(),this._createButtonDropdownOptions(),[3,6];case 5:return i=n.sent(),o=S.getErrorMessage(i),this._logger.logError("Failed to connect to broker: "+o),this.disconnect(),this._setStatus(4,S.getErrorMessage(i)),[3,6];case 6:return[2]}})})},t.prototype.symbolInfo=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r;return v.__generator(this,function(s){switch(s.label){case 0:return[4,this._mapFromTV(t)];case 1:return e=s.sent(),r=this._instruments.find(function(t){return t.name===e}),r?[2,Promise.resolve({qty:{min:r.minQty||1,max:r.maxQty||1e9,step:r.qtyStep||1},pipValue:r.pipValue||1,pipSize:r.pipSize||.01,minTick:r.minTick||.01,description:r.description})]:[2,Promise.reject("Instrument not found")]}})})},t.prototype.connectionStatus=function(){return this._status.value()},t.prototype.disconnect=function(){this._setStatus(3),this._cleanup(),localStorage.removeItem(this._tokenStorageKey),this._account.unsubscribe(this._setAccountBinded)},t.prototype.supportFloatingPanel=function(){return!0},t.prototype.getRealtimeDataCheckParams=function(){return{token:this._getAccessToken()}},t.prototype._getAccessToken=function(){return this._accessToken},t.prototype._initializeAccount=function(){return v.__awaiter(this,void 0,void 0,function(){var t,e,r,s,i;return v.__generator(this,function(o){switch(o.label){case 0:return t=this,[4,this._getAccounts()];case 1:t._accounts=o.sent(),P.assert(!!this._accounts.length),e=0,r=this._accounts,o.label=2;case 2:return e<r.length?(s=r[e],i=s,[4,this._getInstrumentsByAccountId(s.id)]):[3,5]
;case 3:i.instruments=o.sent(),o.label=4;case 4:return e++,[3,2];case 5:return[4,this._setAccount(this._accounts[0])];case 6:return o.sent(),this._account.subscribe(this._setAccountBinded),[2]}})})},t.prototype._onQuotesUpdate=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s,i,o;return v.__generator(this,function(n){switch(n.label){case 0:e=0,r=t,n.label=1;case 1:if(!(e<r.length))return[3,6];if(s=r[e],"ok"!==s.s)return[3,5];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,this._mapToTV(s.n)];case 3:return i=n.sent(),s.v.lp=s.v.lp||0,s.v.ch=s.v.ch||0,s.v.chp=s.v.chp||0,this._host.realtimeUpdate(i,s.v),[3,5];case 4:return o=n.sent(),this._logger.logError(S.getErrorMessage(o)),[2];case 5:return e++,[3,1];case 6:return[2]}})})},t.prototype._changeQuotesRequesterUrl=function(){var t=this._getQuotesUrl();void 0!==this._requesters.quotes&&this._requesters.quotes.stop(),null!==t&&(void 0===this._requesters.quotes?(this._requesters.quotes=new O.DataPulseRequester(t,S.HttpMethod.Get,this._getHeaders(),this._getPullingInterval("quotes"),n),this._requesters.quotes.update.subscribe(this,this._onQuotesUpdate)):this._requesters.quotes.changeUrl(t),this._requesters.quotes.start())},t.prototype._closePosition=function(t){var e=this._getPositionIdRestUrl(t);return S.restRequestData(e,this._getAccessToken(),S.HttpMethod.Delete)},t.prototype._stopRequester=function(t){void 0!==t&&(t.stop(),t.update.unsubscribeAll(this))},t.prototype._setAccount=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s;return v.__generator(this,function(i){switch(i.label){case 0:return this._cleanup(),1===this.connectionStatus()&&this._setStatus(2),this._account.setValue(t),[4,this._initRequesters()];case 1:return i.sent(),this._instruments=t.instruments,[4,this._getAccountState()];case 2:for(e=i.sent(),r=0;r<P.ensure(this._brokerConfig.accountManager).length;r++)s=this._host.factory.createDelegate(),this._accountManagerTablesDelegates.push(s),this._accountManagerTablesData.push([{}]);return this._setAccountManagerTableData(f(e)),this._setSummaryValues(e),this._host.patchConfig(t.config),this._brokerConfig.durations&&this._host.setDurations(y(this._brokerConfig.durations)),this._setStatus(1),[2]}})})},t.prototype._requestExecutions=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s,i,o,a;return v.__generator(this,function(u){switch(u.label){case 0:return[4,k.requestUrl(this._getExecutionsUrl(t),S.HttpMethod.Get,this._getHeaders(),n)];case 1:e=u.sent(),r=w.findArraysDifferences(this._restExecutions,e,"id",["id"]),s=0,i=r.added,u.label=2;case 2:return s<i.length?(o=i[s],this._restExecutions.push(o),[4,this._executionToTv(o)]):[3,5];case 3:a=u.sent(),this._tvExecutions.push(a),this._host.executionUpdate(a),u.label=4;case 4:return s++,[3,2];case 5:return[2]}})})},t.prototype._updateExecutionsBySymbols=function(t){return v.__awaiter(this,void 0,void 0,function(){var e=this;return v.__generator(this,function(r){return Promise.all(t.map(function(t){return e._requestExecutions(t)})),[2]})})},
t.prototype._setSummaryValues=function(t){var e=t.balance+t.unrealizedPl;this._summaryValues.balance.setValue(t.balance),this._summaryValues.equity.setValue(e),this._host.equityUpdate(e),this._summaryValues.unrealizedPl.setValue(t.unrealizedPl)},t.prototype._setAccountManagerTableData=function(t){var e,r,s,i,o,n,a,u,c;if(0!==this._accountManagerTablesData.length)for(e=0;e<t.length;e++)for(r=t[e],s=this._accountManagerTablesData[e],i=P.ensure(this._brokerConfig.accountManager)[e].columns,s.length=r.length,o=0;o<r.length;o++){for(n=r[o],a={id:o},u=0;u<n.length;u++)c=P.ensure(i[u].id),a[c]=n[u];s[o]=a,this._accountManagerTablesDelegates[e].fire(a)}},t.prototype._createRequesters=function(){return v.__awaiter(this,void 0,void 0,function(){var t,e,r,s,i;return v.__generator(this,function(o){return t=this._getOrdersRestUrl(),e=this._getPositionsRestUrl(),r=this._getAccountStateRestUrl(),this._requesters={positions:new q.ChangesPulseRequester(e,S.HttpMethod.Get,this._getHeaders(),this._getPullingInterval("positions"),"id",A,n),orders:new q.ChangesPulseRequester(t,S.HttpMethod.Get,this._getHeaders(),this._getPullingInterval("orders"),"id",R,n),accountState:new O.DataPulseRequester(r,S.HttpMethod.Get,this._getHeaders(),this._getPullingInterval("accountManager"),n)},s=P.ensure(this._requesters.positions),s.update.subscribe(this,this._onPositionsUpdate),s.statusChanged.subscribe(this,this._onRequesterStatusUpdate),i=P.ensure(this._requesters.orders),i.update.subscribe(this,this._onOrdersUpdate),i.statusChanged.subscribe(this,this._onRequesterStatusUpdate),P.ensure(this._requesters.accountState).update.subscribe(this,this._onAccountStateUpdate),[2]})})},t.prototype._startRequesters=function(){var t=this;Object.keys(this._requesters).forEach(function(e){return P.ensure(t._requesters[e]).start()})},t.prototype._stopAndDeleteRequesters=function(){var t=this;Object.keys(this._requesters).forEach(function(e){var r=t._requesters[e];void 0!==r&&t._stopRequester(r)}),this._requesters={}},t.prototype._cleanup=function(){this._stopAndDeleteRequesters(),this._initData()},t.prototype._setStatus=function(t,e){this._status.value()!==t&&(this._status.setValue(t),this._host.connectionStatusUpdate(t,e))},t.prototype._onRequesterStatusUpdate=function(t){2===t&&this.disconnect()},t.prototype._onAccountStateUpdate=function(t){return v.__awaiter(this,void 0,void 0,function(){var e;return v.__generator(this,function(r){return this._setSummaryValues(t),e=f(t),this._setAccountManagerTableData(e),[2]})})},t.prototype._tryConnect=function(){return v.__awaiter(this,void 0,void 0,function(){var t,e,r;return v.__generator(this,function(s){switch(s.label){case 0:return s.trys.push([0,4,,5]),(t=this._getStoredAuthResult())?(this._accessToken=t.access_token,this._setStatus(2),e=this,[4,this._getBrokerConfig()]):[3,3];case 1:return e._brokerConfig=s.sent(),[4,this._initializeAccount()];case 2:s.sent(),this._setAccessTokenExpirationTimeout(t),this._createButtonDropdownOptions(),s.label=3;case 3:return[3,5];case 4:return r=s.sent(),this.disconnect(),
this._logger.logError(S.getErrorMessage(r)),[3,5];case 5:return[2]}})})},t.prototype._authorize=function(t,e){return v.__awaiter(this,void 0,void 0,function(){var r;return v.__generator(this,function(s){return r=this._getAuthorizeUrl(),[2,S.authorize(r,t,e)]})})},t.prototype._getAccounts=function(){return v.__awaiter(this,void 0,void 0,function(){var t,e,r,s;return v.__generator(this,function(i){switch(i.label){case 0:return[4,S.restRequestData(this._getAccountsUrl(),this._getAccessToken())];case 1:for(t=i.sent(),e=0,r=t;e<r.length;e++)s=r[e],s.currency=s.currency||"",s.currencySign=s.currencySign||"";return[2,t]}})})},t.prototype._getInstrumentsByAccountId=function(t){return v.__awaiter(this,void 0,void 0,function(){return v.__generator(this,function(e){return[2,S.restRequestData(this._getInstrumentsUrlByAccountId(t),this._getAccessToken())]})})},t.prototype._getBrokerConfig=function(){return v.__awaiter(this,void 0,void 0,function(){var t;return v.__generator(this,function(e){switch(e.label){case 0:return[4,S.restRequestData(this._getBrokerConfigUrl(),this._getAccessToken())];case 1:return t=e.sent(),_(t)||(t.accountManager=[{id:"accountSummary",title:"",columns:[{id:"balance",title:"Balance",tooltip:"",fixedWidth:!0,sortable:!1},{id:"equity",title:"Equity",tooltip:"",fixedWidth:!0,sortable:!1},{id:"totalProfit",title:"Total Profit",tooltip:"",fixedWidth:!0,sortable:!1}]}]),[2,t]}})})},t.prototype._getAccountState=function(){return v.__awaiter(this,void 0,void 0,function(){return v.__generator(this,function(t){return[2,S.restRequestData(this._getAccountStateUrl(),this._getAccessToken())]})})},t.prototype._placeOrder=function(t,e){return v.__awaiter(this,void 0,void 0,function(){var r,s;return v.__generator(this,function(i){switch(i.label){case 0:return[4,this._orderFromTV(t)];case 1:return r=i.sent(),s=this._getOrdersRestUrl()+d(),null!==e&&(r.digitalSignature=e),[2,S.restRequestData(s,this._getAccessToken(),S.HttpMethod.Post,r)]}})})},t.prototype._modifyOrder=function(t,e){return v.__awaiter(this,void 0,void 0,function(){var r,s;return v.__generator(this,function(i){return r={id:t.id,qty:t.qty},t.parent||(t.stopLoss&&(r.stopLoss=t.stopLoss),t.takeProfit&&(r.takeProfit=t.takeProfit)),r.limitPrice=(t.type,t.limitPrice),r.stopPrice=(t.type,t.stopPrice),s=this._getOrderIdRestUrl(t.id),null!==e&&(r.digitalSignature=e),[2,S.restRequestData(s,this._getAccessToken(),S.HttpMethod.Put,r)]})})},t.prototype._createTvOrders=function(t){var e=this;return Promise.all(t.map(function(t){return e._orderToTV(t)}))},t.prototype._onOrdersUpdate=function(t,e){return v.__awaiter(this,void 0,void 0,function(){var r,s,i,o,n,a,u,c,l,h,d,p=this;return v.__generator(this,function(_){switch(_.label){case 0:return[4,this._createTvOrders(t.added)];case 1:return r=_.sent(),[4,this._createTvOrders(t.modified)];case 2:for(s=_.sent(),i=[],(h=this._restOrders).push.apply(h,t.added),o=0,n=t.modified;o<n.length;o++)a=n[o],this._restOrders[this._restOrderIndexById(a.id)]=a;for((d=this._tvOrders).push.apply(d,r),i.push.apply(i,r),u=0,
c=s;u<c.length;u++)l=c[u],this._tvOrders[this._tvOrderIndexById(l.id)]=l,i.push(l);return i.forEach(function(t){var r,s,i,o,n;1===t.parentType?(r=p._tvOrderById(t.parentId))&&(g(r,t),p._host.orderUpdate(r,e)):2===t.parentType?(s=p._tvPositionById(t.symbol))&&s.qty>0&&(g(s,t),i=s.stopLoss,o=s.takeProfit,p._host.positionPartialUpdate(s.id,{stopLoss:i,takeProfit:o})):t.parentType||(n=p._getOrderBrackets(t.id),n.stopLoss&&(t.stopLoss=n.stopLoss),n.takeProfit&&(t.takeProfit=n.takeProfit)),p._host.orderUpdate(t,e)}),[2]}})})},t.prototype._createTVPositions=function(t){var e=this;return Promise.all(t.map(function(t){return e._positionToTV(t)}))},t.prototype._onPositionsUpdate=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s,i,o,n,a,u,c,l,h,d,p,_,f,y,m=this;return v.__generator(this,function(v){switch(v.label){case 0:return e=[],[4,this._createTVPositions(t.added)];case 1:return r=v.sent(),[4,this._createTVPositions(t.modified)];case 2:for(s=v.sent(),i=0,o=t.added;i<o.length;i++)n=o[i],this._addOrModifyPosition(n,this._restPositions);for(a=0,u=t.modified;a<u.length;a++)n=u[a],this._restPositions[this._restPositionIndexById(n.id)]=n;for(c=function(t){l._addOrModifyPosition(t,l._tvPositions),l._findPositionBracketOrders(t.id).forEach(function(e){return g(t,e)}),l._host.positionUpdate(t),l._host.plUpdate(t.id,t.unrealizedPl),e.push(t.id)},l=this,h=0,d=r;h<d.length;h++)p=d[h],c(p);for(_=0,f=s;_<f.length;_++){if(p=f[_],void 0===(y=this._tvPositionById(p.id)))return[2];this._host.positionUpdate(p),y.unrealizedPl!==p.unrealizedPl&&(this._host.plUpdate(p.id,p.unrealizedPl),this._host.positionPartialUpdate(p.id,{unrealizedPl:p.unrealizedPl})),y.side===p.side&&y.qty===p.qty||e.push(p.id),this._addOrModifyPosition(p,this._tvPositions)}return t.removed.forEach(function(t){var e,r=m._tvPositionById(t.id);void 0!==r&&(e=m._restPositionById(t.id),r.qty=0,e.qty=0,m._host.positionUpdate(r))}),this._updateExecutionsBySymbols(e),[2]}})})},t.prototype._addOrModifyPosition=function(t,e){var r=e.findIndex(function(e){return e.id===t.id});-1!==r?e[r]=t:e.push(t)},t.prototype._restPositionIndexById=function(t){return this._restPositions.findIndex(function(e){return e.id===t})},t.prototype._restPositionById=function(t){var e=this._restPositions.find(function(e){return e.id===t});if(!e)throw Error("Cannot find REST position: "+t);return e},t.prototype._restOrderIndexById=function(t){return this._restOrders.findIndex(function(e){return e.id===t})},t.prototype._tvPositionById=function(t){return this._tvPositions.find(function(e){return e.id===t})},t.prototype._tvOrderIndexById=function(t){return this._tvOrders.findIndex(function(e){return e.id===t})},t.prototype._tvOrderById=function(t){var e=this._tvOrders.find(function(e){return e.id===t});if(!e)throw Error("Cannot find TV order");return e},t.prototype._getBaseRestUrl=function(){var t=this._account.value().id;return P.assert(!!t,"Unable to get base url - account is not properly initialized"),this._getBaseRestUrlByAccountId(t)},t.prototype._getBaseRestUrlByAccountId=function(t){
return this._restUrl+"accounts/"+t},t.prototype._getAccountStateRestUrl=function(){return this._getBaseRestUrl()+"/state?locale=en"},t.prototype._getExecutionsUrl=function(t){return this._getBaseRestUrl()+"/executions?instrument="+encodeURIComponent(t)},t.prototype._getPullingInterval=function(t){var e=500,r=P.ensure(this._brokerConfig.pullingInterval);return r.hasOwnProperty(t)&&(e=r[t]),e},t.prototype._getAuthorizeUrl=function(){return this._restUrl+"authorize"},t.prototype._getBrokerConfigUrl=function(){return this._restUrl+"config?locale=en"},t.prototype._getAccountsUrl=function(){return this._restUrl+"accounts"},t.prototype._getAccountStateUrl=function(){return this._getBaseRestUrl()+"/state?locale=en"},t.prototype._getQuotesUrl=function(){var t,e=Array.from(this._realtimeSubscriptions);return 0===e.length?null:(t=e.join(","),this._restUrl+"quotes?symbols="+encodeURIComponent(t))},t.prototype._getDepthUrl=function(t){return this._restUrl+"depth?symbol="+encodeURIComponent(t)},t.prototype._getInstrumentsUrlByAccountId=function(t){return this._getBaseRestUrlByAccountId(t)+"/instruments/"},t.prototype._getOrdersRestUrl=function(){return this._getBaseRestUrl()+"/orders/"},t.prototype._getOrderIdRestUrl=function(t){return this._getBaseRestUrl()+"/orders/"+t},t.prototype._getPositionsRestUrl=function(){return this._getBaseRestUrl()+"/positions/"},t.prototype._getPositionIdRestUrl=function(t){return this._getBaseRestUrl()+"/positions/"+t},t.prototype._getHeaders=function(){var t=this._getAccessToken();return S.getHeaders(t)},t.prototype._orderToTV=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s;return v.__generator(this,function(i){switch(i.label){case 0:e=t.instrument,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._mapToTV(t.instrument)];case 2:return e=i.sent(),[3,4];case 3:return r=i.sent(),this._logger.logWarn("Cannot map symbol: "+t.instrument),[3,4];case 4:return s={id:t.id,type:a(t.type),side:c(t.side),symbol:e,brokerSymbol:t.instrument,qty:Math.abs(t.qty),filledQty:t.filledQty,status:h(t.status),avgPrice:t.avgPrice,limitPrice:t.limitPrice,stopPrice:t.stopPrice},t.parentId&&(s.parentId=t.parentId,s.parentType="position"===t.parentType?2:1),t.stopLoss&&(s.stopLoss=t.stopLoss),t.takeProfit&&(s.takeProfit=t.takeProfit),t.duration&&t.duration.datetime&&(s.duration={type:t.duration.type,datetime:1e3*t.duration.datetime}),[2,s]}})})},t.prototype._orderFromTV=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r;return v.__generator(this,function(s){switch(s.label){case 0:return[4,this._mapFromTV(t.symbol)];case 1:return e=s.sent(),r={brokerSymbol:e,instrument:e,qty:t.qty,side:l(t.side),type:u(t.type),limitPrice:t.limitPrice,stopPrice:t.stopPrice},t.stopLoss&&(r.stopLoss=t.stopLoss),t.takeProfit&&(r.takeProfit=t.takeProfit),t.duration&&(r.durationType=t.duration.type,t.duration.datetime&&(r.durationDateTime=t.duration.datetime/1e3)),[2,r]}})})},t.prototype._getOrderBrackets=function(t){var e,r,s,i=this._tvOrders.filter(function(e){
return 1===e.parentType&&e.parentId===t&&1!==e.status}),o={};for(e=0,r=i;e<r.length;e++)s=r[e],3===s.type&&(o.stopLoss=s.stopPrice),1===s.type&&(o.takeProfit=s.limitPrice);return o},t.prototype._findPositionBracketOrders=function(t){return this._tvOrders.filter(function(e){return 2===e.parentType&&e.parentId===t&&6===e.status})},t.prototype._getPositionBracketsById=function(t){var e,r,s,i=this._findPositionBracketOrders(t),o={};for(e=0,r=i;e<r.length;e++)s=r[e],3===s.type&&(o.stopLoss=s.stopPrice),1===s.type&&(o.takeProfit=s.limitPrice);return o},t.prototype._editPositionBrackets=function(t,e){var r=this._getPositionIdRestUrl(t),s=Object.assign({},e);return S.restRequestData(r,this._getAccessToken(),S.HttpMethod.Put,s)},t.prototype._executionToTv=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r;return v.__generator(this,function(s){switch(s.label){case 0:e="",s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._mapToTV(t.instrument)];case 2:return e=s.sent(),[3,4];case 3:return r=s.sent(),this._logger.logWarn("Cannot map symbol: "+t.instrument),[3,4];case 4:return[2,{id:t.id,symbol:e,brokerSymbol:t.instrument,price:t.price,qty:t.qty,side:c(t.side),time:t.time}]}})})},t.prototype._positionToTV=function(t){return v.__awaiter(this,void 0,void 0,function(){var e,r,s;return v.__generator(this,function(i){switch(i.label){case 0:e=t.instrument,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._mapToTV(t.instrument)];case 2:return e=i.sent(),[3,4];case 3:return r=i.sent(),this._logger.logWarn("Cannot map symbol: "+t.instrument),[3,4];case 4:return s={id:t.id,symbol:e,brokerSymbol:t.instrument,qty:t.qty,side:"buy"===t.side?1:-1,avgPrice:t.avgPrice,unrealizedPl:t.unrealizedPl,realizedPl:t.realizedPl},this._tvOrders.filter(function(t){return 2===t.parentType&&t.symbol===s.symbol}).forEach(function(t){return g(s,t)}),[2,s]}})})},t.prototype._mapToTV=function(t){return this._mapper.brokerToTv(t)},t.prototype._mapFromTV=function(t){return this._mapper.tvToBroker(t)},t.prototype._initData=function(){this._accountManagerTablesDelegates=[],this._accountManagerTablesData=[],this._restExecutions=[],this._tvExecutions=[],this._restOrders=[],this._tvOrders=[],this._restPositions=[],this._tvPositions=[],this._realtimeSubscriptions.clear(),this._instruments=[]},t.prototype._createButtonDropdownOptions=function(){var t,e={showFloatingToolbar:!0,showDOM:!0,tradingProperties:!0,selectAnotherBroker:!0,disconnect:!0};e.disconnect=!1,e.selectAnotherBroker=!1,t=this._host.defaultDropdownMenuActions(e),this._host.setButtonDropdownActions(t)},t.prototype._initRequesters=function(){return v.__awaiter(this,void 0,void 0,function(){return v.__generator(this,function(t){switch(t.label){case 0:return this._accounts.length>0?[4,this._createRequesters()]:[3,2];case 1:t.sent(),this._startRequesters(),t.label=2;case 2:return[2]}})})},t.prototype._getStoredAuthResult=function(){var t=localStorage.getItem(this._tokenStorageKey);return t?JSON.parse(t):null},t.prototype._setAccessTokenExpirationTimeout=function(t){
var e=this,r=1e3*t.expiration-Date.now().valueOf();r<0?this._checkAccessTokenExpiration():setTimeout(function(){return e._checkAccessTokenExpiration},r-1e4)},t.prototype._saveAccessToken=function(t){localStorage.setItem(this._tokenStorageKey,JSON.stringify(t)),this._setAccessTokenExpirationTimeout(t),this._accessToken=t.access_token},t.prototype._checkAccessTokenExpiration=function(){var t=this._getStoredAuthResult();t&&1e3*t.expiration<=Date.now().valueOf()&&(this._logger.logError("Access token has expired"),this.disconnect())},t.prototype._onDepthUpdate=function(t,e){var r={snapshot:!0,asks:m(e.asks),bids:m(e.bids)};this._host.domeUpdate(t,r)},t.prototype._getAccountWithTradableSymbol=function(t){var e,r,s,i=null;for(e=0,r=this._accounts;e<r.length;e++)if(s=r[e],-1!==s.instruments.findIndex(function(e){return t===e.name})){i=s.name;break}return i},t}(),e.Broker=x}});